I"€"<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-DNS%E8%AE%B0%E5%BD%95%E7%9A%84%E8%8E%B7%E5%8F%96">ã€ŠåŸŸæ¸—é€â€”â€”DNSè®°å½•çš„è·å–ã€‹</a>ä»‹ç»äº†åŸŸæ¸—é€ä¸­è·å¾—DNSç®¡ç†å‘˜æƒé™åè·å–DNSè®°å½•çš„æ–¹æ³•ï¼Œè€Œæ›´æ™®éçš„æƒ…å†µæ˜¯åªæœ‰åŸŸæ™®é€šç”¨æˆ·çš„æƒé™ï¼Œä¹Ÿéœ€è¦è·å¾—DNSè®°å½•ã€‚</p>

<p>æœ¬æ–‡å°†ä¼šå‚è€ƒå…¬å¼€çš„èµ„æ–™ï¼Œæ•´ç†åŸŸæ™®é€šç”¨æˆ·è·å¾—DNSè®°å½•çš„æ–¹æ³•ï¼Œä¿®å¤dns-dump.ps1åœ¨é«˜ç‰ˆæœ¬Windowsç³»ç»Ÿä¸‹çš„bug</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>å®ç°åŸç†</li>
  <li>å¼€æºçš„å·¥å…·å’Œæ–¹æ³•</li>
</ul>

<h2 id="0x02-å®ç°åŸç†">0x02 å®ç°åŸç†</h2>
<hr />

<h3 id="1sharpadidnsdumpçš„å®ç°åŸç†">1.SharpAdidnsdumpçš„å®ç°åŸç†</h3>

<p>å…ˆé€šè¿‡LDAPæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºçš„åç§°ï¼Œå†é€šè¿‡DNSæŸ¥è¯¢è·å¾—å¯¹åº”çš„IP</p>

<p>è¯¦ç»†å®ç°ç»†èŠ‚å¯å‚è€ƒï¼š</p>

<p>https://github.com/b4rtik/SharpAdidnsdump</p>

<p>æµ‹è¯•ç¯å¢ƒï¼š test.com</p>

<h4 id="1é€šè¿‡ldapæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºçš„åç§°">(1)é€šè¿‡LDAPæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºçš„åç§°</h4>

<p>å¯¹åº”LDAPçš„æŸ¥è¯¢å‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LDAP://test.com/DC=test.com,CN=microsoftdns,DC=DomainDnsZones,DC=test,DC=com
(&amp;(!(objectClass=DnsZone))(!(DC=@))(!(DC=*arpa))(!(DC=*DNSZones)))
</code></pre></div></div>

<h4 id="2é€šè¿‡dnsæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºå¯¹åº”çš„ip">(2)é€šè¿‡DNSæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºå¯¹åº”çš„IP</h4>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Dns.GetHostEntry</code>æ–¹æ³•ï¼Œå‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/dotnet/api/system.net.dns.gethostentry?redirectedfrom=MSDN&amp;view=netframework-3.5#System_Net_Dns_GetHostEntry_System_String_</p>

<h3 id="2dns-dumpçš„å®ç°åŸç†">2.dns-dumpçš„å®ç°åŸç†</h3>

<p>å…ˆé€šè¿‡LDAPæŸ¥è¯¢è·å¾—DNSè®°å½•ï¼Œå¯¹äºŒè¿›åˆ¶çš„DNSè®°å½•è¿›è¡Œè§£ç ï¼Œè·å¾—å®é™…å†…å®¹</p>

<p>DNSè®°å½•è§£ç çš„ç»†èŠ‚å¯å‚è€ƒï¼š</p>

<p>https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1#L483</p>

<h2 id="0x03-å¼€æºçš„å·¥å…·å’Œæ–¹æ³•">0x03 å¼€æºçš„å·¥å…·å’Œæ–¹æ³•</h2>
<hr />

<p>æµ‹è¯•ç¯å¢ƒï¼š</p>

<ul>
  <li>test.com</li>
  <li>Server2012 R2</li>
</ul>

<h3 id="1å…ˆé€šè¿‡ldapæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºçš„åç§°å†é€šè¿‡dnsæŸ¥è¯¢è·å¾—å¯¹åº”çš„ip">1.å…ˆé€šè¿‡LDAPæŸ¥è¯¢è·å¾—åŸŸå†…è®¡ç®—æœºçš„åç§°ï¼Œå†é€šè¿‡DNSæŸ¥è¯¢è·å¾—å¯¹åº”çš„IP</h3>

<h4 id="1sharpadidnsdump">(1)SharpAdidnsdump</h4>

<p>https://github.com/b4rtik/SharpAdidnsdump</p>

<p>C#å®ç°ï¼Œç”¨äºæŸ¥è¯¢DNSè®°å½•</p>

<p>ç”¨æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SharpAdidnsdump test.com
</code></pre></div></div>

<p>è·å¾—çš„ç»“æœå®Œæ•´ï¼ŒåŒdnscmdçš„ç»“æœä¸€è‡´</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>dnscmdçš„ç”¨æ³•å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-DNS%E8%AE%B0%E5%BD%95%E7%9A%84%E8%8E%B7%E5%8F%96">ã€ŠåŸŸæ¸—é€â€”â€”DNSè®°å½•çš„è·å–ã€‹</a></p>

<h4 id="2adidnsdump">(2)adidnsdump</h4>

<p>https://github.com/dirkjanm/adidnsdump</p>

<p>https://dirkjanm.io/getting-in-the-zone-dumping-active-directory-dns-with-adidnsdump/</p>

<p>Pythonå®ç°ï¼Œç”¨äºæŸ¥è¯¢DNSè®°å½•</p>

<p>é€‚ç”¨äºLinuxï¼Œç”±äºéœ€è¦å®‰è£…impacketï¼Œå› æ­¤æ— æ³•ç›´æ¥åœ¨Windowsç³»ç»Ÿä¸‹ä½¿ç”¨</p>

<p>å®‰è£…æ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/SecureAuthCorp/impacket.git
cd impacket
pip install .
cd ..
git clone https://github.com/dirkjanm/adidnsdump
cd adidnsdump
pip install .
</code></pre></div></div>

<p>éœ€è¦å…ˆè·å¾—ä¸€ä¸ªåŸŸç”¨æˆ·çš„å‡­æ®(æ˜æ–‡å£ä»¤æˆ–NTLM hash)</p>

<p>ç”¨æ³•1.ç›´æ¥è¿œç¨‹æŸ¥è¯¢ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adidnsdump -u test\\testuser1 -p test123! dc.test.com -r
</code></pre></div></div>

<p>ç”¨æ³•2.é€šè¿‡socksä»£ç†è¿›è¡ŒæŸ¥è¯¢ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxychains adidnsdump -u test\\testuser1 -p test123! dc.test.com -r --dns-tcp
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>è¿˜å¯ä»¥ä½¿ç”¨NTLM hashä½œä¸ºç™»å½•å‡­æ®</p>

<h3 id="2å…ˆé€šè¿‡ldapæŸ¥è¯¢è·å¾—dnsè®°å½•å¯¹äºŒè¿›åˆ¶çš„dnsè®°å½•è¿›è¡Œè§£ç è·å¾—å®é™…å†…å®¹">2.å…ˆé€šè¿‡LDAPæŸ¥è¯¢è·å¾—DNSè®°å½•ï¼Œå¯¹äºŒè¿›åˆ¶çš„DNSè®°å½•è¿›è¡Œè§£ç ï¼Œè·å¾—å®é™…å†…å®¹</h3>

<h4 id="1dns-dump">(1)dns-dump</h4>

<p>https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1</p>

<p>Powershellå®ç°ï¼Œç”¨äºæŸ¥è¯¢DNSè®°å½•</p>

<p>è¿™ä¸ªpowershellè„šæœ¬è¾ƒä¸ºå¤è€ï¼Œæˆ‘åœ¨æˆ‘çš„æµ‹è¯•ç¯å¢ƒServer2008R2å’ŒServer2012R2ä¸‹å‡å¤±è´¥</p>

<p>ç»è¿‡åˆ†æï¼Œéœ€è¦ä¿®æ”¹LDAPçš„æŸ¥è¯¢è¯­å¥ï¼Œæ–°çš„è„šæœ¬å·²ä¸Šä¼ è‡³githubï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-Powershell/blob/master/dns-dump.ps1</p>

<p>ç”¨æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Powershell -ep bypass -f dns-dump.ps1 -zone test.com
</code></pre></div></div>

<p>è·å¾—çš„ç»“æœå®Œæ•´ï¼ŒåŒdnscmdçš„ç»“æœä¸€è‡´</p>

<h4 id="2powerview">(2)PowerView</h4>

<p>https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</p>

<p>ä¹Ÿå¯ç”¨äºæŸ¥è¯¢DNSè®°å½•</p>

<p>å…¶ä¸­çš„Convert-DNSRecordå¯ç”¨æ¥å¯¹äºŒè¿›åˆ¶çš„DNSè®°å½•è¿›è¡Œè§£ç ï¼š</p>

<p>https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1#L1814</p>

<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import-module PowerView.ps1
Get-DNSRecord -ZoneName test.com
</code></pre></div></div>

<h3 id="3å…¶ä»–å·¥å…·">3.å…¶ä»–å·¥å…·</h3>

<h4 id="1adfind">(1)AdFind</h4>

<p>C++å®ç°(æœªå¼€æº)ï¼Œç”¨äºæŸ¥è¯¢åŸŸå†…ä¿¡æ¯</p>

<p>http://www.joeware.net/freetools/tools/adfind/index.htm</p>

<p>å¸¸ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<p>åˆ—å‡ºåŸŸæ§åˆ¶å™¨åç§°ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -sc dclist
</code></pre></div></div>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­åœ¨çº¿çš„è®¡ç®—æœºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -sc computers_active
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>å¯¹åº”çš„LDAPæŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Transformed Filter: (&amp;(objectcategory=computer)(!(useraccountcontrol:1.2.840.113556.1.4.803:=2))(pwdlastset&gt;=131932198595370000)(|(!lastlogontimestamp=*)(&amp;(lastlogontimestamp=*)(lastlogontimestamp&gt;=131932198595370000))))
</code></pre></div></div>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­åœ¨çº¿çš„è®¡ç®—æœº(åªæ˜¾ç¤ºåç§°å’Œæ“ä½œç³»ç»Ÿ)ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -sc computers_active name operatingSystem
</code></pre></div></div>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­æ‰€æœ‰è®¡ç®—æœºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -f "objectcategory=computer"
</code></pre></div></div>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­æ‰€æœ‰è®¡ç®—æœº(åªæ˜¾ç¤ºåç§°å’Œæ“ä½œç³»ç»Ÿ)ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -f "objectcategory=computer" name operatingSystem
</code></pre></div></div>

<p>æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -users name
</code></pre></div></div>

<p>æŸ¥è¯¢æ‰€æœ‰GPOï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -sc gpodmp
</code></pre></div></div>

<p>æˆ–</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AdFind -gpo
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>æŸ¥è¯¢GPOå¯¹åº”ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C">ã€ŠåŸŸæ¸—é€â€”â€”åˆ©ç”¨GPOä¸­çš„è®¡åˆ’ä»»åŠ¡å®ç°è¿œç¨‹æ‰§è¡Œã€‹</a></p>

<h2 id="0x04-å°ç»“">0x04 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†å¤šç§åŸŸæ™®é€šç”¨æˆ·è·å¾—DNSè®°å½•çš„æ–¹æ³•ï¼Œé€‚ç”¨äºä¸åŒçš„ç¯å¢ƒï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒæŸäº›æƒ…å†µä¸‹AdFindçš„æŸ¥è¯¢æ•ˆç‡è¾ƒä½ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET