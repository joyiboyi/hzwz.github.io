I"ëW<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨åˆ°ç«¯å£è½¬å‘å’Œä»£ç†ã€‚</p>

<p>ç«¯å£è½¬å‘æ˜¯è½¬å‘ä¸€ä¸ªç½‘ç»œç«¯å£ä»ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹åˆ°å¦ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹çš„è¡Œä¸ºã€‚</p>

<p>å®é™…åº”ç”¨ä¸­éœ€è¦è€ƒè™‘ä¸¤ç§æƒ…å†µï¼š</p>

<ul>
  <li>Client-&gt;Transit server-&gt;Serverï¼šClientèƒ½å¤Ÿæ­£å‘è¿æ¥Transit serverã€‚Transit serverç›´æ¥è½¬å‘å³å¯</li>
  <li>Client&lt;-Transit server-&gt;Serverï¼šClientæ— æ³•æ­£å‘è¿æ¥Transit serverï¼Œä½†Transit serverèƒ½å¤Ÿåå‘è¿æ¥Clientã€‚</li>
</ul>

<p>å¦‚æœClientè¦å¯¹Serverçš„å¤šä¸ªç«¯å£è¿›è¡Œæ‰«æ(æˆ–æ˜¯å¤šä¸ªServerçš„å¤šä¸ªç«¯å£)ï¼Œé€ä¸ªé…ç½®è½¬å‘è§„åˆ™å¾ˆä¸ç°å®ã€‚</p>

<p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ä»£ç†ï¼Œé…ç½®ä¸€æ¬¡è§„åˆ™å³å¯ã€‚</p>

<p>æœ¬æ–‡å°†å¯¹å¸¸ç”¨æ–¹æ³•å’Œå·¥å…·è¿›è¡Œæ•´ç†æ€»ç»“ï¼Œåˆ†é—¨åˆ«ç±»ï¼ŒåŒºåˆ†æ­£å‘å’Œåå‘è¿æ¥ï¼ŒåŒºåˆ†è½¬å‘å’Œä»£ç†ï¼Œåˆ†æå…¶ä¸­çš„è”ç³»å’ŒåŒºåˆ«ï¼Œå¹¶ç»™å‡ºåº”ç”¨åœºæ™¯ï¼Œä»¥ä½œå‚è€ƒã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>é’ˆå¯¹Windowsç³»ç»Ÿå’ŒLinuxç³»ç»Ÿ(Ubuntuå’ŒCentOS)ä¸‹çš„æ–¹æ³•</li>
  <li>ç«¯å£è½¬å‘â€”â€”æ­£å‘è¿æ¥çš„æ–¹æ³•</li>
  <li>ç«¯å£è½¬å‘â€”â€”åå‘è¿æ¥çš„æ–¹æ³•</li>
  <li>æ­£å‘ä»£ç†çš„æ–¹æ³•</li>
  <li>åå‘ä»£ç†çš„æ–¹æ³•</li>
  <li>ä»¥ä¸Šæ–¹æ³•çš„åº”ç”¨åœºæ™¯</li>
</ul>

<p><strong>æ³¨ï¼š</strong></p>

<p>Goè¯­è¨€æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæ‰€ä»¥æœ¬æ–‡æ›´ä¾§é‡äºä»‹ç»Goè¯­è¨€å®ç°çš„å·¥å…·</p>

<h2 id="0x02-ç«¯å£è½¬å‘æ­£å‘è¿æ¥">0x02 ç«¯å£è½¬å‘â€”â€”æ­£å‘è¿æ¥</h2>
<hr />

<h3 id="0åº”ç”¨åœºæ™¯">0ã€åº”ç”¨åœºæ™¯</h3>

<h4 id="1æµé‡è½¬å‘çš„è·³æ¿">1.æµé‡è½¬å‘çš„è·³æ¿</h4>

<p>ç”¨äºéšè—çœŸå®çš„æœåŠ¡å™¨åœ°å€</p>

<p>CIA Hive Beacon Infrastructureä¸­ç«¯å£è½¬å‘ä½¿ç”¨çš„æ˜¯Linuxçš„iptables</p>

<p>å¦‚ä¸‹å›¾ä¸­çš„(2)</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/0.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä¸­è½¬æœåŠ¡å™¨çš„æ­å»ºå¯å‚è€ƒä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/CIA-Hive-Beacon-Infrastructure%E5%A4%8D%E7%8E%B01-%E4%BD%BF%E7%94%A8Apache-mod_rewrite%E5%AE%9E%E7%8E%B0http%E6%B5%81%E9%87%8F%E5%88%86%E5%8F%91">ã€ŠCIA Hive Beacon Infrastructureå¤ç°1â€”â€”ä½¿ç”¨Apache mod_rewriteå®ç°httpæµé‡åˆ†å‘ã€‹</a>å’Œ<a href="https://3gstudent.github.io/CIA-Hive-Beacon-Infrastructure%E5%A4%8D%E7%8E%B02-%E4%BD%BF%E7%94%A8Apache-mod_rewrite%E5%AE%9E%E7%8E%B0https%E6%B5%81%E9%87%8F%E5%88%86%E5%8F%91">ã€ŠCIA Hive Beacon Infrastructureå¤ç°2â€”â€”ä½¿ç”¨Apache mod_rewriteå®ç°httpsæµé‡åˆ†å‘ã€‹</a></p>

<h4 id="2å»ºç«‹é€šé“">2.å»ºç«‹é€šé“</h4>

<p>è¿æ¥å†…ç½‘æœåŠ¡å™¨çš„æŒ‡å®šç«¯å£</p>

<p>Clientèƒ½å¤Ÿæ­£å‘è¿æ¥åˆ°Transit server</p>

<h3 id="1æµ‹è¯•ç¯å¢ƒ">1ã€æµ‹è¯•ç¯å¢ƒ</h3>

<p>Client: 192.168.111.136</p>

<p>Server: 192.168.111.103</p>

<p>ç½‘ç»œè¿æ¥å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-1.png" alt="Alt text" /></p>

<p>ä½¿ç”¨ncæµ‹è¯•ç½‘ç»œè¿æ¥</p>

<p>Server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -lvp 4444
</code></pre></div></div>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -vv 192.168.111.103 4444
</code></pre></div></div>

<p>Clientè¿æ¥æˆåŠŸï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-2.png" alt="Alt text" /></p>

<h3 id="2windowsç³»ç»Ÿä¸‹çš„ç«¯å£è½¬å‘æ–¹æ³•">2ã€Windowsç³»ç»Ÿä¸‹çš„ç«¯å£è½¬å‘æ–¹æ³•</h3>

<p>Transit server: 192.168.111.132</p>

<p>ç½‘ç»œè¿æ¥å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-3.png" alt="Alt text" /></p>

<h4 id="1ä½¿ç”¨netshå®ç°ç«¯å£è½¬å‘éœ€è¦ç®¡ç†å‘˜æƒé™">1ã€ä½¿ç”¨netshå®ç°ç«¯å£è½¬å‘(éœ€è¦ç®¡ç†å‘˜æƒé™)</h4>

<p>(1)æ·»åŠ è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh interface portproxy add v4tov4 listenaddress=192.168.111.132 listenport=7777 connectaddress=192.168.111.103  connectport=4444
</code></pre></div></div>

<p>(2)æ·»åŠ é˜²ç«å¢™å…¥ç«™è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="transit test" protocol=TCP dir=in localport=7777 action=allow
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>é»˜è®¤é…ç½®å…è®¸å‡ºç«™å¹¶é˜»æŒ¡å…¥ç«™é€šä¿¡ï¼Œæ‰€ä»¥æ­¤å¤„ä»…éœ€è¦æ·»åŠ å…¥ç«™è§„åˆ™</p>

<p>æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š</p>

<p>Server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -lvp 4444
</code></pre></div></div>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -vv 192.168.111.132 7777
</code></pre></div></div>

<p>Clientè¿æ¥æˆåŠŸ</p>

<p>(3)æŸ¥çœ‹ç«¯å£è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh interface portproxy show all
</code></pre></div></div>

<p>(4)æ¸…é™¤ç«¯å£è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh interface portproxy delete v4tov4 listenaddress=192.168.111.132 listenport=7777
</code></pre></div></div>

<p>(5)æ¸…é™¤é˜²ç«å¢™è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall delete rule name="transit test"
</code></pre></div></div>

<h4 id="2ä½¿ç”¨rinetdå®ç°ç«¯å£è½¬å‘">2ã€ä½¿ç”¨rinetdå®ç°ç«¯å£è½¬å‘</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://boutell.com/rinetd/http/rinetd.zip</p>

<p>ä»…éœ€è¦å‹ç¼©åŒ…ä¸­çš„rinetd.exe</p>

<p>(1)ä¸ºrinetd.exeæ·»åŠ é˜²ç«å¢™è§„åˆ™(ç®¡ç†å‘˜æƒé™)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="transit test2" dir=in program="c:\test\rinetd.exe" action=allow
</code></pre></div></div>

<p>(2)ç¼–å†™è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 0.0.0.0 7777 192.168.111.103 4444 &gt; conf.txt
</code></pre></div></div>

<p>(3)å¯åŠ¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rinetd.exe -c c:\test\conf.txt
</code></pre></div></div>

<p>(4)æ¸…é™¤é˜²ç«å¢™è§„åˆ™(ç®¡ç†å‘˜æƒé™)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall delete rule name="transit test2" dir=in program="c:\test\rinetd.exe"
</code></pre></div></div>

<h4 id="3ä½¿ç”¨htranå®ç°ç«¯å£è½¬å‘">3ã€ä½¿ç”¨HTranå®ç°ç«¯å£è½¬å‘</h4>

<p><strong>æ³¨ï¼š</strong></p>

<p>lcxåŒå…¶åŠŸèƒ½ç±»ä¼¼</p>

<p>æºç æ¥æºäºäº’è”ç½‘ï¼Œæˆ‘åœ¨githubåšäº†å¤‡ä»½ï¼Œå¤‡ä»½åœ°å€ï¼š</p>

<p>https://raw.githubusercontent.com/3gstudent/test/master/HTran.cpp</p>

<p>(1)ä¸ºHTran.exeæ·»åŠ é˜²ç«å¢™è§„åˆ™(ç®¡ç†å‘˜æƒé™)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="transit test3" dir=in program="c:\test\HTran.exe" action=allow
</code></pre></div></div>

<p>(2)å¼€å¯è½¬å‘åŠŸèƒ½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTran.exe -tran 7777 192.168.111.103 4444
</code></pre></div></div>

<p>(3)æ¸…é™¤é˜²ç«å¢™è§„åˆ™(ç®¡ç†å‘˜æƒé™)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall delete rule name="transit test3" dir=in program="c:\test\HTran.exe"
</code></pre></div></div>

<h4 id="4ä½¿ç”¨earthwormå®ç°ç«¯å£è½¬å‘">4ã€ä½¿ç”¨EarthWormå®ç°ç«¯å£è½¬å‘</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/rootkiter/EarthWorm</p>

<p>(1)ä¸ºew_for_win_32.exeæ·»åŠ é˜²ç«å¢™è§„åˆ™(ç®¡ç†å‘˜æƒé™)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="transit test4" dir=in program="c:\test\ew_for_win_32.exe" action=allow
</code></pre></div></div>

<p>(2)å¼€å¯è½¬å‘åŠŸèƒ½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew_for_win_32.exe -s lcx_tran -l 7777 -f 192.168.111.103 -g 4444
</code></pre></div></div>

<p>(3)æ¸…é™¤é˜²ç«å¢™è§„åˆ™(ç®¡ç†å‘˜æƒé™)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall delete rule name="transit test4" dir=in program="c:\test\ew_for_win_32.exe"
</code></pre></div></div>

<h3 id="3linuxç³»ç»Ÿubuntuä¸‹çš„å¸¸ç”¨ç«¯å£è½¬å‘æ–¹æ³•">3ã€Linuxç³»ç»Ÿ(Ubuntu)ä¸‹çš„å¸¸ç”¨ç«¯å£è½¬å‘æ–¹æ³•</h3>

<p>Transit server: 192.168.111.102</p>

<p>ç½‘ç»œè¿æ¥å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-4.png" alt="Alt text" /></p>

<h4 id="1ä½¿ç”¨iptableså®ç°ç«¯å£è½¬å‘">1ã€ä½¿ç”¨iptableså®ç°ç«¯å£è½¬å‘</h4>

<p>(1)å¼€å¯è½¬å‘åŠŸèƒ½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 1 &gt;/proc/sys/net/ipv4/ip_forward
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>è¯¥å‘½ä»¤ç«‹å³ç”Ÿæ•ˆï¼Œé‡å¯å¤±æ•ˆ</p>

<p>(2)æ·»åŠ è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -t nat -A PREROUTING -p tcp -d 192.168.111.102 --dport 8888 -j DNAT --to-destination 192.168.111.103:4444
iptables -t nat -A POSTROUTING -p tcp -d 192.168.111.103 --dport 4444 -j SNAT --to-source 192.168.111.102
</code></pre></div></div>

<p>(3)æŸ¥çœ‹è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -L -t nat --line-number
</code></pre></div></div>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-5.png" alt="Alt text" /></p>

<p>æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š</p>

<p>Server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -lvp 4444
</code></pre></div></div>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -vv 192.168.111.102 8888
</code></pre></div></div>

<p>Clientè¿æ¥æˆåŠŸ</p>

<p>(4)æ¸…é™¤è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -F -t nat
</code></pre></div></div>

<p>(5)ä¿å­˜è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables-save &gt; /etc/iptables.up.rules
</code></pre></div></div>

<p>(6)æ¢å¤è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables-restore &lt; /etc/iptables.up.rules
</code></pre></div></div>

<h4 id="2ä½¿ç”¨rinetdå®ç°ç«¯å£è½¬å‘-1">2ã€ä½¿ç”¨rinetdå®ç°ç«¯å£è½¬å‘</h4>

<p>(1)ç¼–è¯‘å®‰è£…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://www.boutell.com/rinetd/http/rinetd.tar.gz
tar zxvf rinetd.tar.gz
cd rinetd
make
</code></pre></div></div>

<p>(2)ç¼–å†™è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 0.0.0.0 8888 192.168.111.103 4444 &gt; /etc/rinetd.conf
</code></pre></div></div>

<p>(3)å¯åŠ¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./rinetd.exe
</code></pre></div></div>

<p>(4)ç»“æŸè¿›ç¨‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkill -9 rinetd
</code></pre></div></div>

<h4 id="3ä½¿ç”¨htranå®ç°ç«¯å£è½¬å‘-1">3ã€ä½¿ç”¨HTranå®ç°ç«¯å£è½¬å‘</h4>

<p>Linuxç‰ˆHTran(lcx)çš„æºç å‚è€ƒå¦‚ä¸‹åœ°å€ï¼š</p>

<p>https://github.com/windworst/LCX</p>

<p>éœ€è¦ä½¿ç”¨gccé‡æ–°ç¼–è¯‘</p>

<p>(1)å¼€å¯è½¬å‘åŠŸèƒ½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./lcx -tran 8888 192.168.111.103 4444
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>goè¯­è¨€ç¼–å†™çš„HTran(lcx)ï¼Œä¼˜ç‚¹æ˜¯è·¨å¹³å°ï¼Œæ”¯æŒWindowså’ŒLinux</p>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/cw1997/NATBypass</p>

<h4 id="4ä½¿ç”¨earthwormå®ç°ç«¯å£è½¬å‘-1">4ã€ä½¿ç”¨EarthWormå®ç°ç«¯å£è½¬å‘</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/rootkiter/EarthWorm</p>

<p>æœªå¼€æº</p>

<p>(1)å¼€å¯è½¬å‘åŠŸèƒ½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ew_for_linux -s lcx_tran -l 8888 -f 192.168.111.103 -g 4444
</code></pre></div></div>

<h3 id="4linuxç³»ç»Ÿcentosä¸‹çš„å¸¸ç”¨ç«¯å£è½¬å‘æ–¹æ³•">4ã€Linuxç³»ç»Ÿ(CentOS)ä¸‹çš„å¸¸ç”¨ç«¯å£è½¬å‘æ–¹æ³•</h3>

<p>Transit server: 192.168.111.105</p>

<p>ç½‘ç»œè¿æ¥å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-6.png" alt="Alt text" /></p>

<h4 id="1ä½¿ç”¨iptableså®ç°ç«¯å£è½¬å‘-1">1ã€ä½¿ç”¨iptableså®ç°ç«¯å£è½¬å‘</h4>

<p>(1)å¼€å¯è½¬å‘åŠŸèƒ½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 1 &gt;/proc/sys/net/ipv4/ip_forward
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>è¯¥å‘½ä»¤ç«‹å³ç”Ÿæ•ˆï¼Œç³»ç»Ÿé‡å¯å¤±æ•ˆ</p>

<p>(2)å®‰è£…iptables</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop firewalld  
systemctl mask firewalld  
yum install iptables-services
systemctl enable iptables
</code></pre></div></div>

<p>(3)æ·»åŠ è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -t nat -A PREROUTING -p tcp -d 192.168.111.105 --dport 8888 -j DNAT --to-destination 192.168.111.103:4444
iptables -t nat -A POSTROUTING -p tcp -d 192.168.111.103 --dport 4444 -j SNAT --to-source 192.168.111.105
service iptables save
service iptables restart
service iptables status
</code></pre></div></div>

<p>(4)æŸ¥çœ‹è½¬å‘è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -L -t nat --line-number
</code></pre></div></div>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/2-7.png" alt="Alt text" /></p>

<p>æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š</p>

<p>Server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -lvp 4444
</code></pre></div></div>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -vv 192.168.111.105 8888
</code></pre></div></div>

<p>Clientè¿æ¥æˆåŠŸ</p>

<p>(4)æ¸…é™¤è§„åˆ™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -F -t nat
</code></pre></div></div>

<h4 id="2ä½¿ç”¨rinetdå®ç°ç«¯å£è½¬å‘-2">2ã€ä½¿ç”¨rinetdå®ç°ç«¯å£è½¬å‘</h4>

<p>åŒUbuntuï¼Œæ­¤å¤„çœç•¥</p>

<h4 id="3ä½¿ç”¨htranå®ç°ç«¯å£è½¬å‘-2">3ã€ä½¿ç”¨HTranå®ç°ç«¯å£è½¬å‘</h4>

<p>åŒUbuntuï¼Œæ­¤å¤„çœç•¥</p>

<h4 id="4ä½¿ç”¨earthwormå®ç°ç«¯å£è½¬å‘-2">4ã€ä½¿ç”¨EarthWormå®ç°ç«¯å£è½¬å‘</h4>

<p>åŒUbuntuï¼Œæ­¤å¤„çœç•¥</p>

<h2 id="0x03-ç«¯å£è½¬å‘åå‘è¿æ¥">0x03 ç«¯å£è½¬å‘â€”â€”åå‘è¿æ¥</h2>
<hr />

<h3 id="0åº”ç”¨åœºæ™¯-1">0ã€åº”ç”¨åœºæ™¯</h3>

<h4 id="1å»ºç«‹é€šé“">1.å»ºç«‹é€šé“</h4>

<p>è¿æ¥å†…ç½‘æœåŠ¡å™¨çš„æŒ‡å®šç«¯å£</p>

<p>æµ‹è¯•ç¯å¢ƒå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/3-1.png" alt="Alt text" /></p>

<p>å·²æœ‰Transit serveræƒé™ï¼Œæƒ³è¦è®¿é—®Serverçš„3389ç«¯å£</p>

<p>Clientæ— æ³•æ­£å‘è¿æ¥åˆ°Transit serverï¼Œä½†Transit serverèƒ½å¤Ÿåå‘è¿æ¥åˆ°Client</p>

<p>iptableså’Œrinetdä¸å†é€‚ç”¨</p>

<h4 id="1ä½¿ç”¨htran">1ã€ä½¿ç”¨HTran</h4>

<p>æ”¯æŒWindowså’ŒLinux</p>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTran -listen 1111 2222
</code></pre></div></div>

<p>Transit server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTran -slave 1.1.1.1 1111 10.0.0.2 3389
</code></pre></div></div>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -vv 127.0.0.1 2222
</code></pre></div></div>

<h4 id="2ä½¿ç”¨earthworm">2ã€ä½¿ç”¨EarthWorm</h4>

<p>æ”¯æŒWindowså’ŒLinux</p>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew -s lcx_listen -l 2222 -e 1111
</code></pre></div></div>

<p>Transit server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew -s lcx_slave -d 1.1.1.1 -e 1111 -f 10.0.0.2 -g 3389
</code></pre></div></div>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -vv 127.0.0.1 2222
</code></pre></div></div>

<h2 id="0x04-æ­£å‘ä»£ç†">0x04 æ­£å‘ä»£ç†</h2>
<hr />

<h3 id="0åº”ç”¨åœºæ™¯-2">0ã€åº”ç”¨åœºæ™¯</h3>

<h4 id="1å†…ç½‘æ‰«æ">1.å†…ç½‘æ‰«æ</h4>

<p>å¯¹å†…ç½‘çš„å¤šä¸ªç«¯å£è¿›è¡Œæ‰«æ</p>

<p>Clientèƒ½å¤Ÿæ­£å‘è¿æ¥åˆ°Transit server</p>

<p>æµ‹è¯•ç¯å¢ƒå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/3-2.png" alt="Alt text" /></p>

<p>è¦å¯¹Server1ã€Server2å’ŒServer3çš„ç«¯å£è¿›è¡Œæ‰«æ</p>

<p>Socks4ä»£ç†åªæ”¯æŒTCPåè®®ï¼Œè€ŒSocks5ä»£ç†æ”¯æŒTCPåè®®å’ŒUDPåè®®ï¼Œæ›´åŠ å…¨é¢ï¼Œæ‰€ä»¥æœ¬æ–‡åªä»‹ç»å®ç°Socks5ä»£ç†çš„æ–¹æ³•</p>

<h4 id="1ä½¿ç”¨htran-1">1ã€ä½¿ç”¨HTran</h4>

<p>ç½‘ä¸Šæµä¼ HTran2.4æ”¯æŒSocks5ä»£ç†ï¼Œä½†æˆ‘æœªæ‰¾åˆ°å¼€æºä»£ç ï¼Œæ­¤å¤„ä½œä¸€ä¸ªæ ‡è®°</p>

<h4 id="2ä½¿ç”¨earthworm-1">2ã€ä½¿ç”¨EarthWorm</h4>

<p>Transit server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew â€“s ssocksd â€“l 8888
</code></pre></div></div>

<p>Clientä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥Transit serverçš„8888ç«¯å£</p>

<h4 id="3ä½¿ç”¨goproxy">3ã€ä½¿ç”¨goproxy</h4>

<p>goå®ç°çš„é«˜æ€§èƒ½http,https,websocket,tcp,udp,socks5,ssä»£ç†æœåŠ¡å™¨,æ”¯æŒæ­£å‘ä»£ç†ã€åå‘ä»£ç†ã€é€æ˜ä»£ç†ã€å†…ç½‘ç©¿é€ã€TCP/UDPç«¯å£æ˜ å°„ã€SSHä¸­è½¬</p>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/snail007/goproxy/</p>

<p>Transit server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxy socks -t tcp -p "0.0.0.0:8888"
</code></pre></div></div>

<p>Clientä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥Transit serverçš„8888ç«¯å£</p>

<h3 id="4è‡ªå·±ä½¿ç”¨goå®ç°">4ã€è‡ªå·±ä½¿ç”¨goå®ç°</h3>

<p>Windowsç³»ç»Ÿå®‰è£…Goï¼š</p>

<p>https://golang.org/dl/</p>

<p>å®‰è£…gitï¼š</p>

<p>http://git-scm.com/downloads</p>

<p>å®‰è£…go-socks5ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go get github.com/armon/go-socks5
go build
</code></pre></div></div>

<p>test.go:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package main
import socks5 "github.com/armon/go-socks5"
func main() {
        conf := &amp;socks5.Config{}
        server, err := socks5.New(conf)
        if err != nil {
          panic(err)
        }
        if err := server.ListenAndServe("tcp", "0.0.0.0:8888"); err != nil {
          panic(err)
        }
}
</code></pre></div></div>

<p>ç¼–è¯‘</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go build test.go
</code></pre></div></div>

<p>Clientä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥Transit serverçš„8888ç«¯å£</p>

<h4 id="5ä½¿ç”¨regeorg">5ã€ä½¿ç”¨reGeorg</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/NoneNotNull/reGeorg</p>

<table>
  <tbody>
    <tr>
      <td>é’ˆå¯¹webæœåŠ¡å™¨ï¼Œæ”¯æŒ(aspx</td>
      <td>ashx</td>
      <td>jsp</td>
      <td>php)</td>
    </tr>
  </tbody>
</table>

<p><strong>æ³¨ï¼š</strong></p>

<p>Windowsä¸‹è¿æ¥socksä»£ç†çš„å·¥å…·å¯ä½¿ç”¨sockscap64</p>

<p>Linuxä¸‹è¿æ¥socksä»£ç†çš„å·¥å…·å¯ä½¿ç”¨proxychains</p>

<h2 id="0x05-åå‘ä»£ç†">0x05 åå‘ä»£ç†</h2>
<hr />

<h3 id="0åº”ç”¨åœºæ™¯-3">0ã€åº”ç”¨åœºæ™¯</h3>

<h4 id="1å†…ç½‘æ‰«æ-1">1.å†…ç½‘æ‰«æ</h4>

<p>å¯¹å†…ç½‘çš„å¤šä¸ªç«¯å£è¿›è¡Œæ‰«æ</p>

<p>æµ‹è¯•ç¯å¢ƒå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-10-7/3-3.png" alt="Alt text" /></p>

<p>Clientæ— æ³•æ­£å‘è¿æ¥åˆ°Transit serverï¼Œä½†Transit serverèƒ½å¤Ÿåå‘è¿æ¥åˆ°Client</p>

<p>è¦å¯¹Server1ã€Server2å’ŒServer3çš„ç«¯å£è¿›è¡Œæ‰«æ</p>

<h4 id="1ä½¿ç”¨earthworm">1ã€ä½¿ç”¨EarthWorm</h4>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew -s rcsocks -l 2222 -e 1111
</code></pre></div></div>

<p>Transit server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ew -s rssocks -d 1.1.1.1 -e 1111
</code></pre></div></div>

<p>ä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥Clientçš„2222ç«¯å£</p>

<h4 id="2ä½¿ç”¨rsocks">2ã€ä½¿ç”¨rsocks</h4>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://github.com/brimstone/rsocks</p>

<p>Goè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒWindowså’ŒLinux</p>

<p>Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsocks -listen :1111 -socks 127.0.0.1:2222
</code></pre></div></div>

<p>Transit server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsocks -connect 1.1.1.1:1111
</code></pre></div></div>

<p>ä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥Clientçš„2222ç«¯å£</p>

<h2 id="0x06-å°ç»“">0x06 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡å¯¹ç«¯å£è½¬å‘å’Œä»£ç†çš„å¸¸ç”¨å·¥å…·å’Œæ–¹æ³•è¿›è¡Œæ•´ç†æ€»ç»“ï¼Œåˆ’åˆ†æ­£å‘å’Œåå‘è¿æ¥ä¸¤ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«ä»‹ç»äº†åº”ç”¨åœºæ™¯å’Œå¸¸ç”¨å·¥å…·ï¼Œå¯ä½œä¸ºå®é™…åº”ç”¨çš„å‚è€ƒã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET