I"“9<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>Cobalt Strike 3.11ä¸­ï¼ŒåŠ å…¥äº†ä¸€ä¸ªåä¸ºâ€execute-assemblyâ€çš„å‘½ä»¤ï¼Œèƒ½å¤Ÿä»å†…å­˜ä¸­åŠ è½½.NETç¨‹åºé›†ã€‚è¿™ä¸ªåŠŸèƒ½ä¸éœ€è¦å‘ç¡¬ç›˜å†™å…¥æ–‡ä»¶ï¼Œååˆ†éšè”½ï¼Œè€Œä¸”ç°æœ‰çš„Powershellåˆ©ç”¨è„šæœ¬èƒ½å¤Ÿå¾ˆå®¹æ˜“çš„è½¬æ¢ä¸ºC#ä»£ç ï¼Œååˆ†æ–¹ä¾¿ã€‚</p>

<p>æœ¬æ–‡å°†ä¼šå¯¹â€execute-assemblyâ€çš„åŸç†è¿›è¡Œä»‹ç»ï¼Œç»“åˆå¤šä¸ªå¼€æºä»£ç ï¼Œä»‹ç»å®ç°æ–¹æ³•ï¼Œåˆ†æåˆ©ç”¨æ€è·¯ï¼Œæœ€åç»™å‡ºé˜²å¾¡å»ºè®®</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>åŸºç¡€çŸ¥è¯†</li>
  <li>æ­£å¸¸çš„å®ç°æ–¹æ³•</li>
  <li>å¼€æºåˆ©ç”¨ä»£ç åˆ†æ</li>
  <li>åˆ©ç”¨æ€è·¯</li>
  <li>é˜²å¾¡å»ºè®®</li>
</ul>

<h2 id="0x02-åŸºç¡€çŸ¥è¯†">0x02 åŸºç¡€çŸ¥è¯†</h2>
<hr />

<h3 id="1clr">1.CLR</h3>

<p>å…¨ç§°Common Language Runtimeï¼ˆå…¬å…±è¯­è¨€è¿è¡Œåº“ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¯ç”±å¤šç§ç¼–ç¨‹è¯­è¨€ä½¿ç”¨çš„è¿è¡Œç¯å¢ƒ</p>

<p>CLRæ˜¯.NET Frameworkçš„ä¸»è¦æ‰§è¡Œå¼•æ“ï¼Œä½œç”¨ä¹‹ä¸€æ˜¯ç›‘è§†ç¨‹åºçš„è¿è¡Œï¼š</p>

<ul>
  <li>åœ¨CLRç›‘è§†ä¹‹ä¸‹è¿è¡Œçš„ç¨‹åºå±äºâ€æ‰˜ç®¡çš„â€(managed)ä»£ç </li>
  <li>ä¸åœ¨CLRä¹‹ä¸‹ã€ç›´æ¥åœ¨è£¸æœºä¸Šè¿è¡Œçš„åº”ç”¨æˆ–è€…ç»„ä»¶å±äºâ€éæ‰˜ç®¡çš„â€(unmanaged)çš„ä»£ç </li>
</ul>

<h3 id="2unmanaged-api">2.Unmanaged API</h3>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/dotnet/framework/unmanaged-api/</p>

<p>ç”¨äºå°†.NET ç¨‹åºé›†åŠ è½½åˆ°ä»»æ„ç¨‹åºä¸­çš„API</p>

<p>æ”¯æŒä¸¤ç§æ¥å£ï¼š</p>

<ul>
  <li>ICorRuntimeHost Interface</li>
  <li>ICLRRuntimeHost Interface</li>
</ul>

<h3 id="3icorruntimehost-interface">3.ICorRuntimeHost Interface</h3>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/dotnet/framework/unmanaged-api/hosting/icorruntimehost-interface</p>

<p>æ”¯æŒv1.0.3705, v1.1.4322, v2.0.50727å’Œv4.0.30319</p>

<h3 id="4iclrruntimehost-interface">4.ICLRRuntimeHost Interface</h3>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/dotnet/framework/unmanaged-api/hosting/iclrruntimehost-interface</p>

<p>æ”¯æŒv2.0.50727å’Œv4.0.30319</p>

<p>åœ¨.NET Framework 2.0ä¸­ï¼ŒICLRRuntimeHostç”¨äºå–ä»£ICorRuntimeHost</p>

<p>åœ¨å®é™…ç¨‹åºå¼€å‘ä¸­ï¼Œå¾ˆå°‘ä¼šè€ƒè™‘.NET Framework 1.0ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ¥å£éƒ½å¯ä»¥ä½¿ç”¨</p>

<h2 id="0x03-æ­£å¸¸çš„å®ç°æ–¹æ³•">0x03 æ­£å¸¸çš„å®ç°æ–¹æ³•</h2>
<hr />

<p>ä½¿ç”¨çš„å®ä¾‹ä»£ç ï¼š</p>

<p>https://code.msdn.microsoft.com/windowsdesktop/CppHostCLR-e6581ee0#content</p>

<p>è¿™é‡Œå°†å‚è€ƒå®ä¾‹ä»£ç å¹¶åšè¡¥å……</p>

<p>é€šç”¨çš„å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<h4 id="1å°†clråŠ è½½åˆ°è¿›ç¨‹ä¸­">1.å°†CLRåŠ è½½åˆ°è¿›ç¨‹ä¸­</h4>

<p>(1)è°ƒç”¨CLRCreateInstanceå‡½æ•°ä»¥è·å–ICLRMetaHostæˆ–ICLRMetaHostPolicyæ¥å£</p>

<p>(2)è°ƒç”¨ICLRMetaHost::EnumerateInstalledRuntimes, ICLRMetaHost::GetRuntimeæˆ–è€…ICLRMetaHostPolicy::GetRequestedRuntimeæ–¹æ³•ä»¥è·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆ</p>

<p>ä¸‰ä¸ªä»»é€‰ä¸€ä¸ª</p>

<p>(3)ä½¿ç”¨ICorRuntimeHostæˆ–è€…ICLRRuntimeHost</p>

<p>äºŒè€…éƒ½æ˜¯è°ƒç”¨ICLRRuntimeInfo::GetInterfaceæ–¹æ³•ï¼Œä½†æ˜¯å‚æ•°ä¸åŒ</p>

<p><strong>ICorRuntimeHostï¼š</strong></p>

<p>æ”¯æŒv1.0.3705, v1.1.4322, v2.0.50727å’Œv4.0.30319</p>

<p>æŒ‡å®šCLSID_CorRuntimeHostä¸ºrclsidå‚æ•°</p>

<p>æŒ‡å®šIID_ICorRuntimeHostä¸ºRIIDå‚æ•°</p>

<p><strong>ICLRRuntimeHostï¼š</strong></p>

<p>æ”¯æŒv2.0.50727å’Œv4.0.30319</p>

<p>æŒ‡å®šCLSID_CLRRuntimeHostä¸ºrclsidå‚æ•°</p>

<p>æŒ‡å®šIID_ICLRRuntimeHostä¸ºRIIDå‚æ•°</p>

<h4 id="2åŠ è½½netç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•">2.åŠ è½½.NETç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•</h4>

<p>åœ¨ä»£ç å®ç°ä¸Šï¼Œä½¿ç”¨ICLRRuntimeHostä¼šæ¯”ä½¿ç”¨ICorRuntimeHostç®€å•çš„å¤š</p>

<h4 id="3æ¸…ç†clr">3.æ¸…ç†CLR</h4>

<p>é‡Šæ”¾æ­¥éª¤1ä¸­çš„æŒ‡é’ˆ</p>

<p>ä¸‹é¢ä½¿ç”¨ICLRMetaHost::GetRuntimeè·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆï¼Œä½¿ç”¨ICLRRuntimeHostä»æ–‡ä»¶åŠ è½½.NETç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "stdafx.h"
#include &lt;metahost.h&gt;
#include &lt;windows.h&gt;
#pragma comment(lib, "MSCorEE.lib")

HRESULT RuntimeHost_GetRuntime_ICLRRuntimeInfo(PCWSTR pszVersion, PCWSTR pszAssemblyName, PCWSTR pszClassName, PCWSTR pszMethodName, PCWSTR pszArgName)
{
	// Call the ICLRMetaHost::GetRuntime to get a valid ICLRRuntimeInfo.
	// Call the ICLRRuntimeInfo:GetInterface method.
	HRESULT hr;
	ICLRMetaHost *pMetaHost = NULL;
	ICLRRuntimeInfo *pRuntimeInfo = NULL;
	ICLRRuntimeHost *pClrRuntimeHost = NULL;
	DWORD dwLengthRet;
	// 
	// Load and start the .NET runtime.
	// 
	wprintf(L"Load and start the .NET runtime %s \n", pszVersion);
	hr = CLRCreateInstance(CLSID_CLRMetaHost, IID_PPV_ARGS(&amp;pMetaHost));
	if (FAILED(hr))
	{
		wprintf(L"[!]CLRCreateInstance failed w/hr 0x%08lx\n", hr);
		goto Cleanup;
	}
	// Get the ICLRRuntimeInfo corresponding to a particular CLR version. It 
	// supersedes CorBindToRuntimeEx with STARTUP_LOADER_SAFEMODE.
	hr = pMetaHost-&gt;GetRuntime(pszVersion, IID_PPV_ARGS(&amp;pRuntimeInfo));
	if (FAILED(hr))
	{
		wprintf(L"[!]ICLRMetaHost::GetRuntime failed w/hr 0x%08lx\n", hr);
		goto Cleanup;
	}
	// Check if the specified runtime can be loaded into the process. This 
	// method will take into account other runtimes that may already be 
	// loaded into the process and set pbLoadable to TRUE if this runtime can 
	// be loaded in an in-process side-by-side fashion. 
	BOOL fLoadable;
	hr = pRuntimeInfo-&gt;IsLoadable(&amp;fLoadable);
	if (FAILED(hr))
	{
		wprintf(L"[!]ICLRRuntimeInfo::IsLoadable failed w/hr 0x%08lx\n", hr);
		goto Cleanup;
	}
	if (!fLoadable)
	{
		wprintf(L"[!].NET runtime %s cannot be loaded\n", pszVersion);
		goto Cleanup;
	}
	// Load the CLR into the current process and return a runtime interface 
	// pointer. ICorRuntimeHost and ICLRRuntimeHost are the two CLR hosting  
	// interfaces supported by CLR 4.0. Here we demo the ICLRRuntimeHost 
	// interface that was provided in .NET v2.0 to support CLR 2.0 new 
	// features. ICLRRuntimeHost does not support loading the .NET v1.x 
	// runtimes.
	hr = pRuntimeInfo-&gt;GetInterface(CLSID_CLRRuntimeHost, IID_PPV_ARGS(&amp;pClrRuntimeHost));
	if (FAILED(hr))
	{
		wprintf(L"[!]ICLRRuntimeInfo::GetInterface failed w/hr 0x%08lx\n", hr);
		goto Cleanup;
	}
	// Start the CLR.
	hr = pClrRuntimeHost-&gt;Start();
	if (FAILED(hr))
	{
		wprintf(L"[!]CLR failed to start w/hr 0x%08lx\n", hr);
		goto Cleanup;
	}
	// 
	// Load the NET assembly and call the static method.
	// 
	wprintf(L"[+]Load the assembly %s\n", pszAssemblyName);
	// The invoked method of ExecuteInDefaultAppDomain must have the 
	// following signature: static int pwzMethodName (String pwzArgument)
	// where pwzMethodName represents the name of the invoked method, and 
	// pwzArgument represents the string value passed as a parameter to that 
	// method. If the HRESULT return value of ExecuteInDefaultAppDomain is 
	// set to S_OK, pReturnValue is set to the integer value returned by the 
	// invoked method. Otherwise, pReturnValue is not set.
	hr = pClrRuntimeHost-&gt;ExecuteInDefaultAppDomain(pszAssemblyName, pszClassName, pszMethodName, pszArgName, &amp;dwLengthRet);
	if (FAILED(hr))
	{
		wprintf(L"[!]Failed to call %s w/hr 0x%08lx\n", pszMethodName, hr);
		goto Cleanup;
	}
	// Print the call result of the static method.
	wprintf(L"[+]Call %s.%s(\"%s\") =&gt; %d\n", pszClassName, pszMethodName, pszArgName, dwLengthRet);

Cleanup:
	if (pMetaHost)
	{
		pMetaHost-&gt;Release();
		pMetaHost = NULL;
	}
	if (pRuntimeInfo)
	{
		pRuntimeInfo-&gt;Release();
		pRuntimeInfo = NULL;
	}
	if (pClrRuntimeHost)
	{
		// Please note that after a call to Stop, the CLR cannot be 
		// reinitialized into the same process. This step is usually not 
		// necessary. You can leave the .NET runtime loaded in your process.
		//wprintf(L"Stop the .NET runtime\n");
		//pClrRuntimeHost-&gt;Stop();
		pClrRuntimeHost-&gt;Release();
		pClrRuntimeHost = NULL;
	}
	return hr;
}

int main()
{
	RuntimeHost_GetRuntime_ICLRRuntimeInfo(L"v4.0.30319", L"ClassLibrary1.dll", L"ClassLibrary1.Class1", L"TestMethod", L"argstring");
	return 0;
}
</code></pre></div></div>

<p>ä»£ç å°†ä¼šåŠ è½½åŒçº§ç›®å½•ä¸‹.Net4.0å¼€å‘çš„ClassLibrary1.dllï¼Œç±»åä¸ºClass1ï¼Œæ–¹æ³•ä¸ºTestMethodï¼Œä¼ å…¥çš„å‚æ•°ä¸ºargstring</p>

<p>ClassLibrary1.dllçš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ClassLibrary1
{
    public class Class1
    {
        public static int TestMethod(string str)
        {
            System.Diagnostics.Process p = new System.Diagnostics.Process();
            p.StartInfo.FileName = "c:\\windows\\system32\\calc.exe";
            p.Start();
            return 0;
        }
    }
}
</code></pre></div></div>

<h2 id="0x04-å¼€æºåˆ©ç”¨ä»£ç åˆ†æ">0x04 å¼€æºåˆ©ç”¨ä»£ç åˆ†æ</h2>
<hr />

<h3 id="1unmanaged-clr-hosting-assembly-loader">1ã€Unmanaged CLR Hosting Assembly loader</h3>

<p>https://github.com/caseysmithrc/AssemblyLoader</p>

<p>åˆ©ç”¨CLRä»ä»£ç ä¸­å®šä¹‰å¥½çš„æ•°ç»„è¯»å–shellcodeï¼ŒåŠ è½½åˆ°å†…å­˜å¹¶æ‰§è¡Œ</p>

<p>å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<h4 id="1å°†clråŠ è½½åˆ°è¿›ç¨‹ä¸­-1">1.å°†CLRåŠ è½½åˆ°è¿›ç¨‹ä¸­</h4>

<p>(1)è°ƒç”¨CLRCreateInstanceå‡½æ•°ä»¥è·å–ICLRMetaHostæˆ–ICLRMetaHostPolicyæ¥å£</p>

<p>(2)è°ƒç”¨ICLRMetaHost::GetRuntimeæ–¹æ³•ä»¥è·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆ</p>

<p>(3)ä½¿ç”¨ICorRuntimeHost</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>åœ¨ä½¿ç”¨ICorRuntimeHostæ—¶ï¼Œéœ€è¦æ·»åŠ å¯¹mscorlib.tlbçš„å¼•ç”¨ï¼Œc++ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Import mscorlib.tlb (Microsoft Common Language Runtime Class Library).
#import "mscorlib.tlb" raw_interfaces_only				\
    high_property_prefixes("_get","_put","_putref")		\
    rename("ReportEvent", "InteropServices_ReportEvent")
using namespace mscorlib;
#pragma endregion
</code></pre></div></div>

<p>åœ¨ICorRuntimeHostä¸­ï¼Œä»æ–‡ä»¶è¯»å–å¹¶åŠ è½½.NETç¨‹åºé›†çš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  virtual HRESULT __stdcall Load_2 (
    /*[in]*/ BSTR assemblyString,
    /*[out,retval]*/ struct _Assembly * * pRetVal ) = 0;
</code></pre></div></div>

<p>ä»å†…å­˜ä¸­è¯»å–å¹¶åŠ è½½.NETç¨‹åºé›†çš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  virtual HRESULT __stdcall Load_3 (
    /*[in]*/ SAFEARRAY * rawAssembly,
    /*[out,retval]*/ struct _Assembly * * pRetVal ) = 0;
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>æ–¹æ³•å®šä¹‰æ¥è‡ªmscorlib.tlh</p>

<p>è¿™é‡Œä½¿ç”¨äº†Load_3(â€¦)ï¼Œå…ˆä»æ•°ç»„ä¸­è¯»å–shellcodeï¼Œå†åŠ è½½.NETç¨‹åºé›†</p>

<h4 id="2åŠ è½½netç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•-1">2.åŠ è½½.NETç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•</h4>

<h4 id="3æ¸…ç†clr-1">3.æ¸…ç†CLR</h4>

<h3 id="2executing-a-net-assembly-from-c-in-memory-clr-hosting">2ã€Executing a .NET Assembly from C++ in Memory (CLR Hosting)</h3>

<p>https://github.com/etormadiv/HostingCLR</p>

<p>åŒcaseysmithçš„æ–¹æ³•åŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯è°ƒç”¨ICLRMetaHost::GetRuntimeæ–¹æ³•ä»¥è·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆï¼Œä½¿ç”¨ICorRuntimeHostæ¥å£ï¼Œä½¿ç”¨Load_3(â€¦)ä»å†…å­˜ä¸­è¯»å–å¹¶åŠ è½½.NETç¨‹åºé›†</p>

<h3 id="3clr-via-native-code">3ã€CLR via native code</h3>

<p>https://gist.githubusercontent.com/xpn/e95a62c6afcf06ede52568fcd8187cc2/raw/f3498245c8309d44af38502a2cc7090c318e8adf/clr_via_native.c</p>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œè°ƒç”¨ICLRMetaHost::EnumerateInstalledRuntimesè·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆ</p>

<p>æ¥ç€ä½¿ç”¨ICLRRuntimeHostä»æ–‡ä»¶åŠ è½½.NETç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•</p>

<h3 id="4metasploit-execute-assembly">4ã€metasploit-execute-assembly</h3>

<p>https://github.com/b4rtik/metasploit-execute-assembly</p>

<p>é¦–å…ˆåˆ›å»ºè¿›ç¨‹notepad.exeï¼Œç„¶åå‘notepad.exeæ³¨å…¥HostingCLRx64.dllï¼ŒHostingCLRx64.dllå®ç°å†…å­˜åŠ è½½.Netç¨‹åºé›†</p>

<p>è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨å†…å­˜åŠ è½½.Netç¨‹åºé›†çš„ç»†èŠ‚ï¼Œä»£ç ä½ç½®:</p>

<p>https://github.com/b4rtik/metasploit-execute-assembly/blob/master/HostingCLR_inject/HostingCLR/HostingCLR.cpp</p>

<p>ç»†èŠ‚å¦‚ä¸‹ï¼š</p>

<ul>
  <li>ä½¿ç”¨.Net v4.0.30319</li>
  <li>è°ƒç”¨ICLRMetaHost::GetRuntimeæ–¹æ³•ä»¥è·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆ</li>
  <li>ä½¿ç”¨ICorRuntimeHostæ¥å£</li>
  <li>ä½¿ç”¨Load_3(â€¦)ä»å†…å­˜ä¸­è¯»å–å¹¶åŠ è½½.NETç¨‹åºé›†</li>
</ul>

<p>åŒ1å’Œ2åŸºæœ¬ç›¸åŒ</p>

<h2 id="0x05-åˆ©ç”¨æ€è·¯">0x05 åˆ©ç”¨æ€è·¯</h2>
<hr />

<p>ç»¼åˆ0x04ä¸­çš„å¼€æºä»£ç ï¼Œexecute-assemblyé€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§åˆ©ç”¨æ€è·¯ï¼š</p>

<h4 id="1ä»å†…å­˜ä¸­è¯»å–shellcodeå¹¶åŠ è½½netç¨‹åºé›†">1.ä»å†…å­˜ä¸­è¯»å–shellcodeå¹¶åŠ è½½.NETç¨‹åºé›†</h4>

<ul>
  <li>è°ƒç”¨ICLRMetaHost::EnumerateInstalledRuntimes, ICLRMetaHost::GetRuntimeæˆ–è€…ICLRMetaHostPolicy::GetRequestedRuntimeæ–¹æ³•ä»¥è·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆ</li>
  <li>ä½¿ç”¨ICorRuntimeHostæ¥å£</li>
  <li>ä½¿ç”¨Load_3(â€¦)ä»å†…å­˜ä¸­è¯»å–å¹¶åŠ è½½.NETç¨‹åºé›†</li>
  <li>è°ƒç”¨é™æ€æ–¹æ³•</li>
</ul>

<h4 id="2ä»ç¡¬ç›˜è¯»å–å¹¶åŠ è½½netç¨‹åºé›†">2.ä»ç¡¬ç›˜è¯»å–å¹¶åŠ è½½.NETç¨‹åºé›†</h4>

<ul>
  <li>è°ƒç”¨ICLRMetaHost::EnumerateInstalledRuntimes, ICLRMetaHost::GetRuntimeæˆ–è€…ICLRMetaHostPolicy::GetRequestedRuntimeæ–¹æ³•ä»¥è·å–æœ‰æ•ˆçš„ICLRRuntimeInfoæŒ‡é’ˆ</li>
  <li>ä½¿ç”¨ICorRuntimeHost(ä½¿ç”¨Load_2(â€¦))æˆ–è€…ICLRRuntimeHostæ¥å£</li>
  <li>åŠ è½½.NETç¨‹åºé›†å¹¶è°ƒç”¨é™æ€æ–¹æ³•</li>
</ul>

<p>ç¬¬ä¸€ç§åˆ©ç”¨æ€è·¯è¦ä¼˜äºç¬¬äºŒç§ï¼Œå®Œæ•´çš„åˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>åˆ›å»ºä¸€ä¸ªæ­£å¸¸çš„è¿›ç¨‹</li>
  <li>é€šè¿‡Dllåå°„å‘è¿›ç¨‹æ³¨å…¥dll</li>
  <li>dllå®ç°ä»å†…å­˜ä¸­è¯»å–shellcodeå¹¶åŠ è½½æœ€ç»ˆçš„.NETç¨‹åºé›†</li>
</ol>

<p>ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>

<ul>
  <li>æ•´ä¸ªè¿‡ç¨‹åœ¨å†…å­˜æ‰§è¡Œï¼Œä¸å†™å…¥æ–‡ä»¶ç³»ç»Ÿ</li>
  <li>Payloadä»¥dllå½¢å¼å­˜åœ¨ï¼Œä¸ä¼šäº§ç”Ÿå¯ç–‘çš„è¿›ç¨‹</li>
  <li>æœ€ç»ˆçš„Payloadä¸ºC#ç¨‹åºï¼Œç°æœ‰çš„Powershellåˆ©ç”¨è„šæœ¬è½¬æ¢ä¸ºC#ä»£ç å¾ˆæ–¹ä¾¿</li>
</ul>

<h2 id="0x06-é˜²å¾¡å»ºè®®">0x06 é˜²å¾¡å»ºè®®</h2>
<hr />

<p>æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹å¿…é¡»è¦ç”¨åˆ°dllæ³¨å…¥ï¼Œå¯ä»¥å¯¹å¸¸è§çš„dllæ³¨å…¥æ–¹æ³•(å°¤å…¶æ˜¯Dllåå°„)è¿›è¡Œæ‹¦æˆª</p>

<p>è€Œå¯¹äºdllæœ¬èº«ï¼Œåœ¨ä½¿ç”¨CLRæ—¶ï¼Œä¼šåŠ è½½ç³»ç»Ÿçš„dllï¼Œä¾‹å¦‚ï¼š</p>

<ul>
  <li>mscoree.dll</li>
  <li>mscoreei.dll</li>
  <li>mscorlib.dll</li>
</ul>

<p>å¯å¯¹æ­¤è¿›è¡Œç›‘æ§</p>

<h2 id="0x07-å°ç»“">0x07 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ç»“åˆå¤šä¸ªå¼€æºä»£ç ï¼Œæ€»ç»“äº†â€execute-assemblyâ€çš„å®ç°æ–¹æ³•å’Œåˆ©ç”¨æ€è·¯ï¼Œåˆ†æä¼˜ç‚¹ï¼Œæœ€åç»™å‡ºé˜²å¾¡å»ºè®®</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET