I"ä3<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>2017å¹´11æœˆ9æ—¥ç»´åŸºè§£å¯†å…¬å¸ƒä¸€ä¸ªä»£å·ä¸ºVault8çš„æ–‡æ¡£ï¼ŒåŒ…å«æœåŠ¡å™¨è¿œç¨‹æ§åˆ¶å·¥å…·Hiveçš„æºä»£ç å’Œå¼€å‘æ–‡æ¡£ã€‚å¼€å‘æ–‡æ¡£ä¸­çš„æ¡†æ¶å›¾æ˜¾ç¤ºHiveæ”¯æŒæµé‡åˆ†å‘åŠŸèƒ½ï¼Œè‹¥æµé‡æœ‰æ•ˆï¼Œè½¬å‘è‡³HoneycombæœåŠ¡å™¨ï¼Œè‹¥æµé‡å­˜åœ¨é—®é¢˜ï¼Œè½¬å‘è‡³Cover Serverã€‚
æœ¬æ–‡ä»…ç«™åœ¨æŠ€æœ¯ç ”ç©¶çš„è§’åº¦ï¼Œå°è¯•ä½¿ç”¨Apacheçš„mod_rewriteæ¨¡å—å®ç°httpæµé‡åˆ†å‘ï¼Œå®Œæˆç›¸åŒçš„ç›®æ ‡ã€‚</p>

<p>æ ‡è®°åçš„æ¡†æ¶å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/0.png" alt="Alt text" /></p>

<p>ä¹‹å‰çš„åˆ†ææ–‡ç« ï¼š</p>

<p><a href="https://3gstudent.github.io/CIA-Hive%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97-%E6%BA%90%E4%BB%A3%E7%A0%81%E8%8E%B7%E5%8F%96%E4%B8%8E%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90">ã€ŠCIA Hiveæµ‹è¯•æŒ‡å—â€”â€”æºä»£ç è·å–ä¸ç®€è¦åˆ†æã€‹</a></p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>Windowsç³»ç»Ÿä¸‹å®‰è£…é…ç½®Apache mod_rewrite</li>
  <li>Ubuntuç³»ç»Ÿä¸‹å®‰è£…é…ç½®Apache mod_rewrite</li>
  <li>è§„åˆ™é…ç½®æŠ€å·§ä¸å®ä¾‹</li>
  <li>æ ¹æ®åˆ¤å®šæ¡ä»¶å®ç°httpæµé‡åˆ†å‘</li>
</ul>

<h2 id="0x02-windowsç³»ç»Ÿä¸‹å®‰è£…é…ç½®apache-mod_rewrite">0x02 Windowsç³»ç»Ÿä¸‹å®‰è£…é…ç½®Apache mod_rewrite</h2>
<hr />

<h3 id="1ä¸‹è½½apache">1ã€ä¸‹è½½Apache</h3>

<p>åœ°å€ï¼š</p>

<p>http://httpd.apache.org/download.cgi</p>

<p>é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬ï¼Œæµ‹è¯•ç‰ˆæœ¬Apache 2.4.33ï¼Œä¸‹è½½åœ°å€ï¼š</p>

<p>https://www.apachehaus.com/cgi-bin/download.plx?dli=wUWZ1allWW00kej9iUG5UeJVlUGRVYRdnWzQmW</p>

<h3 id="2å®‰è£…">2ã€å®‰è£…</h3>

<p>è§£å‹åé€šè¿‡å‘½ä»¤è¡Œå®‰è£…ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd \Apace24\bin
httpd -k install
</code></pre></div></div>

<h3 id="3å¼€å¯mod_rewriteæ¨¡å—">3ã€å¼€å¯mod_rewriteæ¨¡å—</h3>

<p>ç¼–è¾‘æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">\Apace24\conf\httpd.conf</code></p>

<p>æ‰¾åˆ°<code class="language-plaintext highlighter-rouge">#LoadModule rewrite_module modules/mod_rewrite.so</code>ï¼Œå»æ‰<code class="language-plaintext highlighter-rouge">#</code></p>

<h3 id="4å¼€å¯æ”¯æŒhtaccessæ–‡ä»¶">4ã€å¼€å¯æ”¯æŒ.htaccessæ–‡ä»¶</h3>

<p>ç¼–è¾‘æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">\Apace24\conf\httpd.conf</code></p>

<p>å®šä½å¦‚ä¸‹ä½ç½®ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DocumentRoot "${SRVROOT}/htdocs"
&lt;Directory "${SRVROOT}/htdocs"&gt;
    #
    # Possible values for the Options directive are "None", "All",
    # or any combination of:
    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
    #
    # Note that "MultiViews" must be named *explicitly* --- "Options All"
    # doesn't give it to you.
    #
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    Options Indexes FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be "All", "None", or any combination of the keywords:
    #   Options FileInfo AuthConfig Limit
    #
    AllowOverride All

    #
    # Controls who can get stuff from this server.
    #
    Require all granted
&lt;/Directory&gt;
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">AllowOverride None</code>æ”¹ä¸º<code class="language-plaintext highlighter-rouge">AllowOverride All</code></p>

<h3 id="5ç¼–å†™htaccessæ–‡ä»¶é…ç½®è§„åˆ™">5ã€ç¼–å†™.htaccessæ–‡ä»¶ï¼Œé…ç½®è§„åˆ™</h3>

<p>ä¿å­˜è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">\Apace24\htdocs\</code></p>

<p>æµ‹è¯•è§„åˆ™ä¸ºå°†1.htmlé‡å®šå‘åˆ°2.htmlï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine on
RewriteRule 1.html 2.html
&lt;/IfModule&gt;
</code></pre></div></div>

<p>ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œå¦å­˜ä¸ºæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸º<code class="language-plaintext highlighter-rouge">".htaccess"</code></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>æ–‡ä»¶ååŒ…å«å¼•å·<code class="language-plaintext highlighter-rouge">"</code>ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/2-1.png" alt="Alt text" /></p>

<p>2.htmlä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">\Apace24\htdocs\</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;html&gt;
&lt;body&gt;
True page
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div>

<h3 id="6å¼€å¯apacheæœåŠ¡">6ã€å¼€å¯apacheæœåŠ¡</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>httpd.exe -k start
</code></pre></div></div>

<h3 id="7æµ‹è¯•">7ã€æµ‹è¯•</h3>

<p>è®¿é—®<code class="language-plaintext highlighter-rouge">http://127.0.0.1/1.html</code></p>

<p>è¿”å›å†…å®¹<code class="language-plaintext highlighter-rouge">True page</code>ï¼Œä»£è¡¨ç½‘é¡µè¢«é‡å®šå‘åˆ°äº†2.html</p>

<h3 id="8è¡¥å……">8ã€è¡¥å……</h3>

<p>apacheçš„æ—¥å¿—è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">\Apache24\logs</code></p>

<p>mod_rewriteçš„æ—¥å¿—ä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">error.log</code></p>

<p>æ–‡ä»¶<code class="language-plaintext highlighter-rouge">\Apace24\conf\httpd.conf</code>å¯æŒ‡å®šæ—¥å¿—è®°å½•ç­‰çº§</p>

<h2 id="0x03-ubuntuç³»ç»Ÿä¸‹å®‰è£…é…ç½®apache-mod_rewrite">0x03 Ubuntuç³»ç»Ÿä¸‹å®‰è£…é…ç½®Apache mod_rewrite</h2>
<hr />

<h3 id="1ä¸‹è½½å®‰è£…">1ã€ä¸‹è½½å®‰è£…</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install apache2
</code></pre></div></div>

<h3 id="2å¼€å¯mod_rewriteæ¨¡å—">2ã€å¼€å¯mod_rewriteæ¨¡å—</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo a2enmod rewrite
</code></pre></div></div>

<h3 id="3å¼€å¯æ”¯æŒhtaccessæ–‡ä»¶">3ã€å¼€å¯æ”¯æŒ.htaccessæ–‡ä»¶</h3>

<p>ç¼–è¾‘æ–‡ä»¶ï¼š <code class="language-plaintext highlighter-rouge">/etc/apache2/apache2.conf</code></p>

<p>å®šä½å¦‚ä¸‹ä½ç½®ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Directory /var/www/&gt;
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
&lt;/Directory&gt;
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">AllowOverride None</code>æ”¹ä¸º<code class="language-plaintext highlighter-rouge">AllowOverride All</code></p>

<h3 id="4ç¼–å†™htaccessæ–‡ä»¶é…ç½®è§„åˆ™">4ã€ç¼–å†™.htaccessæ–‡ä»¶ï¼Œé…ç½®è§„åˆ™</h3>

<p>ä¿å­˜è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">\var\www\html\</code></p>

<p>æµ‹è¯•è§„åˆ™ä¸ºå°†1.htmlé‡å®šå‘åˆ°2.htmlï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine on
RewriteRule 1.html 2.html
&lt;/IfModule&gt;
</code></pre></div></div>

<p>2.htmlä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">\var\www\html\</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;html&gt;
&lt;body&gt;
True page
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div>

<h3 id="5å¼€å¯apacheæœåŠ¡">5ã€å¼€å¯apacheæœåŠ¡</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /etc/init.d/apache2 restart
</code></pre></div></div>

<h3 id="6æµ‹è¯•">6ã€æµ‹è¯•</h3>

<p>è®¿é—®<code class="language-plaintext highlighter-rouge">http:/IP/1.html</code></p>

<p>è¿”å›å†…å®¹<code class="language-plaintext highlighter-rouge">True page</code>ï¼Œä»£è¡¨ç½‘é¡µè¢«é‡å®šå‘åˆ°äº†2.html</p>

<h3 id="7è¡¥å……">7ã€è¡¥å……</h3>

<p>apacheçš„æ—¥å¿—è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">/var/log/apache2/</code></p>

<p>mod_rewriteçš„æ—¥å¿—ä¿å­˜åœ¨error.log</p>

<p>æ–‡ä»¶<code class="language-plaintext highlighter-rouge">/etc/apache2/apache2.conf</code>å¯æŒ‡å®šæ—¥å¿—è®°å½•ç­‰çº§</p>

<h2 id="0x04-è§„åˆ™é…ç½®æŠ€å·§ä¸å®ä¾‹">0x04 è§„åˆ™é…ç½®æŠ€å·§ä¸å®ä¾‹</h2>
<hr />

<h3 id="1å°†æ‰€æœ‰ç½‘é¡µé‡å®šå‘è‡³-httpswwwbaiducom">1ã€å°†æ‰€æœ‰ç½‘é¡µé‡å®šå‘è‡³ <code class="language-plaintext highlighter-rouge">https://www.baidu.com</code></h3>

<p>.htaccessæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine on
RewriteRule . https://www.baidu.com
&lt;/IfModule&gt;
</code></pre></div></div>

<h3 id="2è¿‡æ»¤request-header">2ã€è¿‡æ»¤Request Header</h3>

<h4 id="1-user-agent">(1) User Agent</h4>

<p>åªé’ˆå¯¹ç‰¹å®šUser Agentçš„è¯·æ±‚è¿›è¡Œé‡å®šå‘</p>

<p><strong>å®ä¾‹ï¼š</strong></p>

<p>ä½¿ç”¨Macä¸‹çš„Safariæµè§ˆå™¨è®¿é—®1.htmlï¼Œå°†å…¶é‡å®šå‘åˆ°2.html</p>

<p>.htaccessæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine on
RewriteCond "%{HTTP_USER_AGENT}" "Macintosh; Intel Mac OS X 10_9_3" [NC]
RewriteRule 1.html 2.html
&lt;/IfModule&gt;
</code></pre></div></div>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">RewriteCond "%{HTTP_USER_AGENT}" "Macintosh; Intel Mac OS X 10_9_3" [NC]</code>ä»£è¡¨åˆ¤å®šæ¡ä»¶ï¼Œåˆ¤æ–­<code class="language-plaintext highlighter-rouge">HTTP_USER_AGENT</code>æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²<code class="language-plaintext highlighter-rouge">"Macintosh; Intel Mac OS X 10_9_3"</code>(å¤§å°å†™ä¸æ•æ„Ÿ)</p>

<p>NC: å­—ç¬¦æ¯”è¾ƒï¼Œå¤§å°å†™ä¸æ•æ„Ÿ</p>

<p>è¯¦ç»†å‚æ•°è¯´æ˜å¯å‚è€ƒï¼š</p>

<p>https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritecond</p>

<p><strong>1.ä½¿ç”¨curlè¿›è¡Œæµ‹è¯•</strong></p>

<p>æ¨¡æ‹ŸChromeæµè§ˆå™¨ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -A "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36" http://192.168.62.137/1.html
</code></pre></div></div>

<p>å¹¶æ²¡é‡å®šå‘ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/3-1.png" alt="Alt text" /></p>

<p>æ¨¡æ‹ŸMac Safariæµè§ˆå™¨ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -A "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/7046A194A" http://192.168.62.137/1.html
</code></pre></div></div>

<p>ç½‘é¡µé‡å®šå‘ï¼Œè·å¾—2.htmlçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/3-2.png" alt="Alt text" /></p>

<p><strong>2.Chromeæµè§ˆå™¨ä¿®æ”¹User Agentçš„æ–¹æ³•</strong></p>

<p>è®¿é—®é¡µé¢ï¼Œ<code class="language-plaintext highlighter-rouge">F12</code> -&gt; <code class="language-plaintext highlighter-rouge">More tools</code> -&gt; <code class="language-plaintext highlighter-rouge">Network conditions</code>ï¼Œé€‰æ‹©User agent ä¸º <code class="language-plaintext highlighter-rouge">Safari â€”â€” Mac</code></p>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/3-3.png" alt="Alt text" /></p>

<h4 id="2-peferer">(2) Peferer</h4>

<p>åªé’ˆå¯¹ç‰¹å®šæ¥æºçš„è¯·æ±‚è¿›è¡Œé‡å®šå‘</p>

<p><strong>å®ä¾‹ï¼š</strong></p>

<p>å¦‚æœæ¥æºä¸ºtest.comï¼Œè®¿é—®1.htmlæ—¶å°†å…¶é‡å®šå‘åˆ°2.html</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine on
RewriteCond "%{HTTP_REFERER}" "test.com" [NC]
RewriteRule 1.html 2.html
&lt;/IfModule&gt;
</code></pre></div></div>

<p>ä½¿ç”¨curlè¿›è¡Œæµ‹è¯•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -e "test.com" http://192.168.62.137/1.html
</code></pre></div></div>

<h4 id="3-å…¶ä»–å¯ä¾›é€‰æ‹©çš„è¿‡æ»¤æ¡ä»¶">(3) å…¶ä»–å¯ä¾›é€‰æ‹©çš„è¿‡æ»¤æ¡ä»¶</h4>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-4-16/3-4.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>å›¾ç‰‡æ¥æºäºhttps://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritecond</p>

<p><strong>è¡¥å……ï¼š</strong></p>

<p>Jeff Dimmockåœ¨ä»–çš„åšå®¢åˆ†äº«äº†ä½¿ç”¨mod_rewriteé…ç½®è§„åˆ™çš„å¿ƒå¾—ï¼Œå€¼å¾—å­¦ä¹ ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://bluescreenofjeff.com/tags</p>

<h2 id="0x05-å°ç»“">0x05 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†Windowsç³»ç»Ÿå’ŒUbuntuç³»ç»Ÿä¸‹å®‰è£…é…ç½®Apache mod_rewriteçš„æ–¹æ³•ï¼Œåˆ†äº«é…ç½®æŠ€å·§ä¸å®ä¾‹ï¼Œåœ¨æŠ€æœ¯ç ”ç©¶çš„è§’åº¦å®ç°äº†æ ¹æ®è¯·æ±‚æ¡ä»¶è¿›è¡Œhttpæµé‡åˆ†å‘ã€‚</p>

<p>ä¸‹ç¯‡æ–‡ç« å°†è¦ä»‹ç»httpsçš„æµé‡åˆ†å‘å®ç°ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET