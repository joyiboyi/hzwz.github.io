I"ì?<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80-Windows%E4%B8%8B%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8">ã€Šæ¸—é€åŸºç¡€â€”â€”Windowsä¸‹è®¡åˆ’ä»»åŠ¡çš„ä½¿ç”¨ã€‹</a>æ›¾ä»‹ç»è¿‡è®¡åˆ’ä»»åŠ¡çš„ç”¨æ³•ã€‚è€Œåœ¨åŸŸç¯å¢ƒä¸­ï¼Œé€šè¿‡ç»„ç­–ç•¥(Group Policy Object)åŒæ ·èƒ½å¤Ÿå®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œï¼Œæœ¬æ–‡å°†è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œä»‹ç»ï¼Œåˆ†æåˆ©ç”¨æ€è·¯ã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹:</p>

<ul>
  <li>GPOä¸­çš„è®¡åˆ’ä»»åŠ¡ç®€ä»‹</li>
  <li>é€šè¿‡Group Policy Management Console (GPMC) å®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œ</li>
  <li>é€šè¿‡å‘½ä»¤è¡Œå®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œ</li>
  <li>æ–°å»ºGPOå®ç°è¿œç¨‹æ‰§è¡Œ</li>
  <li>ä¿®æ”¹å·²æœ‰çš„GPOï¼Œå®ç°è¿œç¨‹æ‰§è¡Œ</li>
  <li>GPOçš„å¸¸ç”¨æ“ä½œ</li>
</ul>

<h2 id="0x02-ç®€ä»‹">0x02 ç®€ä»‹</h2>
<hr />

<p>å€¼å¾—é˜…è¯»çš„èµ„æ–™ï¼š</p>

<p>http://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/</p>

<p>https://adsecurity.org/?p=2716</p>

<p>http://www.sicherheitsforschung-magdeburg.de/uploads/journal/MJS_052_Willi_GPO.pdf</p>

<p>GPOå…¨ç§°Group Policy Objectsï¼Œç”¨æ¥å­˜å‚¨Active Directoryä¸­çš„ç­–ç•¥</p>

<p>è‡ªWindows Server 2008å¼€å§‹ï¼ŒGPOå¼€å§‹æ”¯æŒè®¡åˆ’ä»»åŠ¡ï¼Œä¾¿äºç®¡ç†åŸŸä¸­çš„è®¡ç®—æœºå’Œç”¨æˆ·</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸŸç”¨æˆ·çš„ç»„ç­–ç•¥æ¯90åˆ†é’Ÿæ›´æ–°ï¼Œéšæœºåç§»ä¸º0-30åˆ†é’Ÿï¼ŒåŸŸæ§åˆ¶å™¨çš„ç»„ç­–ç•¥æ¯5åˆ†é’Ÿæ›´æ–°</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>å¯é€šè¿‡å‘½ä»¤å®ç°ç»„ç­–ç•¥çš„å¼ºåˆ¶æ›´æ–°</p>

<p>é»˜è®¤ç»„ç­–ç•¥çš„ä¿å­˜ä½ç½®ï¼š<code class="language-plaintext highlighter-rouge">\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\Policies\</code>ï¼Œæ‰€æœ‰åŸŸå†…ä¸»æœºéƒ½èƒ½è®¿é—®</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8SYSVOL%E8%BF%98%E5%8E%9F%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">ã€ŠåŸŸæ¸—é€-åˆ©ç”¨SYSVOLè¿˜åŸç»„ç­–ç•¥ä¸­ä¿å­˜çš„å¯†ç ã€‹</a>æ›¾ä»‹ç»è¿‡è¿™ä¸ªæ–‡ä»¶ä½ç½®</p>

<p>é»˜è®¤å­˜åœ¨ä¸¤ä¸ªç»„ç­–ç•¥ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹å¯¹åº”ä¸€ä¸ªç»„ç­–ç•¥ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">{6AC1786C-016F-11D2-945F-00C04fB984F9}</code>å¯¹åº”<code class="language-plaintext highlighter-rouge">Default Domain Controllers Policy</code></p>

<p><code class="language-plaintext highlighter-rouge">{31B2F340-016D-11D2-945F-00C04FB984F9}</code>å¯¹åº”<code class="language-plaintext highlighter-rouge">Default Domain Policy</code></p>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-11-21/2-1.png" alt="Alt text" /></p>

<h2 id="0x03-é€šè¿‡group-policy-management-console-gpmc-å®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œ">0x03 é€šè¿‡Group Policy Management Console (GPMC) å®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œ</h2>
<hr />

<p>åœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼Œä½ç½®ï¼š <code class="language-plaintext highlighter-rouge">Administrative Tools</code> -&gt; <code class="language-plaintext highlighter-rouge">Group Policy Management</code></p>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-11-21/3-1.png" alt="Alt text" /></p>

<p>é€‰æ‹©åŸŸtest.localï¼Œå³é”®ï¼Œé€‰ä¸­ç¬¬ä¸€ä¸ªï¼Œåˆ›å»ºGPOï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-11-21/3-2.png" alt="Alt text" /></p>

<p>è¾“å…¥åç§°TestGPO1ï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€çš„GPOï¼Œä½œç”¨äºæ‰€æœ‰åŸŸç”¨æˆ·</p>

<p>é€‰æ‹©TestGPO1ï¼Œå³é”®ï¼Œ<code class="language-plaintext highlighter-rouge">Edit...</code></p>

<p><code class="language-plaintext highlighter-rouge">User Configuration</code> -&gt; <code class="language-plaintext highlighter-rouge">Preferences</code> -&gt; <code class="language-plaintext highlighter-rouge">Control Panel Settings</code> -&gt; <code class="language-plaintext highlighter-rouge">Scheduled Tasks</code></p>

<p><code class="language-plaintext highlighter-rouge">New</code> -&gt; <code class="language-plaintext highlighter-rouge">Immediate Task(Windows Vista and later)</code>ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-11-21/3-3.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>Immediate Taskä¼šåœ¨æ¯æ¬¡ç»„ç­–ç•¥åˆ·æ–°æ—¶æ‰§è¡Œ</p>

<p>å››ç§è®¡åˆ’ä»»åŠ¡çš„åŒºåˆ«å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š</p>

<p>https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770904(v%3dws.11)</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä¹Ÿå¯ä»¥é€‰æ‹©ä½ç½®<code class="language-plaintext highlighter-rouge">Computer Configuration</code> -&gt; <code class="language-plaintext highlighter-rouge">Preferences</code> -&gt; <code class="language-plaintext highlighter-rouge">Control Panel Settings</code> -&gt; <code class="language-plaintext highlighter-rouge">Scheduled Tasks</code></p>

<p>æ¥ä¸‹æ¥ï¼Œæ ¹æ®æç¤ºè®¾ç½®è®¡åˆ’ä»»åŠ¡å³å¯</p>

<p>ä¸ºä¾¿äºæµ‹è¯•ï¼Œæ‰§è¡Œçš„æ“ä½œä¸ºå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-11-21/3-4.png" alt="Alt text" /></p>

<p>è¿™ä¸ªç»„ç­–ç•¥å¯¹åº”çš„IDä¸º<code class="language-plaintext highlighter-rouge">{7D85A2EF-F525-4D8C-B12D-F2825F3A1224}</code>ï¼Œåœ¨ä½ç½®<code class="language-plaintext highlighter-rouge">\\test.com\SYSVOL\test.com\Policies\{7D85A2EF-F525-4D8C-B12D-F2825F3A1224}\User\Preferences\ScheduledTasks</code>ä¸‹æ‰¾åˆ°æ–‡ä»¶<code class="language-plaintext highlighter-rouge">ScheduledTasks.xml</code>ï¼Œé‡Œé¢ä¿å­˜è®¡åˆ’ä»»åŠ¡çš„é…ç½®ä¿¡æ¯</p>

<p>å¯¹äºåŸŸå†…çš„ä¸»æœºï¼Œå¯ä»¥ç­‰å¾…90åˆ†é’Ÿä½¿ç»„ç­–ç•¥è‡ªåŠ¨æ›´æ–°ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¼ºåˆ¶åˆ·æ–°ç»„ç­–ç•¥ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpupdate /force
</code></pre></div></div>

<p>å®¢æˆ·ç«¯é»˜è®¤æ›´æ–°ç»„ç­–ç•¥çš„æ–¹å¼ï¼š</p>

<p>è¯»å–åŸŸå…±äº«ç›®å½•ä¸­ç»„ç­–ç•¥çš„ç‰ˆæœ¬ï¼Œä½ç½®ä¸º<code class="language-plaintext highlighter-rouge">\\&lt;domain.com&gt;\Policies\&lt;gpo id&gt;\GPT.ini</code>ï¼Œå¦‚æœç‰ˆæœ¬é«˜äºæœ¬åœ°ä¿å­˜çš„ç»„ç­–ç•¥ç‰ˆæœ¬ï¼Œå®¢æˆ·ç«¯å°†ä¼šæ›´æ–°æœ¬åœ°çš„ç»„ç­–ç•¥</p>

<p>æ¯æ¬¡ä¿®æ”¹ç»„ç­–ç•¥ï¼Œ<code class="language-plaintext highlighter-rouge">\\&lt;domain.com&gt;\Policies\&lt;gpo id&gt;\GPT.ini</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">Version</code>ä¼šå¢åŠ </p>

<p>å¦‚æœåŸŸæ§åˆ¶å™¨å¼ºåˆ¶å®¢æˆ·ç«¯åˆ·æ–°ç»„ç­–ç•¥ï¼Œé‚£ä¹ˆä¸ä¼šæ¯”è¾ƒåŸŸå…±äº«ç›®å½•ä¸­ç»„ç­–ç•¥çš„ç‰ˆæœ¬</p>

<h2 id="0x04-é€šè¿‡å‘½ä»¤è¡Œå®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œ">0x04 é€šè¿‡å‘½ä»¤è¡Œå®ç°è®¡åˆ’ä»»åŠ¡çš„è¿œç¨‹æ‰§è¡Œ</h2>
<hr />

<p>åŸŸæ§åˆ¶å™¨ç³»ç»Ÿï¼š Windows Server 2012 R2 x64
åŸŸåï¼š test.com</p>

<h3 id="1åˆ›å»ºä¸€ä¸ªgpo">1ã€åˆ›å»ºä¸€ä¸ªGPO</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-GPO -Name TestGPO1
</code></pre></div></div>

<h3 id="2å°†gpoè¿åˆ°åˆ°åŸŸtestcom">2ã€å°†GPOè¿åˆ°åˆ°åŸŸtest.com</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-GPLink -Name TestGPO1 -Target "dc=test,dc=com"
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä¸¤æ¡å‘½ä»¤å¯ä»¥ç®€å†™ä¸ºä¸€æ¡å‘½ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>new-gpo -name TestGPO1 | new-gplink -Target "dc=test,dc=com"
</code></pre></div></div>

<p>é€šè¿‡å‘½ä»¤è¡Œå›æ˜¾è·å¾—IDä¸º<code class="language-plaintext highlighter-rouge">0bfd3f0c-21a1-4eca-8a5e-1f0bd4dc64dc</code></p>

<h3 id="3åˆ›å»ºè®¡åˆ’ä»»åŠ¡">3ã€åˆ›å»ºè®¡åˆ’ä»»åŠ¡</h3>

<p>é€šè¿‡Group Policy Management Console (GPMC)åˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡ä¼šè‡ªåŠ¨æ³¨å†Œ</p>

<p>è€Œæˆ‘ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°æ³¨å†Œè®¡åˆ’ä»»åŠ¡çš„æ¥å£ï¼Œæ‰€ä»¥åªèƒ½å¯»æ‰¾ä¸€ä¸ªå˜é€šçš„æ–¹æ³•</p>

<p>å¥½åœ¨æˆ‘æœ€ç»ˆæ‰¾åˆ°äº†å˜é€šçš„è§£å†³æ–¹æ³•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>

<h4 id="1å¯¼å‡ºgpo">(1)å¯¼å‡ºGPO</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Backup-Gpo -Name TestGPO1 -Path C:\test
</code></pre></div></div>

<h4 id="2åˆ›å»ºè®¡åˆ’ä»»åŠ¡çš„é…ç½®æ–‡ä»¶scheduledtasksxml">(2)åˆ›å»ºè®¡åˆ’ä»»åŠ¡çš„é…ç½®æ–‡ä»¶ScheduledTasks.xml</h4>

<p>è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">\\&lt;domain.com&gt;\Policies\&lt;gpo id&gt;\DomainSysvol\GPO\User\Preferences\ScheduledTasks\ScheduledTasks.xml</code></p>

<h4 id="3ä¿®æ”¹backupxmlå’Œgpreportxml">(3)ä¿®æ”¹<code class="language-plaintext highlighter-rouge">Backup.xml</code>å’Œ<code class="language-plaintext highlighter-rouge">gpreport.xml</code></h4>

<p>åŠ å…¥è®¡åˆ’ä»»åŠ¡çš„é…ç½®ä¿¡æ¯</p>

<h4 id="4è¿˜åŸgpo">(4)è¿˜åŸGPO</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Import-GPO -BackupId &lt;backupid&gt; -TargetName TestGPO1 -Path C:\test
</code></pre></div></div>

<p>å®Œæ•´å®ç°ä»£ç å·²å¼€æºï¼Œä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-Powershell/blob/master/New-GPOImmediateTask.ps1</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä¸‹ç¯‡æ–‡ç« å°†ä¼šè¯¦ç»†ä»‹ç»åŸç†å’Œè„šæœ¬å®ç°ç»†èŠ‚</p>

<p>è„šæœ¬å‘½ä»¤ç¤ºä¾‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-GPOImmediateTask -TaskName Debugging -GPODisplayName TestGPO -SysPath '\\dc.test.com\sysvol\test.com' -CommandArguments '-c "123 | Out-File C:\test\debug.txt"'
</code></pre></div></div>

<p>è„šæœ¬è‡ªåŠ¨å®ç°ä»¥ä¸‹æ“ä½œï¼š</p>

<ul>
  <li>å°†TestGPOå¤‡ä»½è‡³å½“å‰ç›®å½•</li>
  <li>ä¿®æ”¹å¤‡ä»½æ–‡ä»¶å¤¹ä¸‹çš„<code class="language-plaintext highlighter-rouge">Backup.xml</code>å’Œ<code class="language-plaintext highlighter-rouge">gpreport.xml</code></li>
  <li>åœ¨å¤‡ä»½æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆæ–‡ä»¶<code class="language-plaintext highlighter-rouge">ScheduledTasks.xml</code></li>
  <li>è¿˜åŸTestGPO</li>
</ul>

<h3 id="4å¼ºåˆ¶å®¢æˆ·ç«¯åˆ·æ–°ç»„ç­–ç•¥">4ã€å¼ºåˆ¶å®¢æˆ·ç«¯åˆ·æ–°ç»„ç­–ç•¥</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-GPUpdate -Computer "TEST\COMPUTER-01"
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>Windows Server 2008 R2é»˜è®¤ä¸æ”¯æŒè¯¥å‘½ä»¤ï¼ŒWindows Server 2012æ”¯æŒ</p>

<p>å®¢æˆ·ç«¯çš„é˜²ç«å¢™éœ€è¦å…è®¸ä»¥ä¸‹è¿æ¥ï¼š</p>

<ul>
  <li>Remote Scheduled Tasks Management (RPC)</li>
  <li>Remote Scheduled Tasks Management (RPC-ERMAP)</li>
  <li>Windows Management Instrumentation (WMI-IN)</li>
</ul>

<p>å®˜æ–¹èµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/powershell/module/grouppolicy/invoke-gpupdate?view=win10-ps</p>

<h3 id="5åˆ é™¤gpo">5ã€åˆ é™¤GPO</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-GPO -Name TestGPO1
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>é€šè¿‡Group Policy Management Console (GPMC)å³é”®åˆ é™¤GPOä¸ä¼šåˆ é™¤å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼ŒRemove-GPOå¯ä»¥</p>

<h2 id="0x05-åˆ©ç”¨æ€è·¯">0x05 åˆ©ç”¨æ€è·¯</h2>
<hr />

<p>å‰ææ˜¯è·å¾—äº†åŸŸç®¡ç†å‘˜çš„æƒé™æˆ–è€…æŸä¸ªç»„ç­–ç•¥çš„ç¼–è¾‘æƒé™</p>

<p>é€šç”¨æ“ä½œå¦‚ä¸‹ï¼š</p>

<p>åŠ è½½GroupPolicyæ¨¡å—ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Import-Module GroupPolicy â€“verbose
</code></pre></div></div>

<p>è·å¾—æ‰€æœ‰GPOçš„å†…å®¹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-GPO -All
</code></pre></div></div>

<p>å°†æ‰€æœ‰GPOå¯¼å‡ºä¸ºä¸€ä¸ªHTMLæŠ¥å‘Šï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-GPOReport -All -ReportType html -Path C:\GposReport\GposReport.html
</code></pre></div></div>

<p>å°†æ¯ä¸ªGPOå•ç‹¬å¯¼å‡ºä¸€ä¸ªHTMLæŠ¥å‘Šï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-GPO -All | %{
Get-GPOReport -name $_.displayname -ReportType html -path ("c:\GPOReports\"+$_.displayname+".html")
}
</code></pre></div></div>

<p>æŸ¥çœ‹æŒ‡å®šGPOçš„æƒé™è®¾ç½®ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-GPPermission -Name "TestGPO1" -All 
</code></pre></div></div>

<p>å¤‡ä»½æŒ‡å®šGPOï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Backup-Gpo -Name TestGPO1 -Path C:\GpoBackups
</code></pre></div></div>

<p>å¤‡ä»½æ‰€æœ‰GPOï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Backup-Gpo -All -Path "c:\GpoBackups"
</code></pre></div></div>

<p>è¿˜åŸæŒ‡å®šGPOï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Restore-GPO -Name TestGPO1 -Path C:\GpoBackups
</code></pre></div></div>

<p>è¿˜åŸæ‰€æœ‰GPOï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Restore-GPO -All -Path "c:\GpoBackups"
</code></pre></div></div>

<p>æ ¹æ®ä¸åŒæƒ…å†µï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§åˆ©ç”¨æ€è·¯ï¼š</p>

<h3 id="1æ–°å»ºç»„ç­–ç•¥åˆ›å»ºè®¡åˆ’ä»»åŠ¡å®ç°è¿œç¨‹æ‰§è¡Œ">1ã€æ–°å»ºç»„ç­–ç•¥ï¼Œåˆ›å»ºè®¡åˆ’ä»»åŠ¡å®ç°è¿œç¨‹æ‰§è¡Œ</h3>

<ul>
  <li>åˆ›å»ºä¸€ä¸ªæ–°çš„GPO</li>
  <li>å¤‡ä»½GPO</li>
  <li>ä¿®æ”¹Backup.xmlå’Œgpreport.xml</li>
  <li>åˆ›å»ºScheduledTasks.xml</li>
  <li>è¿˜åŸGPO</li>
  <li>å¼ºåˆ¶å®¢æˆ·ç«¯åˆ·æ–°ç­–ç•¥</li>
  <li>æ¸…ç†æ“ä½œç—•è¿¹</li>
</ul>

<h3 id="2ä¿®æ”¹å·²æœ‰ç»„ç­–ç•¥æ›¿æ¢è®¡åˆ’ä»»åŠ¡">2ã€ä¿®æ”¹å·²æœ‰ç»„ç­–ç•¥ï¼Œæ›¿æ¢è®¡åˆ’ä»»åŠ¡</h3>

<p>å¦‚æœåŸŸæ§åˆ¶å™¨ä¸Šå·²æœ‰ç­–ç•¥å¹¶é…ç½®äº†è®¡åˆ’ä»»åŠ¡</p>

<p>ä¸å†éœ€è¦æ³¨å†Œï¼Œä¿®æ”¹ScheduledTasks.xmlå°±å¥½</p>

<h2 id="0x06-gpoçš„å¸¸ç”¨æ“ä½œ">0x06 GPOçš„å¸¸ç”¨æ“ä½œ</h2>
<hr />

<p>åˆ›å»ºOU:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-ADOrganizationalUnit -Name OUTest1 -Path "dc=test,dc=com"
</code></pre></div></div>

<p>æŸ¥çœ‹å½“å‰åŸŸä¸­çš„æ‰€æœ‰è®¡ç®—æœº:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsquery computer
</code></pre></div></div>

<p>è·å¾—ç»“æœâ€CN=Computer1,CN=Computers,DC=test,DC=comâ€</p>

<p>å°†è¯¥è®¡ç®—æœºåŠ åˆ°OU=OUTest1ä¸­:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsmove "CN=Computer1,CN=Computers,DC=test,DC=com" -newparent OU=OUTest1,dc=test,dc=com
</code></pre></div></div>

<p>æŸ¥è¯¢OU=OUTest1ä¸­çš„è®¡ç®—æœº:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsquery computer OU=OUTest1,dc=test,dc=com
</code></pre></div></div>

<p>åˆ›å»ºGPOå¹¶è¿æ¥:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>new-gpo -name TestGPO | new-gplink -Target "OU=OUTest1,dc=test,dc=com"
</code></pre></div></div>

<p>è¿˜åŸï¼š</p>

<p>å°†è®¡ç®—æœºComputer1ä»OU=OUTest1ä¸­ç§»é™¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsmove "CN=Computer1,OU=OUTest1,DC=test,DC=com" -newparent CN=Computers,dc=test,dc=com
</code></pre></div></div>

<p>åˆ é™¤OU=OUTest1ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set-ADOrganizationalUnit -Identity "OU=OUTest1,dc=test,dc=com" -ProtectedFromAccidentalDeletion $false
Remove-ADOrganizationalUnit -Identity "OU=OUTest1,dc=test,dc=com" -Recursive -Confirm:$False
</code></pre></div></div>

<h2 id="0x07-å°ç»“">0x07 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†åˆ©ç”¨GPOä¸­çš„è®¡åˆ’ä»»åŠ¡å®ç°è¿œç¨‹æ‰§è¡Œçš„æ–¹æ³•ï¼Œåˆ†æåˆ©ç”¨æ€è·¯ï¼Œé€šè¿‡å‘½ä»¤è¡Œå®ç°äº†GPOå’Œè®¡åˆ’ä»»åŠ¡çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚</p>

<h2 id="0x08-è¡¥å……">0x08 è¡¥å……</h2>

<p>æˆ‘æ³¨æ„åˆ°harmj0yçš„åšå®¢ä¸­æåˆ°äº†æŸäº›æƒ…å†µä¸‹ä»–çš„è„šæœ¬æ— æ³•ä½¿ç”¨çš„æƒ…å†µï¼š</p>

<p>http://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/</p>

<p>ä¸ªäººè®¤ä¸ºæ˜¯å› ä¸ºåˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡æ²¡æœ‰æ³¨å†Œï¼Œä½¿ç”¨æˆ‘ä¿®æ”¹ä»¥åçš„è„šæœ¬åº”è¯¥èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœè¯»è€…æœ‰æ–°çš„å»ºè®®ï¼Œæ¬¢è¿åŠæ—¶åé¦ˆã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET