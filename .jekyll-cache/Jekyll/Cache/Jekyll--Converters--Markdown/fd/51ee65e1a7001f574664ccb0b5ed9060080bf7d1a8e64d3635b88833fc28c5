I"º-<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/æ¸—é€æŠ€å·§-å¯¼å‡ºChromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ">ã€Šæ¸—é€æŠ€å·§â€”â€”å¯¼å‡ºChromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ã€‹</a>ä»‹ç»äº†å¯¼å‡ºChromeæµè§ˆå™¨å¯†ç çš„åŸç†å’Œåˆ©ç”¨æ–¹æ³•ï¼Œæœ¬æ–‡å°†è¦å¯¹å¯¼å‡ºFirefoxæµè§ˆå™¨å¯†ç çš„åŸç†å’Œåˆ©ç”¨æ–¹æ³•è¿›è¡Œä»‹ç»ï¼Œåˆ†æåˆ©ç”¨æ€è·¯ã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹:</p>

<ul>
  <li>å¯†ç ä¿å­˜æ–¹å¼</li>
  <li>åŸç†ä»‹ç»</li>
  <li>å¸¸ç”¨çš„å¯¼å‡ºå·¥å…·</li>
  <li>åˆ©ç”¨æ€è·¯</li>
</ul>

<h2 id="0x02-å¯†ç ä¿å­˜æ–¹å¼">0x02 å¯†ç ä¿å­˜æ–¹å¼</h2>
<hr />

<p>æ­£å¸¸ç”¨æˆ·åœ¨è®¿é—®ç½‘ç«™æ—¶ï¼Œå¯é€‰æ‹©ä½¿ç”¨Firefoxæµè§ˆå™¨ä¿å­˜ç™»å½•çš„ç”¨æˆ·å¯†ç ï¼Œç”¨äºä¸‹æ¬¡ç™»å½•çš„æ—¶å€™Firefoxè‡ªåŠ¨å¡«å†™ç™»å½•å¯†ç </p>

<p>å¯ä»¥é€šè¿‡é€‰æ‹©Logins and Passwordsè¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/2-1.png" alt="Alt text" /></p>

<p>åŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ï¼š</p>

<ul>
  <li>Website address</li>
  <li>Username</li>
  <li>Password</li>
  <li>Created</li>
  <li>Last modified</li>
  <li>Last used</li>
</ul>

<p>æ‰€æœ‰è®°å½•ä¿å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå…·ä½“ä½ç½®ä¸ºï¼š<code class="language-plaintext highlighter-rouge">%APPDATA%\Mozilla\Firefox\Profiles\xxxxxxxx.default\</code></p>

<p><strong>æ³¨:</strong></p>

<p>xxxxxxxxä¸º8ä½éšæœºå­—æ¯å’Œæ•°å­—çš„ç»„åˆ</p>

<p>ä¸åŒç‰ˆæœ¬çš„Firefoxä¿å­˜è®°å½•çš„æ–‡ä»¶åç§°ä¸åŒï¼Œå…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š</p>

<ul>
  <li>Versionå¤§äºç­‰äº32.0ï¼Œä¿å­˜è®°å½•çš„æ–‡ä»¶ä¸ºlogins.json</li>
  <li>Versionå¤§äºç­‰äº3.5ï¼Œå°äº32.0ï¼Œä¿å­˜è®°å½•çš„æ–‡ä»¶ä¸ºsignons.sqlite</li>
</ul>

<p>æ›´è¯¦ç»†çš„æ–‡ä»¶è¯´æ˜å¯å‚è€ƒï¼š</p>

<p><code class="language-plaintext highlighter-rouge">http://kb.mozillazine.org/Profile_folder_-_Firefox</code></p>

<p>ä¸åŒç‰ˆæœ¬Firefoxçš„ä¸‹è½½åœ°å€ï¼š</p>

<p>http://ftp.mozilla.org/pub/firefox/releases/</p>

<p>å®šä½logins.jsonæ–‡ä»¶çš„ä½ç½®å¯é€šè¿‡cmdå‘½ä»¤å®ç°ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir %APPDATA%\Mozilla\Firefox\Profiles\*logins.json /s /b
</code></pre></div></div>

<p>æŸ¥çœ‹logins.jsonæ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/2-2.png" alt="Alt text" /></p>

<p>å…¶ä¸­<code class="language-plaintext highlighter-rouge">encryptedUsername</code>å’Œ<code class="language-plaintext highlighter-rouge">encryptedPassword</code>æ˜¯åŠ å¯†çš„å†…å®¹ï¼Œè§£å¯†éœ€è¦è·å¾—å¯†é’¥æ–‡ä»¶(keyå’Œiv)å¹¶ä½œ3DES-CBCè§£å¯†</p>

<p>ä¸åŒç‰ˆæœ¬çš„Firefoxå¯†é’¥æ–‡ä»¶çš„ä½ç½®ä¸åŒï¼Œå…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š</p>

<ul>
  <li>Versionå°äº58.0.2ï¼Œå¯†é’¥æ–‡ä»¶ä¸ºkey3.db</li>
  <li>Versionå¤§äºç­‰äº58.0.2ï¼Œå¯†é’¥æ–‡ä»¶ä¸ºkey4.db</li>
</ul>

<p><strong>æ³¨ï¼š</strong></p>

<p>key3.dbå’Œkey4.dbçš„ç‰ˆæœ¬åŒºåˆ«æ¥æºäºhttps://github.com/lclevy/firepwd/blob/master/firepwd.py#L236</p>

<p>æˆ‘åœ¨æˆ‘çš„æµ‹è¯•ç³»ç»Ÿ(Win7x64)ä¸‹ï¼Œå®‰è£…64ä½Firefoxï¼Œæµ‹è¯•ç»“æœæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>

<ul>
  <li>å¦‚æœFirefoxçš„ç‰ˆæœ¬ä½äº58.0ï¼Œå¯†é’¥æ–‡ä»¶ä¸ºkey3.db</li>
  <li>å¦‚æœFirefoxä¸ºæ›´é«˜çš„ç‰ˆæœ¬ï¼Œå¯†é’¥æ–‡ä»¶ä¸ºkey4.db</li>
</ul>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“å‰ç”¨æˆ·çš„æƒé™å¯ä»¥æŸ¥çœ‹Firefoxæµè§ˆå™¨ä¸­ä¿å­˜çš„æ‰€æœ‰å¯†ç ï¼Œä¸ºäº†æé«˜å®‰å…¨æ€§ï¼ŒFirefoxæµè§ˆå™¨æ”¯æŒä¸ºä¿å­˜çš„å¯†ç æ·»åŠ é¢å¤–çš„ä¿æŠ¤ï¼šè®¾ç½®Master Password</p>

<p>å…·ä½“ä½ç½®å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/3-1.png" alt="Alt text" /></p>

<p>æ·»åŠ Master Passwordåï¼ŒæŸ¥çœ‹ä¿å­˜çš„å¯†ç éœ€è¦é¢å¤–è¾“å…¥Master Password</p>

<p>è§£å¯†æµç¨‹ï¼š</p>

<ol>
  <li>è¯»å–å¯†é’¥æ–‡ä»¶(key4.dbæˆ–key3.db)ï¼Œè·å¾—keyå’Œiv</li>
  <li>è¯»å–è®°å½•æ–‡ä»¶(logins.jsonæˆ–signons.sqlite)çš„å†…å®¹</li>
  <li>å¦‚æœæœªè®¾ç½®Master Passwordï¼Œä½¿ç”¨keyå’Œivå¯¹è®°å½•æ–‡ä»¶ä¸­çš„åŠ å¯†å†…å®¹è¿›è¡Œ3DES-CBCè§£å¯†
å¦‚æœè®¾ç½®Master Passwordï¼Œè¿˜éœ€è¦è·å¾—æ˜æ–‡å½¢å¼çš„Master Passwordï¼Œæ‰èƒ½è¿›è¡Œè§£å¯†</li>
</ol>

<h2 id="0x03-å¯¼å‡ºå·¥å…·">0x03 å¯¼å‡ºå·¥å…·</h2>
<hr />

<h3 id="1webbrowserpassviewexe">1.WebBrowserPassView.exe</h3>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://www.nirsoft.net/utils/web_browser_password.html</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>è¿™ä¸ªç‰ˆæœ¬ä¸æ”¯æŒå‘½ä»¤è¡Œæ“ä½œ</p>

<p>å‘½ä»¤è¡Œç‰ˆæœ¬éœ€è¦åœ¨å¦ä¸€åœ°å€ä¸‹è½½ï¼š</p>

<p>https://www.nirsoft.net/password_recovery_tools.html</p>

<p>å‘½ä»¤è¡Œä¸‹çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WebBrowserPassView.exe /LoadPasswordsFirefox 1 /shtml "c:\test\passwords.html"
</code></pre></div></div>

<p>ç»“æœä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">c:\test\passwords.html</code>ä¸­ï¼Œå†…å®¹å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/4-1.png" alt="Alt text" /></p>

<p>èƒ½è·å¾—å®Œæ•´çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç±»åˆ«ï¼š</p>

<ul>
  <li>Website address</li>
  <li>Username</li>
  <li>Password</li>
  <li>Created</li>
  <li>Last modified</li>
  <li>Last used</li>
</ul>

<p>ä¸æ”¯æŒä½¿ç”¨Master Passwordè§£å¯†</p>

<h3 id="2firepwdpy">2.firepwd.py</h3>

<p>åœ°å€ï¼šhttps://github.com/lclevy/firepwd</p>

<p>éœ€è¦å®‰è£…ä¾èµ–åŒ…ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pyasn1
pip install pycrypto
</code></pre></div></div>

<p>èƒ½è·å¾—éƒ¨åˆ†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç±»åˆ«ï¼š</p>

<ul>
  <li>Website address</li>
  <li>Username</li>
  <li>Password</li>
</ul>

<p>å‘½ä»¤ç¤ºä¾‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firepwd.py -d C:\Users\a\AppData\Roaming\Mozilla\Firefox\Profiles\5a4gs6zh.default-release\
</code></pre></div></div>

<p>ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/4-2.png" alt="Alt text" /></p>

<p>æ”¯æŒä½¿ç”¨Master Passwordè§£å¯†</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>æˆ‘åœ¨è‡ªå·±çš„æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œfirepwd.pyåªæ”¯æŒkey3.dbçš„Master Passworè§£å¯†ï¼Œkey4.dbçš„Master Passworè§£å¯†å­˜åœ¨bug</p>

<p>å‘½ä»¤ç¤ºä¾‹ï¼š</p>

<p>ä½¿ç”¨æµ‹è¯•æ–‡ä»¶mozilla_db(key3.db)ï¼ŒMaster Passwordä¸º<code class="language-plaintext highlighter-rouge">MISC*</code>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python firepwd.py -p 'MISC*' -d mozilla_db/
</code></pre></div></div>

<p>ç»“æœæ­£å¸¸ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/4-3.png" alt="Alt text" /></p>

<p>æˆ‘çš„æµ‹è¯•ç¯å¢ƒ(key4.db)ï¼ŒMaster Passwordä¸º<code class="language-plaintext highlighter-rouge">12345678</code>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firepwd.py -d C:\Users\a\AppData\Roaming\Mozilla\Firefox\Profiles\5a4gs6zh.default-release\ -p "12345678"
</code></pre></div></div>

<p>è§£å¯†å­˜åœ¨bugï¼Œæç¤ºå£ä»¤å¤±è´¥ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/4-4.png" alt="Alt text" /></p>

<h3 id="3lazagne">3.Lazagne</h3>

<p>åœ°å€ï¼š</p>

<p>https://github.com/AlessandroZ/LaZagne/</p>

<p>å¯¼å‡ºFirefoxæµè§ˆå™¨çš„ä»£ç æ¥è‡ªhttps://github.com/lclevy/firepwd</p>

<p>ç»“æœåŒä¸Šï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/4-5.png" alt="Alt text" /></p>

<h3 id="4firefox_decryptpy">4.firefox_decrypt.py</h3>

<p>åœ°å€ï¼šhttps://github.com/unode/firefox_decrypt</p>

<p>ä½¿ç”¨NSS(Network Security Services)è¿›è¡Œè§£å¯†ï¼Œæ”¯æŒkey3.dbå’Œkey4.dbçš„Master Passwordè§£å¯†</p>

<p>èƒ½è·å¾—éƒ¨åˆ†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç±»åˆ«ï¼š</p>

<ul>
  <li>Website address</li>
  <li>Username</li>
  <li>Password</li>
</ul>

<p>æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-1-9/5-1.png" alt="Alt text" /></p>

<p>åœ¨64ä½ç³»ç»Ÿä¸‹ï¼ŒPythonå’ŒFirefoxçš„ç‰ˆæœ¬éœ€è¦ä¿æŒä¸€è‡´(åŒä¸º32ä½æˆ–è€…åŒä¸º64ä½)ï¼Œå¦åˆ™ä¼šæç¤º<code class="language-plaintext highlighter-rouge">ERROR - Problems opening 'nss3.dll' required for password decryption</code></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ã€Šé€šè¿‡Network Security Serviceså¯¼å‡ºFirefoxæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ã€‹å°†è¦è¯¦ç»†ä»‹ç»é€šè¿‡NSSè§£å¯†çš„ç»†èŠ‚</p>

<h3 id="5firefoxæµè§ˆå™¨">5.Firefoxæµè§ˆå™¨</h3>

<p>é€šè¿‡å¯¼å‡ºé…ç½®æ–‡ä»¶çš„æ–¹å¼å®ç°</p>

<p>éœ€è¦è·å¾—è®°å½•æ–‡ä»¶(logins.jsonæˆ–signons.sqlite)å’Œå¯†é’¥æ–‡ä»¶(key4.dbæˆ–key3.db)ï¼Œä¿å­˜åœ¨æœ¬åœ°çš„æ–‡ä»¶å¤¹<code class="language-plaintext highlighter-rouge">C:\test\data1</code></p>

<p>ä½¿ç”¨-profileå‚æ•°å¯åŠ¨Firefoxï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firefox.exe -profile C:\test\data1
</code></pre></div></div>

<p>è¾“å…¥æ­£ç¡®çš„Master Passwordï¼ŒæˆåŠŸè·å¾—Firefoxæµè§ˆå™¨ä¿å­˜çš„ä¿¡æ¯</p>

<h2 id="0x04-åˆ©ç”¨æ€è·¯">0x04 åˆ©ç”¨æ€è·¯</h2>
<hr />

<p>å¦‚æœFirefoxè®¾ç½®äº†Master Passwordï¼Œä½¿ç”¨ä»¥ä¸Šå·¥å…·å°è¯•å¯¼å‡ºå¯†ç æ—¶ï¼Œç»“æœä¼šæ˜¾ç¤ºä¸º0æ¡ç»“æœï¼Œæ‰€ä»¥éœ€è¦å…ˆè¯»å–è®°å½•æ–‡ä»¶ç¡®è®¤æ˜¯å¦å­˜åœ¨è®°å½•</p>

<p>å¯ä»¥é€šè¿‡æŸ¥è¯¢æ³¨å†Œè¡¨çš„æ–¹å¼è·å¾—Firefoxçš„ç‰ˆæœ¬ï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒä¹‹å‰å¼€æºçš„ä»£ç ï¼šhttps://github.com/3gstudent/ListInstalledPrograms/blob/master/ListInstalledPrograms.ps1</p>

<p>ä¸åŒç‰ˆæœ¬çš„Firefoxå¯¹åº”çš„è®°å½•æ–‡ä»¶ä¸åŒï¼Œå…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š</p>

<ul>
  <li>Versionå¤§äºç­‰äº32.0ï¼Œä¿å­˜è®°å½•çš„æ–‡ä»¶ä¸ºlogins.json</li>
  <li>Versionå¤§äºç­‰äº3.5ï¼Œå°äº32.0ï¼Œä¿å­˜è®°å½•çš„æ–‡ä»¶ä¸ºsignons.sqlite</li>
</ul>

<p>å®šä½logins.jsonæ–‡ä»¶çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir %APPDATA%\Mozilla\Firefox\Profiles\*logins.json /s /b
</code></pre></div></div>

<p>å®šä½signons.sqliteæ–‡ä»¶çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir %APPDATA%\Mozilla\Firefox\Profiles\*signons.sqlite /s /b
</code></pre></div></div>

<p>å¦‚æœå­˜åœ¨è®°å½•ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨å·¥å…·å°è¯•å¯¼å‡º</p>

<p>åœ¨ç¦»çº¿å¯¼å‡ºæ—¶éœ€è¦æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</p>

<h4 id="1æœªè®¾ç½®master-password">1.æœªè®¾ç½®Master Password</h4>

<p>åªéœ€è¦è·å¾—è®°å½•æ–‡ä»¶(logins.jsonæˆ–signons.sqlite)å’Œå¯†é’¥æ–‡ä»¶(key4.dbæˆ–key3.db)</p>

<p>ä½¿ç”¨firepwd.pyæˆ–è€…Firefoxæµè§ˆå™¨å¯¼å…¥é…ç½®æ–‡ä»¶å³å¯</p>

<h4 id="2è®¾ç½®master-password">2.è®¾ç½®Master Password</h4>

<p>(1)åªè·å¾—è®°å½•æ–‡ä»¶(logins.jsonæˆ–signons.sqlite)å’Œå¯†é’¥æ–‡ä»¶(key4.dbæˆ–key3.db)</p>

<p>æœ¬åœ°ä½¿ç”¨Firefoxæµè§ˆå™¨å¯¼å…¥é…ç½®æ–‡ä»¶ï¼Œè¾“å…¥Master Password</p>

<p>(2)éœ€è¦è·å¾—å®Œæ•´çš„é…ç½®æ–‡ä»¶</p>

<p>éœ€è¦åŒ…æ‹¬ä»¥ä¸‹æ–‡ä»¶ï¼š</p>

<ul>
  <li>%APPDATA%\Mozilla\Firefox\profiles.ini</li>
  <li>%APPDATA%\Mozilla\Firefox\Profiles\xxxxxxxx.default\ä¸­çš„æ–‡ä»¶</li>
</ul>

<p>ä½¿ç”¨firefox_decrypt.pyï¼Œå‘½ä»¤ç¤ºä¾‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firefox_decrypt.py C:\test\data1
</code></pre></div></div>

<h2 id="0x05-å°ç»“">0x05 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†å¯¼å‡ºFirefoxæµè§ˆå™¨å¯†ç çš„åŸç†å’Œåˆ©ç”¨æ–¹æ³•ï¼Œåˆ†æäº†ä½¿ç”¨Master Passwordè§£å¯†æ—¶éœ€è¦æ³¨æ„çš„ç»†èŠ‚</p>

<p>å¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´ï¼Œä¸ºäº†å¢åŠ å¯†ç çš„å®‰å…¨æ€§ï¼Œå»ºè®®è®¾ç½®Master Password</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET