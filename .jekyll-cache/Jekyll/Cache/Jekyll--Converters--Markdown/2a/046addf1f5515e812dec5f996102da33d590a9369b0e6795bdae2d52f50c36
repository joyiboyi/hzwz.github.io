I"ì,<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80-%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E4%BF%A1%E6%81%AF%E7%9A%84%E8%8E%B7%E5%8F%96">ã€Šæ¸—é€åŸºç¡€â€”â€”æ´»åŠ¨ç›®å½•ä¿¡æ¯çš„è·å–ã€‹</a>ä»¥è·å–æ´»åŠ¨ç›®å½•ä¸­æ‰€æœ‰ç”¨æˆ·ã€æ‰€æœ‰è®¡ç®—æœºå’Œæ‰€æœ‰ç»„ä¸ºä¾‹ï¼Œä»‹ç»å¸¸ç”¨çš„ä¿¡æ¯è·å–æ–¹æ³•ã€‚</p>

<p>ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¸€äº›å·¥å…·ä¼šè¢«æ€æ¯’è½¯ä»¶æ‹¦æˆªã€‚</p>

<p>æ‰€ä»¥æœ¬æ–‡å°†è¦å¯¹è·å–æ–¹æ³•è¿›è¡Œè¡¥å……ï¼ŒåŒæ—¶ç»•è¿‡æ€æ¯’è½¯ä»¶çš„æ‹¦æˆªã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>ä½¿ç”¨csvdeè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯</li>
  <li>ä½¿ç”¨ldifdeè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯</li>
  <li>ä½¿ç”¨AdFindè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯</li>
  <li>ä½¿ç”¨C#å¼€å‘çš„è½»é‡çº§è·å–å·¥å…·</li>
</ul>

<h2 id="0x02-ä½¿ç”¨csvdeè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯">0x02 ä½¿ç”¨csvdeè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯</h2>
<hr />

<p>è¯´æ˜æ–‡æ¡£ï¼š</p>

<p>https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc732101(v=ws.11)</p>

<p>ä½¿ç”¨csvdeå¯¼å‡ºçš„æ–‡ä»¶æ ¼å¼ä¸ºcsvï¼Œå¯ä»¥ä½¿ç”¨Microsoft ExcelæŸ¥çœ‹</p>

<p>é»˜è®¤åªèƒ½åœ¨ä»¥ä¸‹ç³»ç»Ÿä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p>

<ul>
  <li>Windows Server 2003</li>
  <li>Windows Server 2008</li>
  <li>Windows Server 2003 R2</li>
  <li>Windows Server 2008 R2</li>
  <li>Windows Server 2012,</li>
  <li>Windows Server 2003 with SP1</li>
  <li>Windows 8</li>
  <li>â€¦</li>
</ul>

<h3 id="1å¯¼å‡ºå½“å‰åŸŸå†…æ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹">1.å¯¼å‡ºå½“å‰åŸŸå†…æ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹</h3>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f all.csv
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f user.csv -r "(&amp;(objectCategory=person))"
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰æœºå™¨ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f machine.csv -r "(&amp;(objectCategory=computer))"
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç»„ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f group.csv -r "(&amp;(objectCategory=group))"
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç®¡ç†å‘˜ç»„çš„ç”¨æˆ·ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f admin.csv -r "(&amp;(objectCategory=group)(name=Domain Admins))"
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰OUä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f ou.csv -r "(&amp;(objectCategory=organizationalUnit))"
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰çš„åŸŸç”¨æˆ·åï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f username.csv -r "(&amp;(objectCategory=person))" -l SamAccountName
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰çš„è®¡ç®—æœºåï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -f machinename.csv -r "(&amp;(objectCategory=computer))" -l name
</code></pre></div></div>

<h3 id="2ä»åŸŸå¤–è¿œç¨‹å¯¼å‡ºæ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹">2.ä»åŸŸå¤–è¿œç¨‹å¯¼å‡ºæ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹</h3>

<p>å¯¼å‡ºè¿œç¨‹åŸŸå†…æ‰€æœ‰ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csvde -s 192.168.1.1 -a test\admin Password -f all.csv
</code></pre></div></div>

<h2 id="0x03-ä½¿ç”¨ldifdeè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯">0x03 ä½¿ç”¨ldifdeè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯</h2>
<hr />

<p>è¯´æ˜æ–‡æ¡£ï¼š</p>

<p>https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731033(v=ws.11)</p>

<p>ä½¿ç”¨ldifdeå¯¼å‡ºçš„æ–‡ä»¶æ ¼å¼ä¸ºLDIFï¼Œå¯ä»¥ä½¿ç”¨notepad.exeæŸ¥çœ‹</p>

<h3 id="1å¯¼å‡ºå½“å‰åŸŸå†…æ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹-1">1.å¯¼å‡ºå½“å‰åŸŸå†…æ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹</h3>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -f all.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=person))" -f user.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰æœºå™¨ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=computer))" -f machine.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç»„ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=group))" -f group.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç®¡ç†å‘˜ç»„çš„ç”¨æˆ·ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=group)(name=Domain Admins))" -f admin.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰OUä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=organizationalUnit))" -f ou.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰çš„åŸŸç”¨æˆ·åï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=person))" -l SamAccountName -f username.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰çš„è®¡ç®—æœºåï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -r "(&amp;(objectCategory=computer))" -l name -f machinename.txt
</code></pre></div></div>

<h3 id="2ä»åŸŸå¤–è¿œç¨‹å¯¼å‡ºæ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹-1">2.ä»åŸŸå¤–è¿œç¨‹å¯¼å‡ºæ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹</h3>

<p>å¯¼å‡ºè¿œç¨‹åŸŸå†…æ‰€æœ‰ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldifde -s 192.168.1.1 -a test\admin Password -f all.txt
</code></pre></div></div>

<h2 id="0x04-ä½¿ç”¨adfindè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯">0x04 ä½¿ç”¨AdFindè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯</h2>
<hr />

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://www.joeware.net/freetools/tools/adfind/</p>

<h3 id="1å¯¼å‡ºå½“å‰åŸŸå†…æ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹-2">1.å¯¼å‡ºå½“å‰åŸŸå†…æ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹</h3>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1&gt;all.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f objectcategory=person&gt;user.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰æœºå™¨ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f objectcategory=computer&gt;machine.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç»„ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f objectcategory=group&gt;group.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰ç®¡ç†å‘˜ç»„çš„ç”¨æˆ·ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f "(&amp;(objectCategory=group)(name=Domain Admins))"&gt;admin.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰OUä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f objectcategory=organizationalUnit&gt;ou.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰çš„åŸŸç”¨æˆ·åï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f objectcategory=person SamAccountName&gt;username.txt
</code></pre></div></div>

<p>å¯¼å‡ºå½“å‰åŸŸå†…æ‰€æœ‰çš„è®¡ç®—æœºåï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 127.0.0.1 -f objectcategory=computer name&gt;machinename.txt
</code></pre></div></div>

<h3 id="2ä»åŸŸå¤–è¿œç¨‹å¯¼å‡ºæ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹-2">2.ä»åŸŸå¤–è¿œç¨‹å¯¼å‡ºæ´»åŠ¨ç›®å½•ä¿¡æ¯ç¤ºä¾‹</h3>

<p>å¯¼å‡ºè¿œç¨‹åŸŸå†…æ‰€æœ‰ä¿¡æ¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adfind.exe -h 192.168.1.1 -u test\admin -up Password&gt;all.txt
</code></pre></div></div>

<h2 id="0x05-ä½¿ç”¨cå¼€å‘çš„è½»é‡çº§è·å–å·¥å…·">0x05 ä½¿ç”¨C#å¼€å‘çš„è½»é‡çº§è·å–å·¥å…·</h2>
<hr />

<p><a href="https://github.com/tevora-threat/SharpView">SharpView</a>é€šè¿‡.Netå®ç°äº†<a href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1">PowerView</a>ä¸­å…³äºè·å–æ´»åŠ¨ç›®å½•ä¿¡æ¯çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½å¾ˆå®Œæ•´ï¼Œä½†æ˜¯ä¼šè¢«æ€æ¯’è½¯ä»¶æ‹¦æˆªã€‚</p>

<p>è€Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨å‘½åç©ºé—´<code class="language-plaintext highlighter-rouge">System.DirectoryServices</code>ï¼Œèƒ½å¤Ÿå¾ˆå®¹æ˜“å®ç°ç®€å•çš„åŠŸèƒ½ï¼Œæ»¡è¶³åŸºæœ¬éœ€æ±‚ï¼Œå¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹ä¸ä¼šè¢«æ€æ¯’è½¯ä»¶æ‹¦æˆªã€‚</p>

<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ä»£ç <a href="https://github.com/3gstudent/Homework-of-C-Sharp/blob/master/ListUserMailbyLDAP.cs">ListUserMailbyLDAP.cs</a>ä½œä¸ºæ¨¡æ¿ï¼Œä¿®æ”¹æŸ¥è¯¢è¯­å¥å³å¯ã€‚</p>

<p>æˆ‘ä»¥AdFindçš„åŸºç¡€åŠŸèƒ½ä½œä¸ºå‚ç…§ï¼Œå®ç°äº†ä¸€ä¸ªè½»é‡çº§çš„å·¥å…·ï¼Œå®Œæ•´çš„ä»£ç å·²ä¸Šä¼ githubï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-C-Sharp/blob/master/SharpADFindDemo.cs</p>

<p>SharpADFindDemoå¯ä»¥åœ¨.Net3.5æˆ–.Net4çš„Windowsç³»ç»Ÿä¸‹ç›´æ¥ç¼–è¯‘</p>

<p>ç¼–è¯‘æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\Microsoft.NET\Framework64\v3.5\csc.exe SharpADFindDemo.cs /r:System.DirectoryServices.dll
or
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe SharpADFindDemo.cs /r:System.DirectoryServices.dll
</code></pre></div></div>

<p>æ”¯æŒå¯¼å‡ºä»¥ä¸‹ADä¿¡æ¯ï¼š</p>

<ul>
  <li>userï¼Œæ‰€æœ‰åŸŸç”¨æˆ·ä¿¡æ¯</li>
  <li>machineï¼Œæ‰€æœ‰åŸŸè®¡ç®—æœºä¿¡æ¯</li>
  <li>groupï¼Œæ‰€æœ‰åŸŸç»„ä¿¡æ¯</li>
  <li>ouï¼Œæ‰€æœ‰åŸŸOUä¿¡æ¯</li>
  <li>usernameï¼Œåªå¯¼å‡ºåŸŸç”¨æˆ·å</li>
  <li>machinenameï¼Œåªå¯¼å‡ºåŸŸè®¡ç®—æœºå</li>
  <li>groupnameï¼Œåªå¯¼å‡ºåŸŸç»„å</li>
  <li>ounameï¼Œåªå¯¼å‡ºåŸŸOUå</li>
</ul>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤å¯¼å‡ºçš„æœ€å¤§æ•°ç›®ä¸º1000ä¸ª</p>

<h2 id="0x06-å°ç»“">0x06 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡å¯¹æ´»åŠ¨ç›®å½•ä¿¡æ¯çš„è·å–æ–¹æ³•è¿›è¡Œäº†è¡¥å……ï¼Œä»‹ç»äº†3ä¸ªå¸¸ç”¨å·¥å…·ï¼Œä½¿ç”¨C#å¼€å‘äº†ä¸€ä¸ªè½»é‡çº§è·å–å·¥å…·SharpADFindDemoï¼Œåç»­å¯ä»¥æ­¤ä¸ºæ¨¡æ¿ï¼Œç»“åˆ<a href="https://github.com/tevora-threat/SharpView">SharpView</a>æ·»åŠ å…¶ä»–åŠŸèƒ½ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET