I"·-<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/SILENTTRINITY%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90">ã€ŠSILENTTRINITYåˆ©ç”¨åˆ†æã€‹</a>å­¦ä¹ äº†C#åˆ©ç”¨IronPythonå¼•æ“ä»å†…å­˜åŠ è½½payloadçš„æ–¹æ³•ï¼Œæˆ‘åœ¨byt3bl33d3rçš„GitHubä¸Šåˆçœ‹åˆ°äº†åˆ©ç”¨Boolangè¯­è¨€æ‰§è¡Œshellcodeçš„ä»£ç ï¼Œäºæ˜¯å¯¹è¿™é¡¹æŠ€æœ¯åšäº†ç ”ç©¶ã€‚</p>

<p>æœ¬æ–‡å°†è¦ä»‹ç»Boolangè¯­è¨€çš„ç‰¹ç‚¹å’Œç”¨æ³•ï¼Œåˆ†æé€šè¿‡Boolangè¯­è¨€æ‰§è¡Œshellcodeçš„ä¼˜ç‚¹ï¼Œç»™å‡ºé˜²å¾¡æ£€æµ‹çš„å»ºè®®ã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>Boolangè¯­è¨€ç®€ä»‹</li>
  <li>Boolangè¯­è¨€çš„ç”¨æ³•</li>
  <li>é€šè¿‡Boolangè¯­è¨€æ‰§è¡Œshellcodeçš„å®ç°ä»£ç </li>
  <li>åˆ©ç”¨åˆ†æ</li>
  <li>é˜²å¾¡æ£€æµ‹</li>
</ul>

<h2 id="0x02-boolangè¯­è¨€ç®€ä»‹">0x02 Boolangè¯­è¨€ç®€ä»‹</h2>
<hr />

<p>å­¦ä¹ èµ„æ–™ï¼š</p>

<p>https://github.com/boo-lang/boo</p>

<p>Boolangæ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œç»“åˆäº†Pythonçš„è¯­æ³•ï¼ŒRubyçš„åŠŸèƒ½ä»¥åŠCï¼ƒçš„é€Ÿåº¦å’Œå®‰å…¨æ€§</p>

<p>å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>

<ul>
  <li>è¯­æ³•éå¸¸æ¥è¿‘Pythonï¼Œä½¿ç”¨å‹å¥½</li>
  <li>é™æ€ç±»å‹ï¼Œç›¸æ¯”åŠ¨æ€ç±»å‹çš„Pythonï¼Œæ›´åŠ å®‰å…¨</li>
  <li>å¯ä»¥æ‰©å……ç¼–è¯‘å™¨ï¼Œèƒ½å¤Ÿåœ¨.NET Frameworkæˆ–Monoä¸Šè¿è¡Œ</li>
  <li>ä»£ç å¼€æº</li>
</ul>

<h2 id="0x03-boolangè¯­è¨€çš„ç”¨æ³•">0x03 Boolangè¯­è¨€çš„ç”¨æ³•</h2>
<hr />

<p>é¦–å…ˆéœ€è¦ä¸‹è½½ç¼–è¯‘åçš„Boolangæ–‡ä»¶ï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/boo-lang/boo/releases</p>

<p>æ–‡ä»¶ä¸­åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªå¯æ‰§è¡Œç¨‹åºï¼š</p>

<ol>
  <li>booi.exeï¼Œç”¨ä½œæ‰§è¡Œè„šæœ¬</li>
  <li>booish.exeï¼Œå®æ—¶ç¼–è¯‘ç¨‹åºï¼Œä¾¿äºæµ‹è¯•ä»£ç </li>
  <li>booc.exeï¼Œç”¨ä½œç¼–è¯‘è„šæœ¬</li>
</ol>

<p>å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p>

<h3 id="1ä½¿ç”¨booiexeæ‰§è¡Œboolangè„šæœ¬">1.ä½¿ç”¨booi.exeæ‰§è¡ŒBoolangè„šæœ¬</h3>

<p>test.booçš„å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print "Hello, World!"
</code></pre></div></div>

<p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>booi.exe test.boo
</code></pre></div></div>

<p>ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-2-9/2-1.png" alt="Alt text" /></p>

<h3 id="2ä½¿ç”¨booishexeå®æ—¶ç¼–è¯‘">2.ä½¿ç”¨booish.exeå®æ—¶ç¼–è¯‘</h3>

<p>å¯åŠ¨booish.exeï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print "Hello, World!"
</code></pre></div></div>

<p>ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-2-9/2-2.png" alt="Alt text" /></p>

<h3 id="3ä½¿ç”¨boocexeç¼–è¯‘boolangè„šæœ¬">3.ä½¿ç”¨booc.exeç¼–è¯‘Boolangè„šæœ¬</h3>

<p>test.booçš„å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print "Hello, World!"
</code></pre></div></div>

<p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">enter code here</code>booc -output:test.exe test.boo</p>

<p>ç”Ÿæˆæ–‡ä»¶test.exe</p>

<h3 id="4ä½¿ç”¨boocexeç¼–è¯‘boolangè„šæœ¬ä½¿ç”¨boolangcompiler-api">4.ä½¿ç”¨booc.exeç¼–è¯‘Boolangè„šæœ¬(ä½¿ç”¨Boo.Lang.Compiler API)</h3>

<p>test.booçš„å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import Boo.Lang.Compiler
import Boo.Lang.Compiler.IO
import Boo.Lang.Compiler.Pipelines

compiler = BooCompiler()
compiler.Parameters.Input.Add(StringInput("&lt;script&gt;", "print('Hello!')"))
compiler.Parameters.Pipeline = Run()

compiler.Run()
</code></pre></div></div>

<p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>booc -output:test.exe test.boo
</code></pre></div></div>

<p>ç”Ÿæˆæ–‡ä»¶test.exe</p>

<h3 id="5ä½¿ç”¨cè°ƒç”¨boolangè„šæœ¬">5.ä½¿ç”¨c#è°ƒç”¨Boolangè„šæœ¬</h3>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://github.com/boo-lang/boo/wiki/Scripting-with-the-Boo.Lang.Compiler-API</p>

<p>script.booçš„å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>static def stringManip(item as string): //static lets us invoke this method without needing to instanize a class.
	return "'${item}'? What the hell are you talking about?"
</code></pre></div></div>

<p>runBoo.csçš„å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using System;
using System.Text;
using System.Reflection;

using Boo.Lang.Compiler;
using Boo.Lang.Compiler.IO;
using Boo.Lang.Compiler.Pipelines;
namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            BooCompiler compiler = new BooCompiler();
            compiler.Parameters.Input.Add(new FileInput("script.boo"));
            compiler.Parameters.Pipeline = new CompileToMemory();
            compiler.Parameters.Ducky = true;

            CompilerContext context = compiler.Run();
            //Note that the following code might throw an error if the Boo script had bugs.
            //Poke context.Errors to make sure.
            if (context.GeneratedAssembly != null)
            {
                Type scriptModule = context.GeneratedAssembly.GetType("ScriptModule");
                MethodInfo stringManip = scriptModule.GetMethod("stringManip");
                string output = (string)stringManip.Invoke(null, new object[] { "Tag" } );
                Console.WriteLine(output);
            }
            else
            {
                foreach (CompilerError error in context.Errors)
                    Console.WriteLine(error);
            }
        }
    }
}
</code></pre></div></div>

<p>ä½¿ç”¨csc.exeç¼–è¯‘runBoo.csï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /r:Boo.Lang.dll,Boo.Lang.Compiler.dll,Boo.Lang.Parser.dll /t:exe runBoo.cs
</code></pre></div></div>

<p>ç”Ÿæˆæ–‡ä»¶runBoo.exeï¼Œè°ƒç”¨script.booçš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>runBoo.exe script.boo
</code></pre></div></div>

<p>ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-2-9/2-3.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>runBoo.exeçš„åŒçº§ç›®å½•ä¸‹éœ€è¦å­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªdllï¼š</p>

<ul>
  <li>Boo.Lang.dll</li>
  <li>Boo.Lang.Compiler.dll</li>
  <li>Boo.Lang.Parser.dll</li>
</ul>

<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯èƒ½å°†Boolangè„šæœ¬ç¼–è¯‘åˆ°å†…å­˜ä¸­å¹¶è¿è¡Œï¼Œå¯¹åº”åˆ°ä¸Šé¢çš„ç¤ºä¾‹ï¼ŒrunBoo.exeåœ¨å†…å­˜ä¸­å¯¹script.booè¿›è¡Œç¼–è¯‘å¹¶è¿è¡Œ</p>

<h2 id="0x04-é€šè¿‡boolangè¯­è¨€æ‰§è¡Œshellcodeçš„å®ç°ä»£ç ">0x04 é€šè¿‡Boolangè¯­è¨€æ‰§è¡Œshellcodeçš„å®ç°ä»£ç </h2>
<hr />

<p>ä»£ç æ¥è‡ªhttps://github.com/byt3bl33d3r/OffensiveDLR/</p>

<h3 id="1ä½¿ç”¨cè°ƒç”¨boolangè„šæœ¬">1.ä½¿ç”¨c#è°ƒç”¨Boolangè„šæœ¬</h3>

<p>éœ€è¦ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªä»£ç æ–‡ä»¶ï¼š</p>

<h4 id="1runboocs">(1)runBoo.cs</h4>

<p>ä»£ç åœ°å€ï¼š</p>

<p>https://github.com/byt3bl33d3r/OffensiveDLR/blob/master/runBoo.cs</p>

<p>åŒ0x04-5ä¸­çš„runBoo.csç»“æ„åŸºæœ¬ç›¸åŒ</p>

<p>åœ¨æ•°ç»„ä¸­åˆ†åˆ«ä¿å­˜äº†32ä½å’Œ64ä½çš„shellcode</p>

<p>å‘½ä»¤è¡Œç¬¬1ä¸ªå‚æ•°ä½œä¸ºä¼ å…¥çš„Boolangè„šæœ¬æ–‡ä»¶</p>

<p>å‘½ä»¤è¡Œç¬¬2ä¸ªå‚æ•°ä½œä¸ºæ³¨å…¥shellcodeçš„æ–¹æ³•</p>

<h4 id="2shellcodeboo">(2)shellcode.boo</h4>

<p>ä»£ç åœ°å€ï¼š</p>

<p>https://github.com/byt3bl33d3r/OffensiveDLR/blob/master/shellcode.boo</p>

<p>Boolangè„šæœ¬ï¼Œæ”¯æŒä»¥ä¸‹ä¸‰ç§æ³¨å…¥æ–¹æ³•ï¼š</p>

<ul>
  <li>InjectQueueUserAPCï¼Œé€šè¿‡QueueUserAPCæ³¨å…¥explorer.exeè¿›ç¨‹</li>
  <li>InjectSelfï¼Œé€šè¿‡CreateThreadæ³¨å…¥å½“å‰è¿›ç¨‹</li>
  <li>InjectRemoteï¼Œé€šè¿‡CreateRemoteThreadæ³¨å…¥explorer.exeè¿›ç¨‹</li>
</ul>

<p>å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p>

<h4 id="1ä½¿ç”¨cscexeç¼–è¯‘runboocs">(1)ä½¿ç”¨csc.exeç¼–è¯‘runBoo.cs</h4>

<p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /r:Boo.Lang.Compiler.dll,Boo.Lang.dll,Boo.Lang.Parser.dll /t:exe runBoo.cs
</code></pre></div></div>

<p>ç”Ÿæˆæ–‡ä»¶runBoo.exe</p>

<h4 id="2æµ‹è¯•åŠŸèƒ½">(2)æµ‹è¯•åŠŸèƒ½</h4>

<p>å¯ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<ol>
  <li>runBoo.exe shellcode.boo InjectQueueUserAPC</li>
  <li>runBoo.exe shellcode.boo InjectSelf</li>
  <li>runBoo.exe shellcode.boo InjectRemote</li>
</ol>

<p><strong>æ³¨ï¼š</strong></p>

<p>runBoo.exeçš„åŒçº§ç›®å½•ä¸‹éœ€è¦å­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªdllï¼š</p>

<ul>
  <li>Boo.Lang.dll</li>
  <li>Boo.Lang.Compiler.dll</li>
  <li>Boo.Lang.Parser.dll</li>
</ul>

<p>è§£å†³æ–¹æ³•1ï¼š</p>

<p>ä½¿ç”¨ILMerge</p>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://github.com/boo-lang/boo/wiki/Merge-Boo.Lang.dll-into-your-exe-or-dll</p>

<h3 id="2ä½¿ç”¨powershellè°ƒç”¨boolangè„šæœ¬">2.ä½¿ç”¨Powershellè°ƒç”¨Boolangè„šæœ¬</h3>

<p>éœ€è¦ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªä»£ç æ–‡ä»¶ï¼š</p>

<h4 id="1invoke-jumpscareps1">(1)Invoke-JumpScare.ps1</h4>

<p>ä»£ç åœ°å€ï¼š</p>

<p>https://github.com/byt3bl33d3r/OffensiveDLR/blob/master/Invoke-JumpScare.ps1</p>

<p>åŠŸèƒ½åŒrunBoo.csï¼Œä½†æ˜¯é€šè¿‡åå°„åŠ è½½æ‰€éœ€çš„ä¸‰ä¸ªdll(Boo.Lang.dll,Boo.Lang.Compiler.dll,Boo.Lang.Parser.dll)ï¼ŒåŒçº§ç›®å½•ä¸‹ä¸å†éœ€è¦è¿™ä¸‰ä¸ªdllæ–‡ä»¶</p>

<p>ä¸éœ€è¦ä½¿ç”¨csc.exeè¿›è¡Œç¼–è¯‘ï¼Œä¸ä¼šäº§ç”Ÿä¸­é—´æ–‡ä»¶</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>å¯ä»¥å°†Boolangè„šæœ¬çš„å†…å®¹ä¿å­˜åœ¨å˜é‡ä¸­ï¼Œè¿™æ ·ä¸éœ€è¦é¢å¤–çš„Boolangè„šæœ¬ï¼Œæ‰€æœ‰çš„åŠŸèƒ½åªéœ€è¦ä¸€ä¸ªPowershellæ–‡ä»¶å³å¯</p>

<h4 id="2shellcodeboo-1">(2)shellcode.boo</h4>

<p>ä»£ç åœ°å€ï¼š</p>

<p>https://github.com/byt3bl33d3r/OffensiveDLR/blob/master/shellcode.boo</p>

<p>å†…å®¹åŒä¸Š</p>

<p>å®é™…æµ‹è¯•å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-2-9/3-1.png" alt="Alt text" /></p>

<h2 id="0x05-åˆ©ç”¨åˆ†æ">0x05 åˆ©ç”¨åˆ†æ</h2>
<hr />

<p>å¯¹äºbyt3bl33d3rå¼€æºçš„ä»£ç ï¼Œç›¸æ¯”äºå¼€æºçš„Boolangä»£ç ï¼Œæ·»åŠ äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p>

<ul>
  <li>æ”¯æŒPowershellè°ƒç”¨ï¼Œçœå»ä½¿ç”¨csc.exeç¼–è¯‘çš„æ­¥éª¤ï¼ŒBoolangè„šæœ¬æ˜¯åŠ¨æ€ç¼–è¯‘å’Œå³æ—¶æ‰§è¡Œçš„ï¼Œä½¿ç”¨åå°„åŠ è½½æ‰€éœ€çš„ä¸‰ä¸ªdllï¼Œä¸éœ€è¦ä¾èµ–ä¸‰ä¸ªdll</li>
  <li>æ·»åŠ æ‰§è¡Œshellcodeçš„åŠŸèƒ½</li>
</ul>

<p>è¿™ç§åˆ©ç”¨æ–¹æ³•æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p>

<p>ä½¿ç”¨Boolangè¯­è¨€æ‰§è¡Œshellcodeï¼Œå¯åŠ¨ä»£ç (Powershellè„šæœ¬)ä¸åŒ…æ‹¬æ¶æ„çš„åŠŸèƒ½ï¼Œpayloadå¯ä¿å­˜åœ¨å¦ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ä¸­</p>

<p>ç®€å•ç†è§£ï¼š</p>

<p>é€šè¿‡Boolangè¯­è¨€å¼€å‘äº†ä¸€ä¸ªPowershellæ ¼å¼çš„è„šæœ¬è§£é‡Šå™¨ï¼Œèƒ½åœ¨å†…å­˜ä¸­åŠ¨æ€åŠ è½½å¦ä¸€è„šæœ¬æ–‡ä»¶ä¸­çš„ä»£ç </p>

<h2 id="0x06-é˜²å¾¡æ£€æµ‹">0x06 é˜²å¾¡æ£€æµ‹</h2>
<hr />

<p>åœ¨ä¹‹å‰çš„æ–‡ç« ã€Šæ¸—é€æŠ€å·§â€”â€”Use AutoIt script to create a keyloggerã€‹æ›¾ä»‹ç»è¿‡ç±»ä¼¼çš„æ–¹æ³•ï¼Œé€šè¿‡è„šæœ¬è§£é‡Šå™¨å¯åŠ¨å¦ä¸€è„šæœ¬æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œæ‰€ä»¥é˜²å¾¡æ£€æµ‹çš„æ–¹æ³•ç±»ä¼¼</p>

<p>ç»“åˆåˆ©ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨æ£€æµ‹çš„æ—¶å€™é€šå¸¸ä¼šé‡è§ä»¥ä¸‹æƒ…å†µï¼šå¯åŠ¨ç¨‹åºå’Œpayloadåˆ†ç¦»ï¼Œåœ¨é™æ€æ£€æµ‹ä¸Šå­˜åœ¨å›°éš¾</p>

<p>ä½†æ˜¯è¿™ä¸ªæŠ€æœ¯æ— æ³•ç»•è¿‡å¯¹ç¨‹åºè¡Œä¸ºçš„æ£€æµ‹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ£€æµ‹è¿›ç¨‹è¡Œä¸ºçš„æ–¹å¼è¿›è¡Œé˜²å¾¡</p>

<h2 id="0x07-å°ç»“">0x07 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†Boolangè¯­è¨€çš„ç‰¹ç‚¹å’Œç”¨æ³•ï¼Œç»“åˆbyt3bl33d3rå¼€æºçš„ä»£ç ï¼Œåˆ†æé€šè¿‡Boolangè¯­è¨€æ‰§è¡Œshellcodeçš„ä¼˜ç‚¹ï¼Œç»™å‡ºé˜²å¾¡æ£€æµ‹çš„å»ºè®®</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET