I"â<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>æœ€è¿‘APT34çš„6æ¬¾å·¥å…·è¢«æ³„éœ²ï¼Œæœ¬æ–‡ä»…åœ¨æŠ€æœ¯è§’åº¦å¯¹å…¶ä¸­çš„PoisonFrogå’ŒGlimpseè¿›è¡Œåˆ†æ</p>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://malware-research.org/apt34-hacking-tools-leak/amp/</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>å¯¹PoisonFrogçš„åˆ†æ</li>
  <li>å¯¹Glimpseçš„åˆ†æ</li>
  <li>å°ç»“</li>
</ul>

<h2 id="0x02-å¯¹poisonfrogçš„åˆ†æ">0x02 å¯¹PoisonFrogçš„åˆ†æ</h2>
<hr />

<p>å¯¹åº”æ³„éœ²æ–‡ä»¶çš„åç§°ä¸ºposion frog</p>

<p>åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ–‡ä»¶ï¼š</p>

<ul>
  <li>agentï¼ŒåŒ…å«æ–‡ä»¶poisonfrog.ps1ï¼Œæ˜¯é€šè¿‡powershellå®ç°çš„æœ¨é©¬ç¨‹åº</li>
  <li>server sideï¼Œå¯¹åº”æœ¨é©¬æ§åˆ¶ç«¯ï¼Œä½¿ç”¨Node.jså¼€å‘</li>
</ul>

<h3 id="1agentå®ç°çš„åŠŸèƒ½">1ã€agentå®ç°çš„åŠŸèƒ½</h3>

<h4 id="1-åœ¨publicpublicæ–‡ä»¶å¤¹ä¸‹é‡Šæ”¾ä¸‰ä¸ªæ–‡ä»¶">1. åœ¨%public%\Publicæ–‡ä»¶å¤¹ä¸‹é‡Šæ”¾ä¸‰ä¸ªæ–‡ä»¶</h4>

<ul>
  <li>dUpdater.ps1</li>
  <li>hUpdater.ps1</li>
  <li>UpdateTask.vbs</li>
</ul>

<p>é‡Šæ”¾æ–‡ä»¶çš„å…·ä½“åŠŸèƒ½å¦‚ä¸‹ï¼š</p>

<p>(1)dUpdater.ps1</p>

<ol>
  <li>ç”Ÿæˆä¸€ä¸ªå½“å‰ç³»ç»Ÿçš„ä¸“æœ‰æ ‡å¿—</li>
  <li>è¯»å–å½“å‰ç³»ç»Ÿçš„ä»£ç†è®¾ç½®</li>
  <li>é€šè¿‡HTTPåè®®ä»c2æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶</li>
  <li>æ ¹æ®ä¸‹è½½æ–‡ä»¶çš„å†…å®¹è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼ŒåŒ…æ‹¬æ‰§è¡Œå‘½ä»¤ï¼Œä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½æ–‡ä»¶</li>
</ol>

<p>(2)hUpdater.ps1</p>

<ol>
  <li>ç”Ÿæˆä¸€ä¸ªå½“å‰è®¡ç®—æœºçš„ä¸“æœ‰æ ‡å¿—</li>
  <li>åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹</li>
</ol>

<ul>
  <li>%public%\Public&lt;id&gt;</li>
  <li>%public%\Public&lt;id&gt;\reveivebox</li>
  <li>%public%\Public&lt;id&gt;\sendbox</li>
  <li>%public%\Public&lt;id&gt;\done</li>
</ul>

<ol>
  <li>é€šè¿‡DNS Aè®°å½•ä»c2æœåŠ¡å™¨æ¥æ”¶æ§åˆ¶å‘½ä»¤</li>
  <li>æ‰§è¡Œå‘½ä»¤å¹¶å›ä¼ ç»“æœ</li>
</ol>

<p>(3)UpdateTask.vbs</p>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>command0 = "Powershell.exe -exec bypass -file C:\Users\Public\Public\hUpdater.ps1"
set Shell0 = CreateObject("wscript.shell")
shell0.run command0, 0, false
command1 = "Powershell.exe -exec bypass -file C:\Users\Public\Public\dUpdater.ps1"
set Shell1 = CreateObject("wscript.shell")
shell1.run command1, 0, false
</code></pre></div></div>

<p>ç”¨æ¥åŠ è½½powershellè„šæœ¬dUpdater.ps1å’ŒhUpdater.ps1</p>

<h4 id="2-åˆ›å»ºä¸¤ä¸ªè®¡åˆ’ä»»åŠ¡">2. åˆ›å»ºä¸¤ä¸ªè®¡åˆ’ä»»åŠ¡</h4>

<ul>
  <li>åç§°ä¸º\UpdateTasks\UpdateTaskï¼Œæ¯10åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œä»¥å½“å‰ç”¨æˆ·æƒé™æ‰§è¡ŒUpdateTask.vbs</li>
  <li>åç§°ä¸º\UpdateTasks\UpdateTaskHostsï¼Œæ¯10åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œä»¥Systemæƒé™æ‰§è¡ŒUpdateTask.vbs</li>
</ul>

<h3 id="2-å¯¹server-sideçš„åˆ†æ">2ã€ å¯¹server sideçš„åˆ†æ</h3>

<p>é€šè¿‡Node.jså®ç°</p>

<p>ä½¿ç”¨æ—¶éœ€è¦å…ˆé€šè¿‡npmå®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼Œå…·ä½“å®‰è£…çš„å‘½ä»¤ä½äºæ–‡ä»¶install_pachages.batä¸­</p>

<p>index.jsä¸ºä¸»ä½“ç¨‹åº</p>

<p>è€ƒè™‘åˆ°é¿å…è¢«æ»¥ç”¨ï¼Œæ§åˆ¶ç«¯çš„ä»£ç ä¸åšå…·ä½“åˆ†æï¼Œä¹Ÿä¸æä¾›å…·ä½“æ­å»ºçš„æ–¹æ³•</p>

<p><strong>æ³¨ï¼š</strong></p>

<p>æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84Node.js-Downloader%E7%9A%84%E5%AE%9E%E7%8E%B0">ã€Šæ¸—é€æµ‹è¯•ä¸­çš„Node.jsâ€”â€”Downloaderçš„å®ç°ã€‹</a>å’Œ<a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84Node.js-%E5%88%A9%E7%94%A8C++%E6%8F%92%E4%BB%B6%E9%9A%90%E8%97%8F%E7%9C%9F%E5%AE%9E%E4%BB%A3%E7%A0%81">ã€Šæ¸—é€æµ‹è¯•ä¸­çš„Node.jsâ€”â€”åˆ©ç”¨C++æ’ä»¶éšè—çœŸå®ä»£ç ã€‹</a>æ›¾ä»‹ç»è¿‡Node.jsçš„ä½¿ç”¨ï¼ŒNode.jsçš„åŸºç¡€çŸ¥è¯†å¯ä»¥å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« </p>

<p>ä½¿ç”¨Node.jså®ç°server sideæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>

<ul>
  <li>è¯­æ³•ç®€å•æ˜“æ‡‚</li>
  <li>è½»é‡åˆé«˜æ•ˆ</li>
  <li>å¯åŒæ—¶éƒ¨ç½²åœ¨Windowså’ŒLinuxç³»ç»Ÿ</li>
</ul>

<h3 id="3è¯¥å·¥å…·çš„å…¬å¼€çº¿ç´¢">3ã€è¯¥å·¥å…·çš„å…¬å¼€çº¿ç´¢</h3>

<ol>
  <li>APT34æ›¾åˆ©ç”¨CVE-2017-11882ä¼ æ’­è¯¥æœ¨é©¬ï¼ŒFireEyeå¯¹æ ·æœ¬è¿›è¡Œè¿‡åˆ†æï¼š</li>
</ol>

<p>https://www.fireeye.com/blog/threat-research/2017/12/targeted-attack-in-middle-east-by-apt34.html</p>

<ol>
  <li>Palo Alto Networkså°†å…¶å‘½åä¸ºEarly BondUpdaterï¼Œå¯¹æ ·æœ¬çš„åˆ†æèµ„æ–™ï¼š</li>
</ol>

<p>https://unit42.paloaltonetworks.com/dns-tunneling-in-the-wild-overview-of-oilrigs-dns-tunneling/</p>

<h2 id="0x03-å¯¹glimpseçš„åˆ†æ">0x03 å¯¹Glimpseçš„åˆ†æ</h2>
<hr />

<p>å¯¹åº”æ³„éœ²æ–‡ä»¶çš„åç§°ä¸ºGlimpse</p>

<p>åŒ…æ‹¬å››éƒ¨åˆ†æ–‡ä»¶ï¼š</p>

<ul>
  <li>Agentï¼ŒåŒ…å«å››ä¸ªæ–‡ä»¶dns.ps1ã€dns_main.ps1ã€refineddns_main.ps1å’Œrunner_.vbs</li>
  <li>panelï¼ŒåŒ…å«ä¸€ä¸ªc#å¼€å‘çš„ç•Œé¢ç¨‹åºï¼Œæ˜¯ç•Œé¢åŒ–çš„æœ¨é©¬æ§åˆ¶ç«¯</li>
  <li>serverï¼Œæ˜¯Node.jså¼€å‘çš„æœ¨é©¬æ§åˆ¶ç«¯</li>
  <li>Read me.txtï¼Œé…ç½®è¯´æ˜æ–‡æ¡£</li>
</ul>

<h3 id="1agentå®ç°çš„åŠŸèƒ½-1">1ã€agentå®ç°çš„åŠŸèƒ½</h3>

<p>dns.ps1ã€dns_main.ps1å’Œrefineddns_main.ps1ä¸‰ä¸ªæ–‡ä»¶çš„åŠŸèƒ½ç›¸åŒ</p>

<p>åŸå§‹ç‰ˆæœ¬ä¸ºdns_main.ps1</p>

<p>dns.ps1å’Œrefineddns_main.ps1åªæ˜¯å˜é‡åç§°æ›¿æ¢æˆäº†æ— æ„ä¹‰çš„æ··æ·†å­—ç¬¦ä¸²</p>

<p>dns_main.ps1çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>åˆ›å»ºæ–‡ä»¶å¤¹%public%\Libraries</p>
  </li>
  <li>
    <p>åˆ¤æ–­æ–‡ä»¶%public%\Libraries\lockæ˜¯å¦å­˜åœ¨</p>
  </li>
</ol>

<ul>
  <li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥å½“å‰powershellè¿›ç¨‹çš„pid</li>
  <li>å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œè¯»å–æ–‡ä»¶åˆ›å»ºæ—¶é—´ï¼Œå¦‚æœè·ç¦»ç°åœ¨çš„æ—¶é—´è¶…è¿‡10åˆ†é’Ÿï¼Œé‚£ä¹ˆä¼šé€€å‡ºè¿›ç¨‹å¹¶åˆ é™¤lockæ–‡ä»¶</li>
</ul>

<ol>
  <li>
    <p>ç”Ÿæˆä¸€ä¸ªå½“å‰ç³»ç»Ÿçš„ä¸“æœ‰æ ‡å¿—ï¼Œå†™å…¥æ–‡ä»¶%public%\Libraries\quid</p>
  </li>
  <li>
    <p>åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹</p>
  </li>
</ol>

<ul>
  <li>%public%\Libraries\files</li>
  <li>%public%\Libraries&lt;id&gt;</li>
  <li>%public%\Libraries&lt;id&gt;\reveivebox</li>
  <li>%public%\Libraries&lt;id&gt;\sendbox</li>
  <li>%public%\Libraries&lt;id&gt;\done</li>
</ul>

<ol>
  <li>é€šè¿‡DNS Aè®°å½•æˆ–DNS TXTè®°å½•ä»c2æœåŠ¡å™¨æ¥æ”¶æ§åˆ¶å‘½ä»¤</li>
  <li>æ‰§è¡Œå‘½ä»¤å¹¶å›ä¼ ç»“æœ</li>
</ol>

<h3 id="2-å¯¹serverçš„åˆ†æ">2ã€ å¯¹serverçš„åˆ†æ</h3>

<p>é€šè¿‡Node.jså®ç°</p>

<p>ä½¿ç”¨æ—¶éœ€è¦å…ˆé€šè¿‡npmå®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼Œå…·ä½“å®‰è£…çš„å‘½ä»¤ä½äºæ–‡ä»¶Read me.txtä¸­</p>

<p>ç›¸æ¯”äºPoisonFrogï¼ŒGlimpseåœ¨ä»£ç ç»“æ„ä¸Šåšäº†ä¼˜åŒ–ï¼Œå¹¶ä¸”æ·»åŠ äº†é€šè¿‡DNS TXTè®°å½•ä¼ è¾“æ•°æ®çš„åŠŸèƒ½</p>

<p>è€ƒè™‘åˆ°é¿å…è¢«æ»¥ç”¨ï¼Œæ§åˆ¶ç«¯çš„ä»£ç ä¸åšå…·ä½“åˆ†æï¼Œä¹Ÿä¸æä¾›å…·ä½“æ­å»ºçš„æ–¹æ³•</p>

<h3 id="3è¯¥å·¥å…·çš„å…¬å¼€çº¿ç´¢-1">3ã€è¯¥å·¥å…·çš„å…¬å¼€çº¿ç´¢</h3>

<ol>
  <li>Palo Alto Networkså°†å…¶å‘½åä¸ºUpdated BondUpdaterï¼Œå¯¹æ ·æœ¬çš„åˆ†æèµ„æ–™ï¼š</li>
</ol>

<p>https://unit42.paloaltonetworks.com/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/</p>

<h2 id="0x04-å°ç»“">0x04 å°ç»“</h2>
<hr />

<p>å¯¹äºPoisonFrogå’ŒGlimpseï¼Œè™½ç„¶è¿™æ¬¡æ³„éœ²äº†å·¥å…·æºç ï¼Œä½†å®ƒä»¬æ—©åœ¨2017å¹´å·²ç»è¢«æ•è·æ ·æœ¬ï¼Œä¹Ÿè¢«åˆ†æçš„å¾ˆæ¸…æ¥šï¼Œä¸ªäººè®¤ä¸ºè¯¥å·¥å…·ä¸å­˜åœ¨è¢«å¤§è§„æ¨¡æ»¥ç”¨çš„éšæ‚£ã€‚è€Œä½¿ç”¨DNSåè®®ä¼ è¾“æ•°æ®ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„æ–¹æ³•ï¼Œä¸ªäººè®¤ä¸ºè¯¥å·¥å…·ä¸ä¼šå¯¼è‡´æ¶æ„è½¯ä»¶æŠ€æœ¯çš„å‡çº§ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET