I"Ö#<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>Pupyåœ¨Windowså¹³å°ä¸‹çš„åæ¸—é€æ¨¡å—åŒ…æ‹¬ä¸€ä¸ªå®ç”¨çš„åŠŸèƒ½ï¼šå±å¹•æ§åˆ¶ã€‚è¿™ä¸ªåŠŸèƒ½ä¸ä»…èƒ½å¤ŸæŸ¥çœ‹å±å¹•å†…å®¹ï¼Œä¹Ÿèƒ½å¤Ÿå‘é€é¼ æ ‡å’Œé”®ç›˜æ¶ˆæ¯ã€‚æœ¬æ–‡å°†è¦å¯¹è¿™ä¸ªåŠŸèƒ½çš„å®ç°æ–¹æ³•è¿›è¡Œåˆ†æï¼Œæ¢ä¸€ç§æ€è·¯å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä¾¿äºäºŒæ¬¡å¼€å‘ã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>Pupyçš„å±å¹•æ§åˆ¶æ¨¡å—æµ‹è¯•</li>
  <li>Pupyçš„å®ç°æ–¹æ³•</li>
  <li>å¦ä¸€ç§å®ç°æ–¹æ³•</li>
</ul>

<h2 id="0x02-pupyçš„å±å¹•æ§åˆ¶æ¨¡å—æµ‹è¯•">0x02 Pupyçš„å±å¹•æ§åˆ¶æ¨¡å—æµ‹è¯•</h2>
<hr />

<p>Pupyçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ã€ŠPupyåˆ©ç”¨åˆ†æâ€”â€”Windowså¹³å°ä¸‹çš„åŠŸèƒ½ã€‹</p>

<p>è·å¾—sessionåï¼Œè¾“å…¥<code class="language-plaintext highlighter-rouge">rdesktop</code>åŠ è½½å±å¹•æ§åˆ¶æ¨¡å—ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-4-22/2-1.png" alt="Alt text" /></p>

<p>æµè§ˆå™¨è®¿é—®urlå¯ä»¥å¯¹å±å¹•è¿›è¡ŒæŸ¥çœ‹å’Œæ“ä½œï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-4-22/2-2.png" alt="Alt text" /></p>

<p>è¿™é‡Œæ”¯æŒè¾“å…¥é”®ç›˜æ¶ˆæ¯å’Œé¼ æ ‡å•å‡»çš„æ“ä½œ</p>

<p>åœ¨ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™è¿›è¡Œæ“ä½œæ—¶éœ€è¦æ³¨æ„UACçš„é—®é¢˜(æ— æ³•å¯¹UACçš„å¼¹æ¡†è¿›è¡Œæ“ä½œ)</p>

<p>å¼¹å‡ºUACæ—¶ä¼šåˆ›å»ºè¿›ç¨‹<code class="language-plaintext highlighter-rouge">consent.exe</code></p>

<p>éœ€è¦ä½¿ç”¨Systemæƒé™å…³é—­è¿™ä¸ªè¿›ç¨‹ï¼Œå…³é—­åå¼¹å‡ºå¯¹è¯æ¡†æç¤º<code class="language-plaintext highlighter-rouge">The storage control block address is invalid.</code></p>

<p>å¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-4-22/2-3.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>å…³é—­UACå¼¹æ¡†æç¤ºçš„cmdå‘½ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 0 /f
</code></pre></div></div>

<p>å¼€å¯UACå¼¹æ¡†æç¤ºçš„cmdå‘½ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 5 /f
</code></pre></div></div>

<h2 id="0x03-pupyçš„å®ç°æ–¹æ³•">0x03 Pupyçš„å®ç°æ–¹æ³•</h2>
<hr />

<p>rdesktopæ¨¡å—çš„å®ç°ä»£ç ï¼šhttps://github.com/n1nj4sec/pupy/blob/unstable/pupy/modules/rdesktop.py</p>

<p>åœ¨å®ç°ä¸Šåˆ†æˆä»¥ä¸‹ä¸‰éƒ¨åˆ†ï¼š</p>

<h4 id="1client">1.Client</h4>

<p>åŒç›®æ ‡å±å¹•è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š</p>

<ul>
  <li>å›ä¼ ç›®æ ‡å½“å‰çš„å±å¹•å†…å®¹</li>
  <li>æ¥æ”¶Serverçš„é¼ æ ‡å’Œé”®ç›˜æ¶ˆæ¯å¹¶æ‰§è¡Œ</li>
</ul>

<p>å®ç°ä»£ç ï¼š</p>

<p>https://github.com/n1nj4sec/pupy/blob/unstable/pupy/packages/all/rdesktop.py</p>

<h4 id="2transfer">2.transfer</h4>

<p>Clientå’ŒServerä¹‹é—´é€šä¿¡çš„æ¡¥æ¢ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š</p>

<ul>
  <li>æ¥æ”¶Clientçš„æ¶ˆæ¯ï¼Œè§£ç åè½¬å‘è‡³æœ¬åœ°çš„æŒ‡å®šç«¯å£ï¼Œç”¨ä½œæµè§ˆå™¨è®¿é—®</li>
  <li>ç¼–ç æµè§ˆå™¨çš„é¼ æ ‡å’Œé”®ç›˜æ¶ˆæ¯å¹¶å‘é€è‡³Client</li>
</ul>

<p>å®ç°ä»£ç ï¼š</p>

<p>https://github.com/n1nj4sec/pupy/blob/unstable/pupy/network/lib/transports/websocket.py</p>

<p>https://github.com/n1nj4sec/pupy/blob/unstable/pupy/network/transports/ws/conf.py</p>

<h4 id="3server">3.Server</h4>

<p>é€šè¿‡æµè§ˆå™¨æ§åˆ¶ç›®æ ‡å±å¹•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š</p>

<ul>
  <li>åœ¨æµè§ˆå™¨æ˜¾ç¤ºClientçš„å±å¹•å†…å®¹</li>
  <li>è·å–å½“å‰æµè§ˆå™¨çš„é¼ æ ‡å’Œé”®ç›˜æ¶ˆæ¯å¹¶å‘é€è‡³transfer</li>
</ul>

<p>å®ç°ä»£ç ï¼š</p>

<p>https://github.com/n1nj4sec/pupy/blob/unstable/pupy/webstatic/rdesktop/index.html</p>

<p>https://github.com/n1nj4sec/pupy/blob/unstable/pupy/webstatic/rdesktop/rdesktop.js</p>

<p>Pupyåœ¨å®ç°ä¸Šï¼ŒClientå’ŒServerä¹‹é—´é€šè¿‡transferå¤„ç†æ•°æ®ï¼Œä½¿ç”¨RSA+AESåŠ å¯†ï¼Œä¼˜ç‚¹æ˜¯å¢åŠ è¿˜åŸé€šä¿¡æ•°æ®çš„éš¾åº¦</p>

<p>ä¸ºäº†ç›´è§‚çš„è¯»å–é€šä¿¡æ•°æ®ï¼Œä¾¿äºå±å¹•æ§åˆ¶åŠŸèƒ½çš„äºŒæ¬¡å¼€å‘ï¼Œæ‰€ä»¥è¿™é‡Œå°è¯•å»æ‰transferåŠŸèƒ½ï¼Œå®ç°Clientå’ŒServerä¹‹é—´çš„ç›´æ¥é€šä¿¡</p>

<h2 id="0x04-å¦ä¸€ç§å®ç°æ–¹æ³•">0x04 å¦ä¸€ç§å®ç°æ–¹æ³•</h2>
<hr />

<p>è¿™é‡ŒåŸºäº<a href="https://github.com/BernardoGO/HTTP-Remote-Desktop-Server">HTTP-Remote-Desktop-Server</a>è¿›è¡Œä»‹ç»</p>

<h3 id="1http-remote-desktop-serverçš„ç¯å¢ƒæ­å»º">1.HTTP-Remote-Desktop-Serverçš„ç¯å¢ƒæ­å»º</h3>

<p>HTTP-Remote-Desktop-Serverçš„run.pyä¸­ä½¿ç”¨äº†Python2ä¸‹çš„PyGtkåº“(import gtk.gdk)</p>

<p>è€Œæœ€æ–°çš„PyGtkåº“ä¸å†æ”¯æŒPython2ï¼Œæ”¹ä¸ºPython3</p>

<p>ä¸ºäº†èƒ½å¤Ÿç¼–è¯‘ä»£ç ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</p>

<p>(1)éœ€è¦å®‰è£…32ä½çš„Python2</p>

<p>64ä½ç³»ç»Ÿä¹Ÿéœ€è¦å®‰è£…32ä½çš„Python2ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨PyGtkåº“</p>

<p>(2)ä¸‹è½½Python2ä¸‹çš„PyGtkåº“</p>

<p>åœ°å€ï¼š</p>

<p>http://ftp.gnome.org/pub/GNOME/binaries/win32/pygtk/2.24/pygtk-all-in-one-2.24.0.win32-py2.7.msi</p>

<p>(3)å®‰è£…å…¶ä»–åŒ…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install -U wxPython
pip install pyautogui
</code></pre></div></div>

<h3 id="2http-remote-desktop-serverçš„æµ‹è¯•">2.HTTP-Remote-Desktop-Serverçš„æµ‹è¯•</h3>

<p>ä¿®æ”¹run.pyä¸­çš„IPï¼Œè®¾ç½®ä¸ºå½“å‰æ“ä½œç³»ç»Ÿçš„ipï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-4-22/3-1.png" alt="Alt text" /></p>

<p>å¯åŠ¨run.py</p>

<p>åœ¨å¦ä¸€ç³»ç»Ÿä¸Šï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®æŒ‡å®šurlï¼Œè·å¾—å±å¹•å†…å®¹ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2020-4-22/3-2.png" alt="Alt text" /></p>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä½¿ç”¨æ—¶éœ€è¦å¼€å¯é˜²ç«å¢™è§„åˆ™ï¼Œå¯¹åº”çš„cmdå‘½ä»¤å¦‚ä¸‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="test" protocol=TCP dir=in localport=9010 action=allow
</code></pre></div></div>

<h3 id="3http-remote-desktop-serverçš„å®ç°">3.HTTP-Remote-Desktop-Serverçš„å®ç°</h3>

<p>(1)Client</p>

<p>åŒç›®æ ‡å±å¹•è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š</p>

<ul>
  <li>æˆªå–å½“å‰å±å¹•ï¼Œä¿å­˜ä¸º<code class="language-plaintext highlighter-rouge">screenshot.png</code></li>
  <li>æ¥æ”¶Serverçš„é¼ æ ‡å’Œé”®ç›˜æ¶ˆæ¯å¹¶æ‰§è¡Œ</li>
</ul>

<p>å®ç°ä»£ç ï¼š</p>

<p>https://github.com/BernardoGO/HTTP-Remote-Desktop-Server/blob/master/run.py</p>

<p>(2)Server</p>

<p>é€šè¿‡æµè§ˆå™¨æ§åˆ¶ç›®æ ‡å±å¹•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š</p>

<ul>
  <li>åœ¨æµè§ˆå™¨æ˜¾ç¤º<code class="language-plaintext highlighter-rouge">screenshot.png</code></li>
  <li>è·å–å½“å‰æµè§ˆå™¨çš„é¼ æ ‡å’Œé”®ç›˜æ¶ˆæ¯å¹¶å‘é€è‡³Client</li>
</ul>

<p>å®ç°ä»£ç ï¼š</p>

<p>https://github.com/BernardoGO/HTTP-Remote-Desktop-Server/blob/master/index.html</p>

<p>https://github.com/BernardoGO/HTTP-Remote-Desktop-Server/blob/master/scripts.js</p>

<p>HTTP-Remote-Desktop-Serveråœ¨å®ç°ä¸Šé€šè¿‡æˆªå–å±å¹•(screenshot.png)æ˜¾ç¤ºå’Œå‘é€å‘½ä»¤ï¼Œæ‰€ä»¥æ— æ³•è¿ç»­æ˜¾ç¤ºï¼Œéœ€è¦åˆ·æ–°åæ‰èƒ½è·å¾—æ–°çš„å±å¹•å†…å®¹</p>

<p>æ”¯æŒé”®ç›˜è¾“å…¥ï¼Œä½†éœ€è¦åˆ·æ–°åæ‰èƒ½è·å¾—æ–°çš„å±å¹•å†…å®¹</p>

<h3 id="4http-remote-desktop-serverçš„ä¼˜åŒ–">4.HTTP-Remote-Desktop-Serverçš„ä¼˜åŒ–</h3>

<p>æˆ‘forkäº†åŸä»£ç ï¼Œä¿®æ”¹åçš„ä»£ç åœ°å€ï¼š</p>

<p>https://github.com/3gstudent/HTTP-Remote-Desktop-Server</p>

<p>ä¼˜åŒ–å¦‚ä¸‹ï¼š</p>

<p>(1)å°†index.htmlä¸­å¼•ç”¨jQueryçš„åœ°å€æ”¹æˆç›¸å¯¹è·¯å¾„</p>

<p>(2)ä¿®æ”¹run.pyï¼Œé€šè¿‡å‚æ•°ä¼ å…¥ç›‘å¬çš„IPå’Œç«¯å£</p>

<p>(3)å°†Pythonä»£ç ç¼–è¯‘æˆç‹¬ç«‹çš„exeæ–‡ä»¶</p>

<p>ä½¿ç”¨Pyinstallerï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Python27\Scripts\pyinstaller.exe -F run.py
</code></pre></div></div>

<p>ç¼–è¯‘åçš„æ–‡ä»¶åœ°å€ï¼š</p>

<p>https://github.com/3gstudent/HTTP-Remote-Desktop-Server/releases/download/v1.0/run.exe</p>

<p>ä¸ºäº†æ”¯æŒé¼ æ ‡åŒå‡»æ“ä½œï¼Œå¯ä»¥ä¿®æ”¹run.pyï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pyautogui.click(clicks=2)
</code></pre></div></div>

<p>åœ¨äºŒæ¬¡å¼€å‘ä¸Šéœ€è¦æ³¨æ„å¦‚ä¸‹é—®é¢˜ï¼š</p>

<p>(1)é€šä¿¡æ•°æ®æœªåšç¼–ç ï¼Œå¯ä»¥é€‰æ‹©å‹ç¼©ç®—æ³•æé«˜æ•ˆç‡</p>

<p>(2)è®¿é—®<code class="language-plaintext highlighter-rouge">url:port/screenshot.png</code>å¯ä»¥è·å¾—å±å¹•æˆªå›¾</p>

<p>(3)ä½¿ç”¨æ—¶éœ€è¦å¼€å¯é˜²ç«å¢™è§„åˆ™ï¼Œå¯¹åº”çš„cmdç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="test" protocol=TCP dir=in localport=9010 action=allow
</code></pre></div></div>

<h2 id="0x05-å°ç»“">0x05 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡åˆ†æäº†Pupyçš„å®ç°æ–¹æ³•ï¼Œä»¥<a href="https://github.com/BernardoGO/HTTP-Remote-Desktop-Server">HTTP-Remote-Desktop-Server</a>ä¸ºæ¨¡æ¿ä»‹ç»äº†ç¬¬äºŒç§å®ç°æ–¹æ³•ï¼Œä¾¿äºäºŒæ¬¡å¼€å‘ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET