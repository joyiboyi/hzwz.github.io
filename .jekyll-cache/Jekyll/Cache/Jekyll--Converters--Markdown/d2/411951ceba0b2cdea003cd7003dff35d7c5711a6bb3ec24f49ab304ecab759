I"ƒ <h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E5%AF%BC%E5%87%BAFirefox%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">ã€Šæ¸—é€æŠ€å·§â€”â€”å¯¼å‡ºFirefoxæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ã€‹</a>ä»‹ç»äº†å¯¼å‡ºFirefoxæµè§ˆå™¨å¯†ç çš„å¸¸ç”¨æ–¹æ³•ï¼Œå…¶ä¸­<a href="https://github.com/unode/firefox_decrypt">firefox_decrypt.py</a>ä½¿ç”¨NSS(Network Security Services)è¿›è¡Œè§£å¯†ï¼Œæ”¯æŒkey3.dbå’Œkey4.dbçš„Master Passwordè§£å¯†ã€‚æœ¬æ–‡å°†è¦å¯¹å…¶æ¶‰åŠçš„åŸç†è¿›è¡Œä»‹ç»ï¼Œç¼–å†™æµ‹è¯•ä»£ç ï¼Œå®ç°å¯¹Master Passwordçš„éªŒè¯ï¼Œåˆ†äº«è„šæœ¬ç¼–å†™çš„ç»†èŠ‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»å¦‚ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>Network Security Servicesç®€ä»‹</li>
  <li>é€šè¿‡pythonè°ƒç”¨Network Security Serviceså¯¼å‡ºFirefoxæµè§ˆå™¨å¯†ç </li>
  <li>å¼€æºpythonè„šæœ¬</li>
  <li>çˆ†ç ´è„šæœ¬çš„å®ç°</li>
</ul>

<h2 id="0x02-network-security-servicesç®€ä»‹">0x02 Network Security Servicesç®€ä»‹</h2>
<hr />

<p>Network Security Services(NSS)æ˜¯ä¸€ç»„æ—¨åœ¨æ”¯æŒå®‰å…¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºè·¨å¹³å°å¼€å‘çš„åº“</p>

<p>å‚è€ƒæ–‡æ¡£ï¼š</p>

<p>https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS</p>

<p>Firefoxæµè§ˆå™¨ä½¿ç”¨NSSä½œä¸ºåŠ å¯†ç®—æ³•å’Œå®‰å…¨ç½‘ç»œåè®®çš„åŸºç¡€åº“ï¼Œåœ¨å‡­æ®åŠ è§£å¯†ä¸Šä½¿ç”¨äº†PKCS#11æ ‡å‡†</p>

<p>å‚è€ƒæ–‡æ¡£ï¼š</p>

<p>https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/PKCS11</p>

<h2 id="0x03-é€šè¿‡pythonè°ƒç”¨network-security-serviceså¯¼å‡ºfirefoxæµè§ˆå™¨çš„å¯†ç ">0x03 é€šè¿‡Pythonè°ƒç”¨Network Security Serviceså¯¼å‡ºFirefoxæµè§ˆå™¨çš„å¯†ç </h2>
<hr />

<p>å‚è€ƒä»£ç ï¼š</p>

<p>https://github.com/unode/firefox_decrypt</p>

<p>https://github.com/Kerisa/BrowserPasswordDump/blob/master/MozillaPwd.py</p>

<p>Windowsç³»ç»Ÿä¸‹çš„è§£å¯†æµç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>åŠ è½½Network Security Serviceséœ€è¦çš„nss3.dll</li>
  <li>è°ƒç”¨NSS_Init()è¿›è¡Œåˆå§‹åŒ–</li>
  <li>è°ƒç”¨PK11_GetInternalKeySlot()æ¥è·å¾—internal slot(ç”¨ä½œéªŒè¯Master Password)</li>
  <li>è°ƒç”¨PK11_CheckUserPassword()éªŒè¯Master Password</li>
  <li>è¯»å–logins.jsonè·å¾—åŠ å¯†æ•°æ®</li>
  <li>è°ƒç”¨PK11SDR_Decrypt()è¿›è¡Œè§£å¯†</li>
</ol>

<p>å…·ä½“éœ€è¦æ³¨æ„çš„é—®é¢˜å¦‚ä¸‹ï¼š</p>

<h3 id="1-pythonå’Œfirefoxçš„ç‰ˆæœ¬éœ€è¦ä¿æŒä¸€è‡´">1. Pythonå’ŒFirefoxçš„ç‰ˆæœ¬éœ€è¦ä¿æŒä¸€è‡´</h3>

<p>64ä½ç³»ç»Ÿä¸‹ï¼Œéœ€è¦åŒä¸º32ä½æˆ–64ä½</p>

<h3 id="2-å°†firefoxçš„å®‰è£…è·¯å¾„åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¾¿äºè°ƒç”¨">2. å°†Firefoxçš„å®‰è£…è·¯å¾„åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ï¼Œä¾¿äºè°ƒç”¨</h3>

<p>Firefoxæµè§ˆå™¨çš„å®‰è£…ç›®å½•ä¸‹æœ‰æˆ‘ä»¬éœ€è¦è°ƒç”¨çš„nss3.dllï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©å°†Firefoxçš„å®‰è£…è·¯å¾„åŠ å…¥åˆ°ç¯å¢ƒå˜é‡PATHï¼Œå¯¹åº”çš„pythonä»£ç å¦‚ä¸‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
firefoxPath = "C:\Program Files\Mozilla Firefox"
os.environ["PATH"] = ';'.join([firefoxPath, os.environ["PATH"]])
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>64ä½æ“ä½œç³»ç»Ÿä¸‹ï¼Œ64ä½Firefoxæµè§ˆå™¨çš„é»˜è®¤å®‰è£…ç›®å½•ä¸º<code class="language-plaintext highlighter-rouge">C:\Program Files\Mozilla Firefox</code>ï¼Œ32ä½Firefoxæµè§ˆå™¨çš„é»˜è®¤å®‰è£…ç›®å½•ä¸º<code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\Mozilla Firefox</code></p>

<p>è°ƒç”¨nss3.dllçš„pythonä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import ctypes
NssDll = ctypes.CDLL("nss3.dll")
</code></pre></div></div>

<h3 id="3-nssåˆå§‹åŒ–æ—¶éœ€è¦ä¸‰ä¸ªæ–‡ä»¶">3. NSSåˆå§‹åŒ–æ—¶éœ€è¦ä¸‰ä¸ªæ–‡ä»¶</h3>

<p>å…·ä½“ä½ç½®ä¸ºï¼š<code class="language-plaintext highlighter-rouge">%APPDATA%\Mozilla\Firefox\Profiles\xxxxxxxx.default\</code></p>

<p>éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼š</p>

<ul>
  <li>cert9.db</li>
  <li>key4.db</li>
  <li>logins.json</li>
</ul>

<p>å¯å°†ä»¥ä¸Šä¸‰ä¸ªæ–‡ä»¶ä¿å­˜åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹ï¼Œä¾‹å¦‚<code class="language-plaintext highlighter-rouge">c:\test\data</code></p>

<p>NSSåˆå§‹åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>profilePath = "C:\\test\\data"
NssDll.NSS_Init(profilePath)
</code></pre></div></div>

<h3 id="4-è¯»å–loginsjsonè·å¾—åŠ å¯†çš„æ•°æ®">4. è¯»å–logins.jsonè·å¾—åŠ å¯†çš„æ•°æ®</h3>

<p><code class="language-plaintext highlighter-rouge">encryptedUsername</code>å’Œ<code class="language-plaintext highlighter-rouge">encryptedPassword</code>é¡¹ä¸ºåŠ å¯†çš„æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨NSSè¿›è¡Œè§£å¯†</p>

<p>åœ¨è§£å¯†å‰éœ€è¦å…ˆè¿›è¡Œbase64è§£ç ï¼Œå†è°ƒç”¨<code class="language-plaintext highlighter-rouge">PK11SDR_Decrypt()</code>è§£å¯†è·å¾—æ˜æ–‡</p>

<p><code class="language-plaintext highlighter-rouge">timeCreated</code>ã€<code class="language-plaintext highlighter-rouge">timeLastUsed</code>å’Œ<code class="language-plaintext highlighter-rouge">timePasswordChanged</code>é¡¹ä¸ºEpoch Timeæ ¼å¼(ä»åè°ƒä¸–ç•Œæ—¶1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’èµ·åˆ°ç°åœ¨çš„æ€»ç§’æ•°,ä¸åŒ…æ‹¬é—°ç§’)ï¼Œå¯é€šè¿‡å¦‚ä¸‹ç½‘å€è½¬æ¢æˆå®é™…çš„æ—¶é—´ï¼š</p>

<p>https://esqsoft.com/javascript_examples/date-to-epoch.htm</p>

<p>è½¬æ¢æ—¶é—´æ ¼å¼çš„pythonä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from datetime import datetime
def timestamp_to_strtime(timestamp):
	return datetime.fromtimestamp(timestamp / 1000.0).strftime('%Y-%m-%d %H:%M:%S')
print timestamp_to_strtime(1580901797579) 
</code></pre></div></div>

<p><strong>æ³¨:</strong></p>

<p>ä¸åŒç‰ˆæœ¬çš„Firefoxä¿å­˜è®°å½•çš„æ–‡ä»¶åç§°ä¸åŒï¼Œå…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š</p>

<ul>
  <li>Versionå¤§äºç­‰äº32.0ï¼Œä¿å­˜è®°å½•çš„æ–‡ä»¶ä¸ºlogins.json</li>
  <li>Versionå¤§äºç­‰äº3.5ï¼Œå°äº32.0ï¼Œä¿å­˜è®°å½•çš„æ–‡ä»¶ä¸ºsignons.sqlite</li>
</ul>

<p>æ›´è¯¦ç»†çš„æ–‡ä»¶è¯´æ˜å¯å‚è€ƒï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://kb.mozillazine.org/Profile_folder_-_Firefox
</code></pre></div></div>

<h2 id="0x04-å¼€æºpythonè„šæœ¬">0x04 å¼€æºpythonè„šæœ¬</h2>
<hr />

<p>å‚è€ƒä»£ç ï¼š</p>

<p>https://github.com/unode/firefox_decrypt</p>

<p>https://github.com/Kerisa/BrowserPasswordDump/blob/master/MozillaPwd.py</p>

<p>æˆ‘çš„æµ‹è¯•ä»£ç å·²ä¸Šä¼ è‡³GitHubï¼Œåœ°å€å¦‚ä¸‹:</p>

<p>https://github.com/3gstudent/Homework-of-Python/blob/master/ExportFirefoxPassword.py</p>

<p>æµ‹è¯•ç¯å¢ƒ:</p>

<ul>
  <li>64ä½Windowsæ“ä½œç³»ç»Ÿå®‰è£…64ä½Firefoxæµè§ˆå™¨</li>
  <li>Firefoxé»˜è®¤å®‰è£…è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">"C:\Program Files\Mozilla Firefox"</code></li>
  <li>é…ç½®æ–‡ä»¶è·¯å¾„ä¸º<code class="language-plaintext highlighter-rouge">"C:\\Users\\a\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\2yi8qmhz.default-beta"</code>ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼š</li>
  <li>cert9.db</li>
  <li>key4.db</li>
  <li>logins.json</li>
</ul>

<p>ä»£ç æ”¯æŒä¸¤ä¸ªåŠŸèƒ½ï¼š</p>

<h3 id="1-éªŒè¯master-password">1. éªŒè¯Master Password</h3>

<p>å¯¹åº”å­å‡½æ•°<code class="language-plaintext highlighter-rouge">checkMasterPassword(MasterPassword)</code></p>

<p>å¦‚æœMasterPasswordæ­£ç¡®ï¼Œæ˜¾ç¤ºæ­£ç¡®çš„MasterPasswordï¼Œå¹¶è¿”å›TRUE</p>

<p>å¦‚æœMasterPasswordé”™è¯¯ï¼Œè¿”å›FALSE</p>

<p>è¿™ä¸ªå¯ä»¥ç”¨æ¥å®ç°å¯¹Master Passwordçš„çˆ†ç ´</p>

<h3 id="2-å¯¼å‡ºfirefoxæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç ">2. å¯¼å‡ºFirefoxæµè§ˆå™¨ä¸­ä¿å­˜çš„å¯†ç </h3>

<p>å¯¹åº”å­å‡½æ•°<code class="language-plaintext highlighter-rouge">ExportData(MasterPassword)</code></p>

<p>å¦‚æœæœªè®¾ç½®Master Passwordï¼ŒMasterPasswordå‚æ•°è®¾ç½®ä¸º<code class="language-plaintext highlighter-rouge">""</code>å³å¯</p>

<p>å¦‚æœè®¾ç½®äº†Master Passwordï¼Œéœ€è¦å¡«å…¥æ­£ç¡®çš„Master Passwordæ‰èƒ½è§£å¯†è·å¾—çœŸæ­£çš„æ•°æ®</p>

<p>å…·ä½“èƒ½å¤Ÿå¯¼å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>

<ul>
  <li>url</li>
  <li>username</li>
  <li>password</li>
  <li>timeCreated</li>
  <li>timePasswordChanged</li>
  <li>timeLastUsed</li>
</ul>

<h2 id="0x05-å°ç»“">0x05 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†é€šè¿‡Pythonè°ƒç”¨Network Security Serviceså¯¼å‡ºFirefoxæµè§ˆå™¨å¯†ç çš„æ–¹æ³•ï¼Œåˆ†äº«è„šæœ¬ç¼–å†™ç»†èŠ‚ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET