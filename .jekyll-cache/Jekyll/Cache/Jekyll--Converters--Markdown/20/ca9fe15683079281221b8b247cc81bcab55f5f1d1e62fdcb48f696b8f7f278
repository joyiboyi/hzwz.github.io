I"·G<h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<hr />

<p>åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è·å¾—äº†ExchangeæœåŠ¡å™¨çš„ç®¡ç†æƒé™ï¼Œä¸‹ä¸€æ­¥å°±éœ€è¦å¯¹ExchangeæœåŠ¡å™¨çš„é‚®ä»¶è¿›è¡Œæœç´¢å’Œå¯¼å‡ºï¼Œæœ¬æ–‡å°†è¦ä»‹ç»å¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•ï¼Œå¼€æº4ä¸ªpowershellè„šæœ¬ï¼Œåˆ†äº«è„šæœ¬ç¼–å†™ç»†èŠ‚ã€‚</p>

<h2 id="0x01-ç®€ä»‹">0x01 ç®€ä»‹</h2>
<hr />

<p>æœ¬æ–‡å°†è¦ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>ç®¡ç†ExchangeæœåŠ¡å™¨ä¸Šé‚®ä»¶çš„ä¸¤ç§æ–¹æ³•</li>
  <li>å¯¼å‡ºé‚®ä»¶çš„ä¸¤ç§æ–¹æ³•</li>
  <li>æœç´¢é‚®ä»¶çš„ä¸¤ç§æ–¹æ³•</li>
</ul>

<p><strong>æ³¨ï¼š</strong></p>

<p>æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•å‡ä¸ºpowershellå‘½ä»¤</p>

<h2 id="0x02-ç®¡ç†exchangeæœåŠ¡å™¨ä¸Šé‚®ä»¶çš„ä¸¤ç§æ–¹æ³•">0x02 ç®¡ç†ExchangeæœåŠ¡å™¨ä¸Šé‚®ä»¶çš„ä¸¤ç§æ–¹æ³•</h2>
<hr />

<h3 id="1å…ˆä½¿ç”¨pssessionè¿æ¥exchangeæœåŠ¡å™¨è¿›è€Œè¿œç¨‹ç®¡ç†é‚®ä»¶">1.å…ˆä½¿ç”¨PSSessionè¿æ¥ExchangeæœåŠ¡å™¨ï¼Œè¿›è€Œè¿œç¨‹ç®¡ç†é‚®ä»¶</h3>

<p>ä½¿ç”¨PSSessionè¿æ¥ExchangeæœåŠ¡å™¨çš„å‘½ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$User = "test\administrator"
$Pass = ConvertTo-SecureString -AsPlainText DomainAdmin123! -Force
$Credential = New-Object System.Management.Automation.PSCredential -ArgumentList $User,$Pass
$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://Exchange01.test.com/PowerShell/ -Authentication Kerberos -Credential $Credential
Import-PSSession $Session -AllowClobber
</code></pre></div></div>

<p>è¡¥å……ï¼š</p>

<p>æŸ¥çœ‹PSSessionï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-PSSession
</code></pre></div></div>

<p>æ–­å¼€PSSessionï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-PSSession $Session
</code></pre></div></div>

<p>æµ‹è¯•å‘½ä»¤(è·å¾—æ‰€æœ‰é‚®ç®±ç”¨æˆ·):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Mailbox
</code></pre></div></div>

<h3 id="2ç›´æ¥åœ¨exchangeæœåŠ¡å™¨ä¸Šæ‰§è¡Œç®¡ç†é‚®ä»¶çš„å‘½ä»¤">2.ç›´æ¥åœ¨ExchangeæœåŠ¡å™¨ä¸Šæ‰§è¡Œç®¡ç†é‚®ä»¶çš„å‘½ä»¤</h3>

<p>æµ‹è¯•å‘½ä»¤(è·å¾—æ‰€æœ‰é‚®ç®±ç”¨æˆ·çš„åç§°):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;
Get-Mailbox
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>ä¸åŒExchangeç‰ˆæœ¬å¯¹åº”çš„ç®¡ç†å•å…ƒåç§°ä¸åŒï¼š</p>

<ul>
  <li>Exchange 2007:
  Add-PSSnapin Microsoft.Exchange.Management.PowerShell.Admin;</li>
  <li>Exchange 2010:
  Add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010;</li>
  <li>Exchange 2013 &amp; 2016:
  Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;</li>
</ul>

<h3 id="è¡¥å……ç®¡ç†exchangeé‚®ä»¶çš„å¸¸ç”¨å‘½ä»¤">è¡¥å……ï¼šç®¡ç†Exchangeé‚®ä»¶çš„å¸¸ç”¨å‘½ä»¤</h3>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/powershell/module/exchange/?view=exchange-ps</p>

<h4 id="1è·å¾—æ‰€æœ‰é‚®ç®±ç”¨æˆ·åç§°">(1)è·å¾—æ‰€æœ‰é‚®ç®±ç”¨æˆ·åç§°ï¼š</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Mailbox -ResultSize unlimited
</code></pre></div></div>

<p>é»˜è®¤æ˜¾ç¤º1000ä¸ªç”¨æˆ·ï¼ŒåŠ ä¸Š<code class="language-plaintext highlighter-rouge">-ResultSize unlimited</code>å¯ä»¥è·å¾—æ‰€æœ‰ç”¨æˆ·</p>

<h4 id="2è·å¾—æ‰€æœ‰é‚®ç®±çš„ä¿¡æ¯åŒ…æ‹¬é‚®ä»¶æ•°å’Œä¸Šæ¬¡è®¿é—®é‚®ç®±çš„æ—¶é—´">(2)è·å¾—æ‰€æœ‰é‚®ç®±çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é‚®ä»¶æ•°å’Œä¸Šæ¬¡è®¿é—®é‚®ç®±çš„æ—¶é—´</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Mailbox | Get-MailboxStatistics
</code></pre></div></div>

<h4 id="3è·å¾—æ‰€æœ‰ou">(3)è·å¾—æ‰€æœ‰OU</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-OrganizationalUnit
</code></pre></div></div>

<h4 id="4é€šè¿‡é‚®ä»¶è·Ÿè¸ªæ—¥å¿—è·å¾—æ”¶å‘é‚®ä»¶çš„ç›¸å…³ä¿¡æ¯">(4)é€šè¿‡é‚®ä»¶è·Ÿè¸ªæ—¥å¿—è·å¾—æ”¶å‘é‚®ä»¶çš„ç›¸å…³ä¿¡æ¯</h4>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/powershell/module/exchange/mail-flow/get-messagetrackinglog?view=exchange-ps</p>

<p>é‚®ä»¶è·Ÿè¸ªæ—¥å¿—é»˜è®¤ä¿å­˜ä½ç½®ï¼š<code class="language-plaintext highlighter-rouge">%ExchangeInstallPath%TransportRoles\Logs\MessageTracking</code></p>

<p>æŸ¥çœ‹å‘ä»¶äºº<code class="language-plaintext highlighter-rouge">test1@test.com</code>ä»2019å¹´1æœˆ1æ—¥9:00è‡³ä»Šå‘é€çš„æ‰€æœ‰é‚®ä»¶çš„ç›¸å…³ä¿¡æ¯(åŒ…æ‹¬å‘ä»¶äººï¼Œæ”¶ä»¶äººå’Œé‚®ä»¶ä¸»é¢˜)ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MessageTrackingLog -Start "01/11/2019 09:00:00" -Sender "test1@test.com"
</code></pre></div></div>

<p>è¿”å›çš„ç»“æœå¾ˆæ‚ä¹±ï¼Œå…¶ä¸­åŒ…æ‹¬å¤šä¸ªäº‹ä»¶ï¼š</p>

<ul>
  <li>DSN</li>
  <li>Defer</li>
  <li>Deliver</li>
  <li>Send</li>
  <li>Receive</li>
</ul>

<p>åªç­›é€‰å‡ºå‘é€äº‹ä»¶ï¼Œä½¿è¿”å›ç»“æœæ›´ç®€æ´:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MessageTrackingLog -EventID send -Start "01/11/2019 09:00:00" -Sender "test1@test.com"
</code></pre></div></div>

<p>ç»Ÿè®¡æ¯å¤©æ”¶å‘é‚®ä»¶æ•°ç›®çš„è„šæœ¬ï¼š</p>

<p>https://gallery.technet.microsoft.com/office/f2af711e-defd-476d-896e-8053aa964bc5/view/Discussions</p>

<p>éœ€è¦ä¿®æ”¹èµ·å§‹æ—¶é—´å’Œæ·»åŠ åŠ è½½Exchange powershellç®¡ç†å•å…ƒçš„å‘½ä»¤</p>

<h2 id="0x03-å¯¼å‡ºé‚®ä»¶çš„ä¸¤ç§æ–¹æ³•">0x03 å¯¼å‡ºé‚®ä»¶çš„ä¸¤ç§æ–¹æ³•</h2>
<hr />

<h3 id="1ä½¿ç”¨pssessionå»ºç«‹è¿æ¥å¹¶å¯¼å‡ºé‚®ä»¶">1.ä½¿ç”¨PSSessionå»ºç«‹è¿æ¥å¹¶å¯¼å‡ºé‚®ä»¶</h3>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<p>https://docs.microsoft.com/en-us/powershell/module/exchange/mailboxes/new-mailboxexportrequest?view=exchange-ps</p>

<h4 id="1å°†ç”¨æˆ·æ·»åŠ åˆ°è§’è‰²ç»„mailbox-import-export">(1)å°†ç”¨æˆ·æ·»åŠ åˆ°è§’è‰²ç»„â€Mailbox Import Exportâ€</h4>

<p>è¿™é‡Œä»¥ç”¨æˆ·administratorä¸ºä¾‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-ManagementRoleAssignment â€“Role "Mailbox Import Export" â€“User Administrator
</code></pre></div></div>

<p>è¡¥å……ï¼šç§»é™¤çš„å‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-ManagementRoleAssignment -Identity "Mailbox Import Export-Administrator" -Confirm:$false
</code></pre></div></div>

<p>æ·»åŠ åå†æ¬¡æŸ¥çœ‹è¿›è¡Œç¡®è®¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ManagementRoleAssignment â€“Role "Mailbox Import Export"|fl user
</code></pre></div></div>

<h4 id="2é‡æ–°å¯åŠ¨powershell">(2)é‡æ–°å¯åŠ¨Powershell</h4>

<p>å¦åˆ™ï¼Œæ— æ³•ä½¿ç”¨å‘½ä»¤<code class="language-plaintext highlighter-rouge">New-MailboxexportRequest</code></p>

<h4 id="3å¯¼å‡ºé‚®ä»¶å¹¶ä¿å­˜">(3)å¯¼å‡ºé‚®ä»¶å¹¶ä¿å­˜</h4>

<p>è¿™é‡Œç»™å‡ºä¸‰ä¸ªå®ä¾‹</p>

<p>1.å¯¼å‡ºæŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰é‚®ä»¶ï¼Œä¿å­˜åˆ°ExchangeæœåŠ¡å™¨çš„c:\test</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$User = "test1"
New-MailboxexportRequest -mailbox $User -FilePath ("\\localhost\c$\test\"+$User+".pst")
</code></pre></div></div>

<p>2.ç­›é€‰å‡ºæŒ‡å®šç”¨æˆ·çš„bodyä¸­åŒ…å«å•è¯passçš„é‚®ä»¶ï¼Œä¿å­˜åˆ°ExchangeæœåŠ¡å™¨çš„c:\test</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$User = "test1"
New-MailboxexportRequest -mailbox $User -ContentFilter {(body -like "*pass*")} -FilePath ("\\localhost\c$\test\"+$User+".pst")
</code></pre></div></div>

<p>3.å¯¼å‡ºæ‰€æœ‰é‚®ä»¶ï¼Œä¿å­˜åˆ°ExchangeæœåŠ¡å™¨çš„c:\test</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Mailbox -OrganizationalUnit Users -Resultsize unlimited |%{New-MailboxexportRequest -mailbox $_.name -FilePath ("\\localhost\c$\test\"+($_.name)+".pst")}
</code></pre></div></div>

<p>å¯¼å‡ºåä¼šè‡ªåŠ¨ä¿å­˜å¯¼å‡ºè¯·æ±‚çš„è®°å½•ï¼Œé»˜è®¤ä¸º30å¤©</p>

<p>å¦‚æœä¸æƒ³ä¿å­˜å¯¼å‡ºè¯·æ±‚ï¼Œå¯ä»¥åŠ ä¸Šå‚æ•°<code class="language-plaintext highlighter-rouge">-CompletedRequestAgeLimit 0</code></p>

<p>è¡¥å……ï¼šå…³äºå¯¼å‡ºè¯·æ±‚çš„ç›¸å…³æ“ä½œ</p>

<p>æŸ¥çœ‹é‚®ä»¶å¯¼å‡ºè¯·æ±‚ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MailboxExportRequest
</code></pre></div></div>

<p>åˆ é™¤å…·ä½“çš„æŸä¸ªå¯¼å‡ºè¯·æ±‚ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-MailboxExportRequest -RequestQueue "Mailbox Database 2057988509" -RequestGuid 650f52ec-722b-47bb-8e73-d16a17c32129 -Confirm:$false
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-MailboxExportRequest -Identity 'test.com/Users/test1\MailboxExport' -Confirm:$false
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>åŒ¹é…çš„å‚æ•°ä»<code class="language-plaintext highlighter-rouge">Get-MailboxExportRequest|fl</code>çš„ç»“æœä¸­è·å¾—</p>

<p>åˆ é™¤æ‰€æœ‰å¯¼å‡ºè¯·æ±‚ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MailboxExportRequest|Remove-MailboxExportRequest -Confirm:$false
</code></pre></div></div>

<p>ç»¼ä¸Šï¼Œå¯¼å‡ºç”¨æˆ·test1çš„ç‰¹å®šé‚®ä»¶(bodyä¸­åŒ…å«å•è¯pass)åˆ°ExchangeæœåŠ¡å™¨çš„c:\testçš„å®ç°ä»£ç å·²ä¸Šä¼ è‡³githubï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-Powershell/blob/master/UsePSSessionToExportMailfromExchange.ps1</p>

<p>å‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UsePSSessionToExportMailfromExchange -User "administrator" -Password "DomainAdmin123!" -MailBox "test1" -ExportPath "\\Exchange01.test.com\c$\test\" -ConnectionUri "http://Exchange01.test.com/PowerShell/" -Filter "{`"(body -like `"*pass*`")`"}"
</code></pre></div></div>

<p>æµç¨‹å¦‚ä¸‹ï¼š</p>

<p>1.ä½¿ç”¨PSSessionè¿æ¥åˆ°ExchangeæœåŠ¡å™¨
2.åˆ¤æ–­ä½¿ç”¨çš„ç”¨æˆ·æ˜¯å¦è¢«åŠ å…¥åˆ°è§’è‰²ç»„â€Mailbox Import Exportâ€
	å¦‚æœæœªè¢«æ·»åŠ ï¼Œéœ€è¦æ·»åŠ ç”¨æˆ·
3.å¯¼å‡ºé‚®ä»¶å¹¶ä¿å­˜è‡³ExchangeæœåŠ¡å™¨çš„c:\testï¼Œæ ¼å¼ä¸ºpstæ–‡ä»¶
4.å¦‚æœæ–°æ·»åŠ äº†ç”¨æˆ·ï¼Œé‚£ä¹ˆä¼šå°†ç”¨æˆ·ç§»é™¤è§’è‰²ç»„â€Mailbox Import Exportâ€
5.æ¸…é™¤PSSession</p>

<p>å¯¼å‡ºçš„pstæ–‡ä»¶ä½¿ç”¨Outlookæ‰“å¼€å³å¯</p>

<h3 id="2åœ¨exchangeæœåŠ¡å™¨ä¸Šç›´æ¥å¯¼å‡ºé‚®ä»¶">2.åœ¨ExchangeæœåŠ¡å™¨ä¸Šç›´æ¥å¯¼å‡ºé‚®ä»¶</h3>

<h4 id="1æ·»åŠ ç®¡ç†å•å…ƒ">(1)æ·»åŠ ç®¡ç†å•å…ƒ</h4>

<p>ä¸åŒExchangeç‰ˆæœ¬å¯¹åº”çš„ç®¡ç†å•å…ƒåç§°ä¸åŒï¼š</p>

<ul>
  <li>Exchange 2007:
  Add-PSSnapin Microsoft.Exchange.Management.PowerShell.Admin;</li>
  <li>Exchange 2010:
  Add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010;</li>
  <li>Exchange 2013 &amp; 2016:
  Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;</li>
</ul>

<p>ä¸éœ€è¦è€ƒè™‘è§’è‰²ç»„ï¼Œå¯ä»¥ç›´æ¥å¯¼å‡ºé‚®ä»¶</p>

<h4 id="2å¯¼å‡ºé‚®ä»¶">(2)å¯¼å‡ºé‚®ä»¶</h4>
<p>å¯¼å‡ºç”¨æˆ·test1çš„é‚®ä»¶ï¼Œä¿å­˜åˆ°ExchangeæœåŠ¡å™¨çš„c:\testï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;
$User = "test1"
New-MailboxexportRequest -mailbox $User -FilePath ("\\localhost\c$\test\"+$User+".pst")
</code></pre></div></div>

<p>å‚ç…§1ä¸­çš„åŠŸèƒ½ï¼Œå¯¼å‡ºç”¨æˆ·test1çš„ç‰¹å®šé‚®ä»¶(bodyä¸­åŒ…å«å•è¯pass)åˆ°ExchangeæœåŠ¡å™¨çš„c:\testçš„å®ç°ä»£ç å·²ä¸Šä¼ è‡³githubï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-Powershell/blob/master/DirectExportMailfromExchange.ps1</p>

<p>å‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DirectExportMailfromExchange -MailBox "test1" -ExportPath "\\localhost\c$\test\" -Filter "{`"(body -like `"*pass*`")`"}" -Version 2013
</code></pre></div></div>

<p><strong>æ³¨ï¼š</strong></p>

<p>éœ€è¦æŒ‡å®šExchangeç‰ˆæœ¬</p>

<p>æµç¨‹å¦‚ä¸‹ï¼š</p>

<p>1.æ·»åŠ ç®¡ç†å•å…ƒ
2.å¯¼å‡ºé‚®ä»¶å¹¶ä¿å­˜è‡³ExchangeæœåŠ¡å™¨çš„c:\testï¼Œæ ¼å¼ä¸ºpstæ–‡ä»¶</p>

<p>å¯¼å‡ºçš„pstæ–‡ä»¶ä½¿ç”¨Outlookæ‰“å¼€å³å¯</p>

<h2 id="0x04-æœç´¢é‚®ä»¶çš„ä¸¤ç§æ–¹æ³•">0x04 æœç´¢é‚®ä»¶çš„ä¸¤ç§æ–¹æ³•</h2>
<hr />

<h3 id="1ä½¿ç”¨pssessionå»ºç«‹è¿æ¥å¹¶æœç´¢é‚®ä»¶">1.ä½¿ç”¨PSSessionå»ºç«‹è¿æ¥å¹¶æœç´¢é‚®ä»¶</h3>

<p>åŸºæœ¬æµç¨‹åŒå¯¼å‡ºé‚®ä»¶ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºè§’è‰²ç»„<code class="language-plaintext highlighter-rouge">"Mailbox Import Export"</code>éœ€è¦æ›´æ¢æˆ<code class="language-plaintext highlighter-rouge">"Mailbox Search"</code></p>

<p>å®ç°ä»£ç å·²ä¸Šä¼ è‡³githubï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-Powershell/blob/master/UsePSSessionToSearchMailfromExchange.ps1</p>

<p>ä»ç”¨æˆ·test1ä¸­æœç´¢åŒ…å«å•è¯passçš„é‚®ä»¶å¹¶ä¿å­˜åˆ°ç”¨æˆ·test2çš„out2æ–‡ä»¶å¤¹ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UsePSSessionToSearchMailfromExchange -User "administrator" -Password "DomainAdmin123!" -MailBox "test1" -ConnectionUri "http://Exchange01.test.com/PowerShell/" -Filter "*pass*" -TargetMailbox "test2" -TargetFolder "out2"
</code></pre></div></div>

<p>å¯¼å‡ºçš„ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2019-10-2/2-1.png" alt="Alt text" /></p>

<p>æœç´¢æ‰€æœ‰åŒ…å«å•è¯passçš„é‚®ä»¶å¹¶ä¿å­˜åˆ°ç”¨æˆ·test2çš„outAllæ–‡ä»¶å¤¹ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UsePSSessionToSearchMailfromExchange -User "administrator" -Password "DomainAdmin123!" -MailBox "All" -ConnectionUri "http://Exchange01.test.com/PowerShell/" -Filter "*pass*" -TargetMailbox "test2" -TargetFolder "outAll"
</code></pre></div></div>

<p>å¯¼å‡ºçš„ç»“æœå¦‚ä¸‹å›¾</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2019-10-2/2-2.png" alt="Alt text" /></p>

<h3 id="2åœ¨exchangeæœåŠ¡å™¨ä¸Šç›´æ¥æœç´¢é‚®ä»¶">2.åœ¨ExchangeæœåŠ¡å™¨ä¸Šç›´æ¥æœç´¢é‚®ä»¶</h3>

<p>åŸºæœ¬æµç¨‹åŒå¯¼å‡ºé‚®ä»¶ç›¸ä¼¼ï¼Œåœ¨å…·ä½“å‘½ä»¤ä¸Šå­˜åœ¨ä¸€äº›åŒºåˆ«</p>

<p>å®ç°ä»£ç å·²ä¸Šä¼ è‡³githubï¼Œåœ°å€å¦‚ä¸‹ï¼š</p>

<p>https://github.com/3gstudent/Homework-of-Powershell/blob/master/DirectSearchMailfromExchange.ps1</p>

<p>ä»ç”¨æˆ·test1ä¸­æœç´¢åŒ…å«å•è¯passçš„é‚®ä»¶å¹¶ä¿å­˜åˆ°ç”¨æˆ·test2çš„out2æ–‡ä»¶å¤¹ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DirectSearchMailfromExchange -MailBox "test1" -Filter "*pass*" -TargetMailbox "test2" -TargetFolder "out2" -Version 2013
</code></pre></div></div>

<p>æœç´¢æ‰€æœ‰åŒ…å«å•è¯passçš„é‚®ä»¶å¹¶ä¿å­˜åˆ°ç”¨æˆ·test2çš„outAllæ–‡ä»¶å¤¹ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DirectSearchMailfromExchange -MailBox "All" -Filter "*pass*" -TargetMailbox "test2" -TargetFolder "outAll" -Version 2013
</code></pre></div></div>

<h3 id="è¡¥å……1æœç´¢é‚®ä»¶çš„å¸¸ç”¨å‘½ä»¤">è¡¥å……1ï¼šæœç´¢é‚®ä»¶çš„å¸¸ç”¨å‘½ä»¤</h3>

<p>(1)æšä¸¾æ‰€æœ‰é‚®ç®±ç”¨æˆ·ï¼Œæ˜¾ç¤ºåŒ…å«å…³é”®è¯passçš„é‚®ä»¶çš„æ•°é‡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Mailbox|Search-Mailbox -SearchQuery "*pass*" -EstimateResultOnly
</code></pre></div></div>

<p>(2)æœç´¢é‚®ç®±ç”¨æˆ·test1ï¼Œæ˜¾ç¤ºåŒ…å«å…³é”®è¯passçš„é‚®ä»¶çš„æ•°é‡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Search-Mailbox -Identity test1 -SearchQuery "*pass*" -EstimateResultOnly
</code></pre></div></div>

<p>ç¤ºä¾‹å¦‚ä¸‹å›¾ï¼Œæ•°é‡ä¸º4ä¸ª</p>

<p><img src="https://raw.githubusercontent.com/3gstudent/BlogPic/master/2019-10-2/2-3.png" alt="Alt text" /></p>

<p>(3)æšä¸¾æ‰€æœ‰é‚®ç®±ç”¨æˆ·ï¼Œå¯¼å‡ºåŒ…å«å…³é”®è¯passçš„é‚®ä»¶è‡³ç”¨æˆ·test2çš„æ–‡ä»¶å¤¹outä¸­(ä¸ä¿å­˜æ—¥å¿—)ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Mailbox|Search-Mailbox -SearchQuery "*pass*" -TargetMailbox "test2" -TargetFolder "out" -LogLevel Suppress
</code></pre></div></div>

<p>(4)æœç´¢é‚®ç®±ç”¨æˆ·test1ï¼Œå¯¼å‡ºåŒ…å«å…³é”®è¯passçš„é‚®ä»¶è‡³ç”¨æˆ·test2çš„æ–‡ä»¶å¤¹outä¸­(ä¸ä¿å­˜æ—¥å¿—)ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Search-Mailbox -Identity test1 -SearchQuery "*pass*" -TargetMailbox "test2" -TargetFolder "out" -LogLevel Suppress
</code></pre></div></div>

<h3 id="è¡¥å……2-é€šè¿‡ecpæœç´¢é‚®ä»¶">è¡¥å……2 é€šè¿‡ECPæœç´¢é‚®ä»¶</h3>

<p>ç™»å½•ecpï¼Œå°†å½“å‰ç”¨æˆ·åŠ å…¥<code class="language-plaintext highlighter-rouge">Discovery Management</code>ç»„ä¸­</p>

<p>åˆ·æ–°é¡µé¢</p>

<p>é€‰æ‹©<code class="language-plaintext highlighter-rouge">compliance management</code>-&gt;<code class="language-plaintext highlighter-rouge">in-place eDiscovery &amp; hold</code></p>

<p>å…·ä½“æ“ä½œç»†èŠ‚å¯å‚è€ƒï¼šhttps://docs.microsoft.com/en-us/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery?redirectedfrom=MSDN#roles</p>

<h3 id="è¡¥å……3-å‘½ä»¤è¡Œä¸‹æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·">è¡¥å……3 å‘½ä»¤è¡Œä¸‹æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell -c "Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;$pwd=convertto-securestring Password123 -asplaintext -force;New-Mailbox -UserPrincipalName testuser1@test.com -OrganizationalUnit test.com/Users -Alias testuser1 -Name testuser1 -DisplayName testuser1 -Password $pwd;Add-RoleGroupMember \"Organization Management\" -Member testuser1 -BypassSecurityGroupManagerCheck"
</code></pre></div></div>

<h2 id="0x05-å°ç»“">0x05 å°ç»“</h2>
<hr />

<p>æœ¬æ–‡ä»‹ç»äº†ç®¡ç†Exchangeé‚®ä»¶çš„ä¸¤ç§æ–¹å¼ï¼šåœ¨ExchangeæœåŠ¡å™¨ä¸Šç›´æ¥è°ƒç”¨ç®¡ç†å•å…ƒå’Œä½¿ç”¨PSSessionå»ºç«‹è¿æ¥å¹¶è¿œç¨‹ç®¡ç†é‚®ä»¶ï¼Œåˆ†åˆ«ä»‹ç»äº†å¯¹åº”çš„å¯¼å‡ºå’Œæœç´¢é‚®ä»¶çš„æ–¹æ³•ï¼Œå¼€æº4ä¸ªpowershellè„šæœ¬ï¼Œåˆ†äº«è„šæœ¬ç¼–å†™ç»†èŠ‚ã€‚</p>

<hr />

<p><a href="https://github.com/3gstudent/feedback/issues/new">LEAVE A REPLY</a></p>

:ET